<html>
  <head>
    <title>pallet.core API reference (pallet)</title>
    <link href="static/favicon.png" rel="icon" />
    <link href="static/favicon.png" rel="shortcut icon" />
    <link media="all" type="text/css" href="static/clojure.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/wiki.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/internal.css" rel="stylesheet" />
    <!-- TODO: are we using these (from clojure.org)? If so, add the files -->
    <script src="file/view/code_highlighter.js" type="text/javascript"></script>
    <script src="file/view/clojure.js" type="text/javascript"></script>
    <style>.menuWrapper{height: 36px;}</style>
    <!--[if lte IE 6]>
    <link rel="stylesheet" href="http://www.wikispaces.com/_/2009051601/s/internal_ie.css" type="text/css" />
    <![endif]-->
  </head>
<!--
This document was auto-generated from the source by the clojure autodoc system.
To report errors or ask questions about the overall documentation structure, formatting,
etc., contact Tom Faulhaber (google mail name: tomfaulhaber).
For errors in the documentation of a particular namespace, contact the author of that
namespace.
-->
  <body>
    <div id="AllContentContainer">
      <div id="Header">
	<a id="Logo" href="index.html"><img alt="Clojure" height="100" width="100" src="static/clojure-icon.gif" /></a>
	<h1><a title="page header title" id="page-header" href="index.html">pallet</a></h1>
      </div>
      <div id="leftcolumn"><div style="text-align: center;"></div>
<div class="menu">
  <div class="WikiCustomNav WikiElement wiki">
    <a class="wiki_link" href="index.html">Overview</a><br />
    <a class="wiki_link" href="api-index.html">API Index</a><br />
    <a class="wiki_link" href="#">Namespaces:</a>
    <ul id="left-sidebar-list">
      <li><a href="pallet.action-api.html" class="wiki_link">pallet.action</a></li><li><a href="pallet.action-plan-api.html" class="wiki_link">pallet.action-plan</a></li><li><a href="pallet.argument-api.html" class="wiki_link">pallet.argument</a></li><li><a href="pallet.blobstore-api.html" class="wiki_link">pallet.blobstore</a></li><li><a href="pallet.command-line-api.html" class="wiki_link">pallet.command-line</a></li><li><a href="pallet.command-script-api.html" class="wiki_link">pallet.command-script</a></li><li><a href="pallet.compute-api.html" class="wiki_link">pallet.compute</a></li><li><a href="pallet.config-file.format-api.html" class="wiki_link">pallet.config-file.format</a></li><li><a href="pallet.configure-api.html" class="wiki_link">pallet.configure</a></li><li><a href="pallet.core-api.html" class="wiki_link">pallet.core</a></li><li><a href="pallet.crate.network-service-api.html" class="wiki_link">pallet.crate.network-service</a></li><li><a href="pallet.debug-api.html" class="wiki_link">pallet.debug</a></li><li><a href="pallet.enlive-api.html" class="wiki_link">pallet.enlive</a></li><li><a href="pallet.environment-api.html" class="wiki_link">pallet.environment</a></li><li><a href="pallet.execute-api.html" class="wiki_link">pallet.execute</a></li><li><a href="pallet.futures-api.html" class="wiki_link">pallet.futures</a></li><li><a href="pallet.heynote-api.html" class="wiki_link">pallet.heynote</a></li><li><a href="pallet.main-api.html" class="wiki_link">pallet.main</a></li><li><a href="pallet.main-invoker-api.html" class="wiki_link">pallet.main-invoker</a></li><li><a href="pallet.maven-api.html" class="wiki_link">pallet.maven</a></li><li><a href="pallet.md5crypt-api.html" class="wiki_link">pallet.md5crypt</a></li><li><a href="pallet.parameter-api.html" class="wiki_link">pallet.parameter</a></li><li><a href="pallet.phase-api.html" class="wiki_link">pallet.phase</a></li><li><a href="pallet.repl-api.html" class="wiki_link">pallet.repl</a></li><li><a href="pallet.request-map-api.html" class="wiki_link">pallet.request-map</a></li><li><a href="pallet.resource-api.html" class="wiki_link">pallet.resource</a></li><li><a href="pallet.session-api.html" class="wiki_link">pallet.session</a></li><li><a href="pallet.shell-api.html" class="wiki_link">pallet.shell</a></li><li><a href="pallet.strint-api.html" class="wiki_link">pallet.strint</a></li><li><a href="pallet.target-api.html" class="wiki_link">pallet.target</a></li><li><a href="pallet.task.add-service-api.html" class="wiki_link">pallet.task.add-service</a></li><li><a href="pallet.task.containers-api.html" class="wiki_link">pallet.task.containers</a></li><li><a href="pallet.task.converge-api.html" class="wiki_link">pallet.task.converge</a></li><li><a href="pallet.task.converge-cluster-api.html" class="wiki_link">pallet.task.converge-cluster</a></li><li><a href="pallet.task.describe-node-api.html" class="wiki_link">pallet.task.describe-node</a></li><li><a href="pallet.task.destroy-cluster-api.html" class="wiki_link">pallet.task.destroy-cluster</a></li><li><a href="pallet.task.feedback-api.html" class="wiki_link">pallet.task.feedback</a></li><li><a href="pallet.task.help-api.html" class="wiki_link">pallet.task.help</a></li><li><a href="pallet.task.lift-api.html" class="wiki_link">pallet.task.lift</a></li><li><a href="pallet.task.new-project-api.html" class="wiki_link">pallet.task.new-project</a></li><li><a href="pallet.task.nodes-api.html" class="wiki_link">pallet.task.nodes</a></li><li><a href="pallet.task.providers-api.html" class="wiki_link">pallet.task.providers</a></li><li><a href="pallet.task.to-blob-api.html" class="wiki_link">pallet.task.to-blob</a></li><li><a href="pallet.task.version-api.html" class="wiki_link">pallet.task.version</a></li><li><a href="pallet.task.vmfest-script-api.html" class="wiki_link">pallet.task.vmfest-script</a></li><li><a href="pallet.template-api.html" class="wiki_link">pallet.template</a></li><li><a href="pallet.utils-api.html" class="wiki_link">pallet.utils</a></li>
    </ul>
  </div>
</div>
</div>
      <div id="rightcolumn">
	<div id="Content">
	  <div class="contentBox"><div class="innerContentBox">
              <div id="content_view" class="wiki wikiPage">
                <div id="right-sidebar"><div id="toc">
  <h1 class="nopad">Table of Contents</h1>
  <div style="margin-left: 1em;" class="toc-section">
    <a href="#toc0">Overview</a>
    <div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/*warn-on-undefined-phase*">*warn-on-undefined-phase*</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/admin-user">admin-user</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/all-node-set-selector">all-node-set-selector</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/cluster-groups">cluster-groups</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/cluster-spec">cluster-spec</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/converge">converge</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/converge*">converge*</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/converge-cluster">converge-cluster</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/default-algorithms">default-algorithms</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/default-environment">default-environment</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/default-executors">default-executors</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/defnode">defnode</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/destroy-cluster">destroy-cluster</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/environment-args">environment-args</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/group-spec">group-spec</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/groups-with-servers">groups-with-servers</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/lift">lift</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/lift*">lift*</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/lift-cluster">lift-cluster</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/lift-nodes">lift-nodes</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/lift-nodes-for-phase">lift-nodes-for-phase</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/log-message">log-message</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/log-session">log-session</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/make-node">make-node</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/middleware-handler">middleware-handler</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/name-with-attributes">name-with-attributes</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/new-node-set-selector">new-node-set-selector</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/node-spec">node-spec</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/nodes-in-set">nodes-in-set</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/parallel-adjust-node-counts">parallel-adjust-node-counts</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/parallel-apply-phase">parallel-apply-phase</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/parallel-lift">parallel-lift</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/raise-on-error">raise-on-error</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/select-node-set">select-node-set</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/sequential-apply-phase">sequential-apply-phase</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/sequential-lift">sequential-lift</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/serial-adjust-node-counts">serial-adjust-node-counts</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/server">server</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/server-spec">server-spec</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/session-with-all-nodes">session-with-all-nodes</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/session-with-groups">session-with-groups</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/show-target-keys">show-target-keys</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/stop-execution-on-error">stop-execution-on-error</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/version">version</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/with-admin-user">with-admin-user</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/with-middleware">with-middleware</a>
    </div>
    <br />
  </div>
</div>
</div>
                <div id="content-tag"><h1 id="overview">API for <span id="namespace-name">pallet.core</span></h1>
by <span id="author">Hugo Duncan</span><br />
<br />Usage:
<pre>
(ns your-namespace
  (:require <span id="long-name">pallet.core</span>))
</pre><pre>
</pre><h2>Overview</h2>
<pre id="namespace-docstr">Core functionality is provided in `lift` and `converge`.

- node           :: A node in the compute service
- node-spec      :: A specification for a node. The node-spec provides an image
                    hardware, location and network template for starting new
                    nodes.
- server-spec    :: A specification for a server. This is a map of phases and
                    a default node-spec. A server-spec has the following keys
                    :phase, :packager and node-spec keys.
- group-spec     :: A group of identically configured nodes, represented as a
                    map with :group-name, :count and server-spec keys.
                    The group-name is used to link running nodes to their
                    configuration (via pallet.compute.Node/group-name)
- group          :: A group of identically configured nodes, represented as a
                    group-spec, together with the servers that are running
                    for that group-spec.
- group name     :: The name used to identify a group.
- server         :: A map used to descibe the node, image, etc of a single
                    node running as part of a group. A server has the
                    following keys :group-name, :node, :node-id and server-spec
                    keys.
- phase list     :: A list of phases to be used
- action plan    :: A list of actions that should be run.</pre>
<br />
<h2>Public Variables and Functions</h2>
<div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/*warn-on-undefined-phase*">*warn-on-undefined-phase*</h2>
  <span id="var-type">var</span><br />
  <pre id="var-usage"></pre>
  <pre id="var-docstr">Flag to control output of warnings about undefined phases in calls to lift
and converge.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/admin-user">admin-user</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (admin-user user)
       (admin-user username &amp; {:keys [public-key-path private-key-path passphrase password sudo-password no-sudo], :as options})
</pre>
  <pre id="var-docstr">Set the root binding for the admin user.
The user arg is a map as returned by make-user, or a username.  When passing
a username the options can be specified as in `pallet.utils/make-user`.

This is mainly for use at the repl, since the admin user can be specified
functionally using the :user key in a lift or converge call, or in the
environment.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/all-node-set-selector">all-node-set-selector</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (all-node-set-selector session)
</pre>
  <pre id="var-docstr">Select all nodes for groups in the node-set for processing</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/cluster-groups">cluster-groups</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (cluster-groups cluster)
</pre>
  <pre id="var-docstr">Return the groups in the passed cluster or sequence of clusters.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/cluster-spec">cluster-spec</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (cluster-spec cluster-name &amp; {:keys [extends groups phases node-spec environment], :as options})
</pre>
  <pre id="var-docstr">Create a cluster-spec.

`name` is used as a prefix for all groups in the cluster.

- :groups    specify a sequence of groups that define the cluster

- :extends   specify a server-spec, a group-spec, or sequence thereof,
             for all groups in the cluster

- :phases    define phases on all groups.

- :node-spec default node-spec for the nodes in the cluster

- :roles     roles for the group-spec</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/converge">converge</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (converge group-spec-&gt;count &amp; {:keys [compute blobstore user phase prefix middleware all-nodes all-node-set environment], :as options})
</pre>
  <pre id="var-docstr">Converge the existing compute resources with the counts specified in
`group-spec-&gt;count`. New nodes are started, or nodes are destroyed,
to obtain the specified node counts.

`group-spec-&gt;count` can be a map from group-spec to node count, or can be a
sequence of group-specs containing a :count key.

The compute service may be supplied as an option, otherwise the bound
compute-service is used.


This applies the bootstrap phase to all new nodes and the configure phase to
all running nodes whose group-name matches a key in the node map.  Additional
phases can also be specified in the options, and will be applied to all
matching nodes.  The :configure phase is always applied, by default as the
first (post bootstrap) phase.  You can change the order in which
the :configure phase is applied by explicitly listing it.

An optional group-name prefix may be specified. This will be used to modify
the group-name for each group-spec, allowing you to build multiple discrete
clusters from a single set of group-specs.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/converge*">converge*</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (converge* session)
</pre>
  <pre id="var-docstr">Converge the node counts of each node-spec in `:node-set`, executing each of
the configuration phases on all the group-names in `:node-set`. The
phase-functions are also executed, but not applied, for any other nodes in
`:all-node-set`</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/converge-cluster">converge-cluster</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (converge-cluster cluster &amp; options)
</pre>
  <pre id="var-docstr">Converge the specified cluster. As for `converge`, but takes a cluster-spec
or sequence of cluster-specs.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/default-algorithms">default-algorithms</h2>
  <span id="var-type">var</span><br />
  <pre id="var-usage"></pre>
  <pre id="var-docstr">Algorithms to use when none specified</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/default-environment">default-environment</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (default-environment)
</pre>
  <pre id="var-docstr">Specify the built-in default environment</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/default-executors">default-executors</h2>
  <span id="var-type">var</span><br />
  <pre id="var-usage"></pre>
  <pre id="var-docstr">Default executor map</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/defnode">defnode</h2>
  <span id="var-type">macro</span><br />
  <pre id="var-usage">Usage: (defnode tag doc-str? attr-map? image &amp; phasekw-phasefn-pairs)
</pre>
  <pre id="var-docstr">Define a node type.  The name is used for the group name.

image defines the image selector template.  This is a vector of keyword or
       keyword value pairs that are used to filter the image list to select
       an image.
Options are used to define phases. Standard phases are:
  :bootstrap    run on first boot
  :configure    defines the configuration of the node.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/destroy-cluster">destroy-cluster</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (destroy-cluster cluster &amp; options)
</pre>
  <pre id="var-docstr">Destroy the specified cluster. As for `converge`, but takes a cluster-spec
or sequence of cluster-specs.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/environment-args">environment-args</h2>
  <span id="var-type">var</span><br />
  <pre id="var-usage"></pre>
  <pre id="var-docstr">args that are really part of the environment</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/group-spec">group-spec</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (group-spec name &amp; {:keys [extends count image phases packager node-spec roles], :as options})
</pre>
  <pre id="var-docstr">Create a group-spec.

`name` is used for the group name, which is set on each node and links a node
to it's node-spec

- :extends  specify a server-spec, a group-spec, or sequence thereof,
            and is used to inherit phases, etc.

- :phases used to define phases. Standard phases are:
  - :bootstrap    run on first boot of a new node
  - :configure    defines the configuration of the node.

- :count    specify the target number of nodes for this node-spec
- :packager override the choice of packager to use
- :node-spec      default node-spec for this server-spec</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/groups-with-servers">groups-with-servers</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (groups-with-servers node-map execute-node?)
</pre>
  <pre id="var-docstr">Takes a map from node-spec to sequence of nodes, and converts it to a
sequence of group definitions, containing a server for each node in then
:servers key of each group.  The server will contain the node-spec,
updated with any information that was available from the node.

    (groups-with-servers {(node-spec "spec" {}) [a b c]})
      =&gt; [{:group-name "spec"
           :servers [{:group-name "spec" :node a}
                     {:group-name "spec" :node b}
                     {:group-name "spec" :node c}]}]

`options` allows adding extra keys to the servers.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/lift">lift</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (lift node-set &amp; {:keys [compute phase prefix middleware all-node-set environment], :as options})
</pre>
  <pre id="var-docstr">Lift the running nodes in the specified node-set by applying the specified
phases.  The compute service may be supplied as an option, otherwise the
bound compute-service is used.  The configure phase is applied by default
unless other phases are specified.

node-set can be a node type, a sequence of node types, or a map
of node type to nodes. Examples:
           [node-type1 node-type2 {node-type #{node1 node2}}]
           node-type
           {node-type #{node1 node2}}

options can also be keywords specifying the phases to apply, or an immediate
phase specified with the phase macro, or a function that will be called with
each matching node.

Options:
 :compute         a jclouds compute service
 :compute-service a map of :provider, :identity, :credential, and
                  optionally :extensions for constructing a jclouds compute
                  service.
 :phase           a phase keyword, phase function, or sequence of these
 :middleware      the middleware to apply to the configuration pipeline
 :prefix          a prefix for the group-name names
 :user            the admin-user on the nodes</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/lift*">lift*</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (lift* session)
</pre>
  <pre id="var-docstr">Lift the nodes specified in the session :node-set key.
- :node-set     - a specification of nodes to lift
- :all-nodes    - a sequence of all known nodes
- :all-node-set - a specification of nodes to invoke (but not lift)</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/lift-cluster">lift-cluster</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (lift-cluster cluster &amp; options)
</pre>
  <pre id="var-docstr">Lift the specified cluster.  As for `lift`, but takes a cluster-spec
or sequence of cluster-specs.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/lift-nodes">lift-nodes</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (lift-nodes session)
</pre>
  <pre id="var-docstr">Lift nodes in target-node-map for the specified phases.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/lift-nodes-for-phase">lift-nodes-for-phase</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (lift-nodes-for-phase session)
</pre>
  <pre id="var-docstr">Lift nodes in target-node-map for the specified phases.

Builds the commands for the phase, then executes pre-phase, phase, and
after-phase</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/log-message">log-message</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (log-message msg)
</pre>
  <pre id="var-docstr">Log the message</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/log-session">log-session</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (log-session msg)
</pre>
  <pre id="var-docstr">Log the session state</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/make-node">make-node</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (make-node name image &amp; {:as phase-map})
</pre>
  <pre id="var-docstr">Create a node definition.  See defnode.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/middleware-handler">middleware-handler</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (middleware-handler handler)
</pre>
  <pre id="var-docstr">Build a middleware processing pipeline from the specified middleware.
The result is a middleware.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/name-with-attributes">name-with-attributes</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (name-with-attributes name macro-args)
</pre>
  <pre id="var-docstr">Modified version, of that found in contrib, to handle the image map.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/new-node-set-selector">new-node-set-selector</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (new-node-set-selector session)
</pre>
  <pre id="var-docstr">Select all new nodes for groups in the node-set for processing</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/node-spec">node-spec</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (node-spec &amp; {:keys [image hardware location network qos], :as options})
</pre>
  <pre id="var-docstr">Create a node-spec.

Defines the compute image and hardware selector template.

This is used to filter a cloud provider's image and hardware list to select
an image and hardware for nodes created for this node-spec.

:image     a map descirbing a predicate for matching an image:
           os-family os-name-matches os-version-matches
           os-description-matches os-64-bit
           image-version-matches image-name-matches
           image-description-matches image-id

:location  a map describing a predicate for matching location:
           location-id
:hardware  a map describing a predicate for matching harware:
           min-cores min-ram smallest fastest biggest architecture
           hardware-id
:network   a map for network connectivity options:
           inbound-ports
:qos       a map for quality of service options:
           spot-price enable-monitoring</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/nodes-in-set">nodes-in-set</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (nodes-in-set node-set prefix nodes)
</pre>
  <pre id="var-docstr">Build a map of node-spec to nodes for the given `node-set`.
A node set can be a node spec, a map from node-spec to a sequence of nodes,
or a sequence of these.

The prefix is applied to the group-name of each node-spec in the result.
This allows you to build seperate clusters based on the same node-spec's.

The return value is a map of node-spec to node sequence.

Example node sets:
    node-spec-1
    [node-spec1 node-spec-2]
    {node-spec #{node1 node2}}
    [node-spec1 node-spec-2 {node-spec #{node1 node2}}]</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/parallel-adjust-node-counts">parallel-adjust-node-counts</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (parallel-adjust-node-counts delta-map session)
</pre>
  <pre id="var-docstr">Start or stop the specified number of nodes.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/parallel-apply-phase">parallel-apply-phase</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (parallel-apply-phase session servers)
</pre>
  <pre id="var-docstr">Apply a phase to a sequence of nodes</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/parallel-lift">parallel-lift</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (parallel-lift session)
</pre>
  <pre id="var-docstr">Apply the phases in sequence, to nodes in parallel.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/raise-on-error">raise-on-error</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (raise-on-error handler)
</pre>
  <pre id="var-docstr">Middleware that raises a condition on an error.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/select-node-set">select-node-set</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (select-node-set session)
</pre>
  <pre id="var-docstr">Select a node-set of nodes to be passed to lift</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/sequential-apply-phase">sequential-apply-phase</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (sequential-apply-phase session servers)
</pre>
  <pre id="var-docstr">Apply a phase to a sequence of nodes</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/sequential-lift">sequential-lift</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (sequential-lift session)
</pre>
  <pre id="var-docstr">Sequential apply the phases.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/serial-adjust-node-counts">serial-adjust-node-counts</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (serial-adjust-node-counts delta-map session)
</pre>
  <pre id="var-docstr">Start or stop the specified number of nodes.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/server">server</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (server group node options)
</pre>
  <pre id="var-docstr">Take a `group` and a `node`, an `options` map and combine them to produce
a server.

The group os-family, os-version, are replaced with the details form the
node. The :node key is set to `node`, and the :node-id and :packager keys
are set.

`options` allows adding extra keys on the server.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/server-spec">server-spec</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (server-spec &amp; {:keys [phases packager node-spec extends roles], :as options})
</pre>
  <pre id="var-docstr">Create a server-spec.

- :phases a hash-map used to define phases. Standard phases are:
  - :bootstrap    run on first boot of a new node
  - :configure    defines the configuration of the node
- :extends        takes a server-spec, or sequence thereof, and is used to
                  inherit phases, etc.
- :roles          defines a sequence of roles for the server-spec
- :node-spec      default node-spec for this server-spec
- :packager       override the choice of packager to use</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/session-with-all-nodes">session-with-all-nodes</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (session-with-all-nodes session)
</pre>
  <pre id="var-docstr">If the :all-nodes key is not set, then the nodes are retrieved from the
compute service if possible.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/session-with-groups">session-with-groups</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (session-with-groups session)
</pre>
  <pre id="var-docstr">Takes the :selected-nodes, :all-nodes. :node-set and :prefix keys and compute
the groups for the session, updating the :selected-nodes, :all-nodes
and :groups keys of the session.

The :groups key is set to a sequence of groups, each containing its
list of servers on the :servers key.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/show-target-keys">show-target-keys</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (show-target-keys handler)
</pre>
  <pre id="var-docstr">Middleware that is useful in debugging.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/stop-execution-on-error">stop-execution-on-error</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (stop-execution-on-error result flag)
</pre>
  <pre id="var-docstr">:execute-status-fn algorithm to stop execution on an error</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/version">version</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (version)
</pre>
  <pre id="var-docstr">Returns the pallet version.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/with-admin-user">with-admin-user</h2>
  <span id="var-type">macro</span><br />
  <pre id="var-usage">Usage: (with-admin-user user &amp; body)
       (with-admin-user [username &amp; {:keys [public-key-path private-key-path passphrase password sudo-password no-sudo], :as options}] &amp; body)
</pre>
  <pre id="var-docstr">Specify the admin user for running remote commands.  The user is specified
either as pallet.utils.User record (see the pallet.utils/make-user
convenience fn) or as an argument list that will be passed to make-user.

This is mainly for use at the repl, since the admin user can be specified
functionally using the :user key in a lift or converge call, or in the
environment.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/with-middleware">with-middleware</h2>
  <span id="var-type">macro</span><br />
  <pre id="var-usage">Usage: (with-middleware f &amp; body)
</pre>
  <pre id="var-docstr">Wrap node execution in the given middleware. A middleware is a function of
one argument (a handler function, that is the next middleware to call) and
returns a dunction of one argument (the session map).  Middleware can be
composed with the pipe macro.</pre>
  
</div>


</div>
              </div>
            </div>
          </div>
	</div>
	<div id="foot">
	  <div style="text-align: center;" id="copyright">Copyright (c) 2010 Hugo Duncan</div>
	</div>
      </div>
      <div id="DesignedBy">Logo &amp; site design by <a title="Visit Tom Hickey's website." href="http://www.tomhickey.com">Tom Hickey</a>.<br />
      Clojure auto-documentation system by Tom Faulhaber.</div>
    </div>
    <!-- /AllContentContainer -->
  </body>

</html>