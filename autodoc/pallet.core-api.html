<html>
  <head>
    <title>pallet.core API reference (pallet)</title>
    <link href="static/favicon.png" rel="icon" />
    <link href="static/favicon.png" rel="shortcut icon" />
    <link media="all" type="text/css" href="static/clojure.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/wiki.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/internal.css" rel="stylesheet" />
    <!-- TODO: are we using these (from clojure.org)? If so, add the files -->
    <script src="file/view/code_highlighter.js" type="text/javascript"></script>
    <script src="file/view/clojure.js" type="text/javascript"></script>
    <style>.menuWrapper{height: 36px;}</style>
    <!--[if lte IE 6]>
    <link rel="stylesheet" href="http://www.wikispaces.com/_/2009051601/s/internal_ie.css" type="text/css" />
    <![endif]-->
  </head>
<!--
This document was auto-generated from the source by the clojure autodoc system.
To report errors or ask questions about the overall documentation structure, formatting,
etc., contact Tom Faulhaber (google mail name: tomfaulhaber).
For errors in the documentation of a particular namespace, contact the author of that
namespace.
-->
  <body>
    <div id="AllContentContainer">
      <div id="Header">
	<a id="Logo" href="index.html"><img alt="Clojure" height="100" width="100" src="static/clojure-icon.gif" /></a>
	<h1><a title="page header title" id="page-header" href="index.html">pallet</a></h1>
      </div>
      <div id="leftcolumn"><div style="text-align: center;"></div>
<div class="menu">
  <div class="WikiCustomNav WikiElement wiki">
    <a class="wiki_link" href="index.html">Overview</a><br />
    <a class="wiki_link" href="api-index.html">API Index</a><br />
    <a class="wiki_link" href="#">Namespaces:</a>
    <ul id="left-sidebar-list">
      <li><a href="pallet.argument-api.html" class="wiki_link">pallet.argument</a></li><li><a href="pallet.blobstore-api.html" class="wiki_link">pallet.blobstore</a></li><li><a href="pallet.command-line-api.html" class="wiki_link">pallet.command-line</a></li><li><a href="pallet.command-script-api.html" class="wiki_link">pallet.command-script</a></li><li><a href="pallet.compute-api.html" class="wiki_link">pallet.compute</a></li><li><a href="pallet.configure-api.html" class="wiki_link">pallet.configure</a></li><li><a href="pallet.core-api.html" class="wiki_link">pallet.core</a></li><li><a href="pallet.debug-api.html" class="wiki_link">pallet.debug</a></li><li><a href="pallet.enlive-api.html" class="wiki_link">pallet.enlive</a></li><li><a href="pallet.execute-api.html" class="wiki_link">pallet.execute</a></li><li><a href="pallet.heynote-api.html" class="wiki_link">pallet.heynote</a></li><li><a href="pallet.main-api.html" class="wiki_link">pallet.main</a></li><li><a href="pallet.main-invoker-api.html" class="wiki_link">pallet.main-invoker</a></li><li><a href="pallet.maven-api.html" class="wiki_link">pallet.maven</a></li><li><a href="pallet.md5crypt-api.html" class="wiki_link">pallet.md5crypt</a></li><li><a href="pallet.parameter-api.html" class="wiki_link">pallet.parameter</a></li><li><a href="pallet.repl-api.html" class="wiki_link">pallet.repl</a></li><li><a href="pallet.request-map-api.html" class="wiki_link">pallet.request-map</a></li><li><a href="pallet.resource-api.html" class="wiki_link">pallet.resource</a></li><li><a href="pallet.resource-build-api.html" class="wiki_link">pallet.resource-build</a></li><li><a href="pallet.script-api.html" class="wiki_link">pallet.script</a></li><li><a href="pallet.stevedore-api.html" class="wiki_link">pallet.stevedore</a></li><li><a href="pallet.strint-api.html" class="wiki_link">pallet.strint</a></li><li><a href="pallet.target-api.html" class="wiki_link">pallet.target</a></li><li><a href="pallet.task.containers-api.html" class="wiki_link">pallet.task.containers</a></li><li><a href="pallet.task.converge-api.html" class="wiki_link">pallet.task.converge</a></li><li><a href="pallet.task.describe-node-api.html" class="wiki_link">pallet.task.describe-node</a></li><li><a href="pallet.task.feedback-api.html" class="wiki_link">pallet.task.feedback</a></li><li><a href="pallet.task.help-api.html" class="wiki_link">pallet.task.help</a></li><li><a href="pallet.task.lift-api.html" class="wiki_link">pallet.task.lift</a></li><li><a href="pallet.task.new-project-api.html" class="wiki_link">pallet.task.new-project</a></li><li><a href="pallet.task.nodes-api.html" class="wiki_link">pallet.task.nodes</a></li><li><a href="pallet.task.providers-api.html" class="wiki_link">pallet.task.providers</a></li><li><a href="pallet.task.to-blob-api.html" class="wiki_link">pallet.task.to-blob</a></li><li><a href="pallet.task.version-api.html" class="wiki_link">pallet.task.version</a></li><li><a href="pallet.template-api.html" class="wiki_link">pallet.template</a></li><li><a href="pallet.thread-expr-api.html" class="wiki_link">pallet.thread-expr</a></li><li><a href="pallet.utils-api.html" class="wiki_link">pallet.utils</a></li>
    </ul>
  </div>
</div>
</div>
      <div id="rightcolumn">
	<div id="Content">
	  <div class="contentBox"><div class="innerContentBox">
              <div id="content_view" class="wiki wikiPage">
                <div id="right-sidebar"><div id="toc">
  <h1 class="nopad">Table of Contents</h1>
  <div style="margin-left: 1em;" class="toc-section">
    <a href="#toc0">Overview</a>
    <div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/*warn-on-undefined-phase*">*warn-on-undefined-phase*</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/admin-user">admin-user</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/converge">converge</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/converge*">converge*</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/defnode">defnode</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/execute-with-local-sh">execute-with-local-sh</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/lift">lift</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/lift-nodes">lift-nodes</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/make-node">make-node</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/name-with-attributes">name-with-attributes</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/sequential-apply-phase">sequential-apply-phase</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/sequential-lift">sequential-lift</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/show-target-keys">show-target-keys</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/version">version</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/with-admin-user">with-admin-user</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/with-middleware">with-middleware</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/with-target-parameters">with-target-parameters</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/wrap-local-exec">wrap-local-exec</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/wrap-no-exec">wrap-no-exec</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.core/wrap-with-user-credentials">wrap-with-user-credentials</a>
    </div>
    <br />
  </div>
</div>
</div>
                <div id="content-tag"><h1 id="overview">API for <span id="namespace-name">pallet.core</span></h1>
by <span id="author">Hugo Duncan</span><br />
<br />Usage:
<pre>
(ns your-namespace
  (:require <span id="long-name">pallet.core</span>))
</pre><pre>
</pre><h2>Overview</h2>
<pre id="namespace-docstr">Core functionality is provided in `lift` and `converge`.</pre>
<br />
<h2>Public Variables and Functions</h2>
<div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/*warn-on-undefined-phase*">*warn-on-undefined-phase*</h2>
  <span id="var-type">var</span><br />
  <pre id="var-usage"></pre>
  <pre id="var-docstr">Flag to control output of warnings about undefined phases in calls to lift
and converge.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/admin-user">admin-user</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (admin-user user)
       (admin-user username &amp; {:keys [public-key-path private-key-path passphrase password sudo-password no-sudo], :as options})
</pre>
  <pre id="var-docstr">Set the root binding for the admin user.
The user arg is a map as returned by make-user, or a username.  When passing a
username the options can be specified as in `pallet.utils/make-user`.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/converge">converge</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (converge node-map &amp; {:keys [compute blobstore user phase prefix middleware all-nodes all-node-set], :as options})
</pre>
  <pre id="var-docstr">Converge the existing compute resources with the counts specified in
node-map.  The compute service may be supplied as an option, otherwise the
bound compute-service is used.

This applies the bootstrap phase to all new nodes, and the configure phase to
all running nodes whose tag matches a key in the node map.  Additional phases
can also be specified in the options, and will be applied to all matching
nodes.  The :configure phase is always applied, as the first (post bootstrap)
phase.  You can change the order in which the phases are applied by
explicitly listing them.

An optional tag prefix may be specified before the node-map.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/converge*">converge*</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (converge* node-map all-node-set phases request)
</pre>
  <pre id="var-docstr">Converge the node counts of each tag in node-map, executing each of the
configuration phases on all the tags in node-map. Th phase-functions are
also executed, but not applied, for any other nodes in all-node-set</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/defnode">defnode</h2>
  <span id="var-type">macro</span><br />
  <pre id="var-usage">Usage: (defnode tag doc-str? attr-map? image &amp; phasekw-phasefn-pairs)
</pre>
  <pre id="var-docstr">Define a node type.  The name is used for the node tag.

image defines the image selector template.  This is a vector of keyword or
       keyword value pairs that are used to filter the image list to select
       an image.
Options are used to define phases. Standard phases are:
  :bootstrap    run on first boot
  :configure    defines the configuration of the node.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/execute-with-local-sh">execute-with-local-sh</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (execute-with-local-sh handler)
</pre>
  <pre id="var-docstr">Middleware to execute on localhost with shell</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/lift">lift</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (lift node-set &amp; {:keys [compute phase prefix middleware all-node-set], :as options})
</pre>
  <pre id="var-docstr">Lift the running nodes in the specified node-set by applying the specified
phases.  The compute service may be supplied as an option, otherwise the
bound compute-service is used.  The configure phase is applied by default
unless other phases are specified.

node-set can be a node type, a sequence of node types, or a map
of node type to nodes. Examples:
           [node-type1 node-type2 {node-type #{node1 node2}}]
           node-type
           {node-type #{node1 node2}}

options can also be keywords specifying the phases to apply, or an immediate
phase specified with the phase macro, or a function that will be called with
each matching node.

Options:
 :compute         a jclouds compute service
 :compute-service a map of :provider, :identity, :credential, and
                  optionally :extensions for constructing a jclouds compute
                  service.
 :phase           a phase keyword, phase function, or sequence of these
 :middleware      the middleware to apply to the configuration pipeline
 :prefix          a prefix for the tag names
 :user            the admin-user on the nodes</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/lift-nodes">lift-nodes</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (lift-nodes all-nodes target-node-map all-node-map phases request)
</pre>
  <pre id="var-docstr">Lift nodes in target-node-map for the specified phases.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/make-node">make-node</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (make-node name image &amp; {:as phase-map})
</pre>
  <pre id="var-docstr">Create a node definition.  See defnode.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/name-with-attributes">name-with-attributes</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (name-with-attributes name macro-args)
</pre>
  <pre id="var-docstr">Modified version, of that found in contrib, to handle the image map.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/sequential-apply-phase">sequential-apply-phase</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (sequential-apply-phase request nodes)
</pre>
  <pre id="var-docstr">Apply a phase to a sequence of nodes</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/sequential-lift">sequential-lift</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (sequential-lift request phases target-node-map)
</pre>
  <pre id="var-docstr">Sequential apply the phases.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/show-target-keys">show-target-keys</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (show-target-keys handler)
</pre>
  <pre id="var-docstr">Middleware that is useful in debugging.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/version">version</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (version)
</pre>
  <pre id="var-docstr">Returns the pallet version.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/with-admin-user">with-admin-user</h2>
  <span id="var-type">macro</span><br />
  <pre id="var-usage">Usage: (with-admin-user user &amp; body)
       (with-admin-user [username &amp; {:keys [public-key-path private-key-path passphrase password sudo-password no-sudo], :as options}] &amp; body)
</pre>
  <pre id="var-docstr">Specify the admin user for running remote commands.  The user is specified
either as pallet.utils.User record (see the pallet.utils/make-user
convenience fn) or as an argument list that will be passed to make-user.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/with-middleware">with-middleware</h2>
  <span id="var-type">macro</span><br />
  <pre id="var-usage">Usage: (with-middleware f &amp; body)
</pre>
  <pre id="var-docstr">Wrap node execution in the given middleware. A middleware is a function of
one argument (a handler function, that is the next middleware to call) and
returns a dunction of one argument (the request map).  Middleware can be
composed with the pipe macro.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/with-target-parameters">with-target-parameters</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (with-target-parameters handler parameters)
</pre>
  <pre id="var-docstr">Middleware to set parameters based on a specified parameter map</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/wrap-local-exec">wrap-local-exec</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (wrap-local-exec _)
</pre>
  <pre id="var-docstr">Middleware to execute only local functions</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/wrap-no-exec">wrap-no-exec</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (wrap-no-exec _)
</pre>
  <pre id="var-docstr">Middleware to report on the request, without executing</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.core/wrap-with-user-credentials">wrap-with-user-credentials</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (wrap-with-user-credentials handler)
</pre>
  <pre id="var-docstr">Middleware to user the request :user credentials for SSH authentication.</pre>
  
</div>


</div>
              </div>
            </div>
          </div>
	</div>
	<div id="foot">
	  <div style="text-align: center;" id="copyright">Copyright (c) 2010 Hugo Duncan</div>
	</div>
      </div>
      <div id="DesignedBy">Logo &amp; site design by <a title="Visit Tom Hickey's website." href="http://www.tomhickey.com">Tom Hickey</a>.<br />
      Clojure auto-documentation system by Tom Faulhaber.</div>
    </div>
    <!-- /AllContentContainer -->
  </body>

</html>