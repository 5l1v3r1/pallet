<html>
  <head>
    <title>pallet.action-plan API reference (pallet)</title>
    <link href="static/favicon.png" rel="icon" />
    <link href="static/favicon.png" rel="shortcut icon" />
    <link media="all" type="text/css" href="static/clojure.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/wiki.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/internal.css" rel="stylesheet" />
    <!-- TODO: are we using these (from clojure.org)? If so, add the files -->
    <script src="file/view/code_highlighter.js" type="text/javascript"></script>
    <script src="file/view/clojure.js" type="text/javascript"></script>
    <style>.menuWrapper{height: 36px;}</style>
    <!--[if lte IE 6]>
    <link rel="stylesheet" href="http://www.wikispaces.com/_/2009051601/s/internal_ie.css" type="text/css" />
    <![endif]-->
  </head>
<!--
This document was auto-generated from the source by the clojure autodoc system.
To report errors or ask questions about the overall documentation structure, formatting,
etc., contact Tom Faulhaber (google mail name: tomfaulhaber).
For errors in the documentation of a particular namespace, contact the author of that
namespace.
-->
  <body>
    <div id="AllContentContainer">
      <div id="Header">
	<a id="Logo" href="index.html"><img alt="Clojure" height="100" width="100" src="static/clojure-icon.gif" /></a>
	<h1><a title="page header title" id="page-header" href="index.html">pallet</a></h1>
      </div>
      <div id="leftcolumn"><div style="text-align: center;"></div>
<div class="menu">
  <div class="WikiCustomNav WikiElement wiki">
    <a class="wiki_link" href="index.html">Overview</a><br />
    <a class="wiki_link" href="api-index.html">API Index</a><br />
    <a class="wiki_link" href="#">Namespaces:</a>
    <ul id="left-sidebar-list">
      <li><a href="pallet.action-api.html" class="wiki_link">pallet.action</a></li><li><a href="pallet.action-plan-api.html" class="wiki_link">pallet.action-plan</a></li><li><a href="pallet.argument-api.html" class="wiki_link">pallet.argument</a></li><li><a href="pallet.blobstore-api.html" class="wiki_link">pallet.blobstore</a></li><li><a href="pallet.command-line-api.html" class="wiki_link">pallet.command-line</a></li><li><a href="pallet.command-script-api.html" class="wiki_link">pallet.command-script</a></li><li><a href="pallet.compute-api.html" class="wiki_link">pallet.compute</a></li><li><a href="pallet.config-file.format-api.html" class="wiki_link">pallet.config-file.format</a></li><li><a href="pallet.configure-api.html" class="wiki_link">pallet.configure</a></li><li><a href="pallet.core-api.html" class="wiki_link">pallet.core</a></li><li><a href="pallet.crate-api.html" class="wiki_link">pallet.crate</a></li><li><a href="pallet.debug-api.html" class="wiki_link">pallet.debug</a></li><li><a href="pallet.enlive-api.html" class="wiki_link">pallet.enlive</a></li><li><a href="pallet.environment-api.html" class="wiki_link">pallet.environment</a></li><li><a href="pallet.execute-api.html" class="wiki_link">pallet.execute</a></li><li><a href="pallet.futures-api.html" class="wiki_link">pallet.futures</a></li><li><a href="pallet.heynote-api.html" class="wiki_link">pallet.heynote</a></li><li><a href="pallet.logging-api.html" class="wiki_link">pallet.logging</a></li><li><a href="pallet.main-api.html" class="wiki_link">pallet.main</a></li><li><a href="pallet.main-invoker-api.html" class="wiki_link">pallet.main-invoker</a></li><li><a href="pallet.maven-api.html" class="wiki_link">pallet.maven</a></li><li><a href="pallet.md5crypt-api.html" class="wiki_link">pallet.md5crypt</a></li><li><a href="pallet.parameter-api.html" class="wiki_link">pallet.parameter</a></li><li><a href="pallet.phase-api.html" class="wiki_link">pallet.phase</a></li><li><a href="pallet.repl-api.html" class="wiki_link">pallet.repl</a></li><li><a href="pallet.request-map-api.html" class="wiki_link">pallet.request-map</a></li><li><a href="pallet.resource-api.html" class="wiki_link">pallet.resource</a></li><li><a href="pallet.session-api.html" class="wiki_link">pallet.session</a></li><li><a href="pallet.shell-api.html" class="wiki_link">pallet.shell</a></li><li><a href="pallet.strint-api.html" class="wiki_link">pallet.strint</a></li><li><a href="pallet.target-api.html" class="wiki_link">pallet.target</a></li><li><a href="pallet.task.add-service-api.html" class="wiki_link">pallet.task.add-service</a></li><li><a href="pallet.task.containers-api.html" class="wiki_link">pallet.task.containers</a></li><li><a href="pallet.task.converge-api.html" class="wiki_link">pallet.task.converge</a></li><li><a href="pallet.task.converge-cluster-api.html" class="wiki_link">pallet.task.converge-cluster</a></li><li><a href="pallet.task.describe-node-api.html" class="wiki_link">pallet.task.describe-node</a></li><li><a href="pallet.task.destroy-cluster-api.html" class="wiki_link">pallet.task.destroy-cluster</a></li><li><a href="pallet.task.feedback-api.html" class="wiki_link">pallet.task.feedback</a></li><li><a href="pallet.task.help-api.html" class="wiki_link">pallet.task.help</a></li><li><a href="pallet.task.lift-api.html" class="wiki_link">pallet.task.lift</a></li><li><a href="pallet.task.new-project-api.html" class="wiki_link">pallet.task.new-project</a></li><li><a href="pallet.task.nodes-api.html" class="wiki_link">pallet.task.nodes</a></li><li><a href="pallet.task.providers-api.html" class="wiki_link">pallet.task.providers</a></li><li><a href="pallet.task.to-blob-api.html" class="wiki_link">pallet.task.to-blob</a></li><li><a href="pallet.task.version-api.html" class="wiki_link">pallet.task.version</a></li><li><a href="pallet.template-api.html" class="wiki_link">pallet.template</a></li><li><a href="pallet.utils-api.html" class="wiki_link">pallet.utils</a></li>
    </ul>
  </div>
</div>
</div>
      <div id="rightcolumn">
	<div id="Content">
	  <div class="contentBox"><div class="innerContentBox">
              <div id="content_view" class="wiki wikiPage">
                <div id="right-sidebar"><div id="toc">
  <h1 class="nopad">Table of Contents</h1>
  <div style="margin-left: 1em;" class="toc-section">
    <a href="#toc0">Overview</a>
    <div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/action-dependencies">action-dependencies</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/action-instances">action-instances</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/action-map">action-map</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/add-action">add-action</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/augment-return">augment-return</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/bind-action-arguments">bind-action-arguments</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/collect-action-id">collect-action-id</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/combine-actions">combine-actions</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/execute">execute</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/execute-action">execute-action</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/merge-union">merge-union</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/pop-block">pop-block</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/push-block">push-block</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/reset-for-target">reset-for-target</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/script-template">script-template</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/script-template-for-server">script-template-for-server</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/target-path">target-path</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/transform-nested-scopes">transform-nested-scopes</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/translate">translate</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet.action-plan/translated?">translated?</a>
    </div>
    <br />
  </div>
</div>
</div>
                <div id="content-tag"><h1 id="overview">API for <span id="namespace-name">pallet.action-plan</span></h1>
by <span id="author">Hugo Duncan</span><br />
<br />Usage:
<pre>
(ns your-namespace
  (:require <span id="long-name">pallet.action-plan</span>))
</pre><pre>
</pre><h2>Overview</h2>
<pre id="namespace-docstr">An action plan contains actions for execution.

The action plan is built by executing a phase function. Each phase function
calls actions which insert themselves into the action plan.

The action plan is transformed to provide aggregated operations, and to
resolve precedence relations between actions.

A translated plan is executed by passing an executor, which is a map
from action type to function.  The executor functions are called with the
result of evaluating the action with it's arguments.</pre>
<br />
<h2>Public Variables and Functions</h2>
<div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/action-dependencies">action-dependencies</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (action-dependencies action-id-map action)
</pre>
  <pre id="var-docstr">Extract an action's dependencies.  Actions are id'd with keywords,
and dependencies are declared on an action's id or function.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/action-instances">action-instances</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (action-instances actions dependencies)
</pre>
  <pre id="var-docstr">Given a map of dependencies, each with an :f and maybe a :action-id,
returns a map where the values are all matching action instances</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/action-map">action-map</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (action-map action-fn precedence args execution action-type location)
</pre>
  <pre id="var-docstr">Return an action map for the given args. The action plan is a tree of
action maps.

precedence specifies naming and dependencies, with :action-id, :always-before
and :always-after. If a precedence is supplied, an action-id is generated
if none present, to ensure that the standard action precedence is not
altered.

- :f            the action function
- :args         the arguments to pass to the action function
- :location     where to execute the action - :orgin or :target
- :action-type  the type of action - :script/bash, :fn/clojure, etc
- :execution    the execution type - :in-sequence, :aggregated, :collected
- :value        the result of calling the action function, :f, with :args
- :session      the session map after calling the action function.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/add-action">add-action</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (add-action action-plan action)
</pre>
  <pre id="var-docstr">Add an action to the plan</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/augment-return">augment-return</h2>
  <span id="var-type">multimethod</span><br />
  <pre id="var-usage">No usage documentation available</pre>
  <pre id="var-docstr">Change the return type of an action, to be an action map with
:value and :session keys that are the value of the action, and the updated
session map for the next action.  This creates a consistent return value for
all action types (effectively creating a monadic value which is a map).</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/bind-action-arguments">bind-action-arguments</h2>
  <span id="var-type">multimethod</span><br />
  <pre id="var-usage">No usage documentation available</pre>
  <pre id="var-docstr">Bind an action's arguments.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/collect-action-id">collect-action-id</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (collect-action-id m action)
</pre>
  <pre id="var-docstr">Extract an action's id to function mapping</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/combine-actions">combine-actions</h2>
  <span id="var-type">multimethod</span><br />
  <pre id="var-usage">No usage documentation available</pre>
  <pre id="var-docstr">Combine actions by action-type</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/execute">execute</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (execute action-plan session executor)
</pre>
  <pre id="var-docstr">Execute actions by passing the un-evaluated actions to the `executor`
function (a function with an arglist of [session f action-type location]).</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/execute-action">execute-action</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (execute-action executor [results session] {:keys [f action-type location], :as action})
</pre>
  <pre id="var-docstr">Execute a single action</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/merge-union">merge-union</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (merge-union &amp; m)
</pre>
  <pre id="var-docstr">Merge-with clojure.set/union</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/pop-block">pop-block</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (pop-block action-plan)
</pre>
  <pre id="var-docstr">Take the last block and add it to the scope below it in the stack.
The block is reversed to put it into the order in which elements
were added. Once pop'd, nothing should be added to the block.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/push-block">push-block</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (push-block action-plan)
</pre>
  <pre id="var-docstr">Push a block onto the action-plan</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/reset-for-target">reset-for-target</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (reset-for-target session)
</pre>
  <pre id="var-docstr">Reset the action plan for the current phase and target node.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/script-template">script-template</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (script-template session)
</pre>
  <pre id="var-docstr">Return the script template for the current group node.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/script-template-for-server">script-template-for-server</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (script-template-for-server server)
</pre>
  <pre id="var-docstr">Return the script template for the specified server.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/target-path">target-path</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (target-path session)
</pre>
  <pre id="var-docstr">Return the vector path of the action plan for the current session target
node.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/transform-nested-scopes">transform-nested-scopes</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (transform-nested-scopes action-plan)
</pre>
  <pre id="var-docstr">Traverses an action-plan structure. Converting nested scopes into
action-map's.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/translate">translate</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (translate action-plan)
</pre>
  <pre id="var-docstr">Process the action-plan, applying groupings and precedence, producing
an action plan with fully bound functions, ready for execution.

This is equivalent to using an identity monad with a monadic value
that is a tree of action maps.</pre>
  
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet.action-plan/translated?">translated?</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (translated? action-plan)
</pre>
  <pre id="var-docstr">Predicate to test if an action plan has been translated</pre>
  
</div>


</div>
              </div>
            </div>
          </div>
	</div>
	<div id="foot">
	  <div style="text-align: center;" id="copyright">Copyright (c) 2010 Hugo Duncan</div>
	</div>
      </div>
      <div id="DesignedBy">Logo &amp; site design by <a title="Visit Tom Hickey's website." href="http://www.tomhickey.com">Tom Hickey</a>.<br />
      Clojure auto-documentation system by Tom Faulhaber.</div>
    </div>
    <!-- /AllContentContainer -->
  </body>

</html>