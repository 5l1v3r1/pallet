<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
lang="en" xml:lang="en">
<head>
<title>Pallet</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2010-06-17 Thu"/>
<meta name="author" content="Hugo Duncan"/>
<meta name="description" content="Pallet is a node provisioning, configuration and administration tool."/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="doc.css" />
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">

<h1 class="title">Pallet</h1>


<p>
Pallet is a node provisioning, configuration and administration tool.  It is
written in <a href="http://clojure.org">Clojure</a>, and runs on the JVM.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Overview </a>
<ul>
<li><a href="#sec-1_1">1.1 Features </a>
<ul>
<li><a href="#sec-1_1_1">1.1.1 No Dependencies </a></li>
<li><a href="#sec-1_1_2">1.1.2 No Server </a></li>
<li><a href="#sec-1_1_3">1.1.3 Everything in Version Control </a></li>
<li><a href="#sec-1_1_4">1.1.4 Jar File Distribution of Crates </a></li>
<li><a href="#sec-1_1_5">1.1.5 Provisioning, Configuration and Administration </a></li>
</ul>
</li>
<li><a href="#sec-1_2">1.2 How it works </a></li>
<li><a href="#sec-1_3">1.3 Related Projects </a>
<ul>
<li><a href="#sec-1_3_1">1.3.1 Configuration </a></li>
<li><a href="#sec-1_3_2">1.3.2 Node Provisioning </a></li>
<li><a href="#sec-1_3_3">1.3.3 Application Services </a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-2">2 First Steps </a>
<ul>
<li><a href="#sec-2_1">2.1 Overview </a></li>
<li><a href="#sec-2_2">2.2 Install </a>
<ul>
<li><a href="#sec-2_2_1">2.2.1 Source </a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-3">3 Talking to the cloud </a>
<ul>
<li><a href="#sec-3_1">3.1 Cloud Provider Names </a></li>
<li><a href="#sec-3_2">3.2 Explicit credentials </a></li>
<li><a href="#sec-3_3">3.3 Credentials in settings.xml </a></li>
</ul>
</li>
<li><a href="#sec-4">4 Node Types </a>
<ul>
<li><a href="#sec-4_1">4.1 Tags </a></li>
<li><a href="#sec-4_2">4.2 Image Templates </a></li>
</ul>
</li>
<li><a href="#sec-5">5 Phases </a>
<ul>
<li><a href="#sec-5_1">5.1 :bootstrap </a></li>
<li><a href="#sec-5_2">5.2 :configure </a></li>
</ul>
</li>
<li><a href="#sec-6">6 Operations </a>
<ul>
<li><a href="#sec-6_1">6.1 Converge </a></li>
<li><a href="#sec-6_2">6.2 Lift </a></li>
</ul>
</li>
<li><a href="#sec-7">7 Crates </a>
<ul>
<li><a href="#sec-7_1">7.1 Composing existing crates </a></li>
<li><a href="#sec-7_2">7.2 Creating resources </a></li>
<li><a href="#sec-7_3">7.3 Aggregate resource </a></li>
<li><a href="#sec-7_4">7.4 Local resources </a></li>
<li><a href="#sec-7_5">7.5 Parameters </a></li>
<li><a href="#sec-7_6">7.6 Delayed Arguments </a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Overview </h2>
<div class="outline-text-2" id="text-1">


<p>
What makes pallet different to some of the other tools out there?
</p>

</div>

<div id="outline-container-1_1" class="outline-3">
<h3 id="sec-1_1"><span class="section-number-3">1.1</span> Features </h3>
<div class="outline-text-3" id="text-1_1">


</div>

<div id="outline-container-1_1_1" class="outline-4">
<h4 id="sec-1_1_1"><span class="section-number-4">1.1.1</span> No Dependencies </h4>
<div class="outline-text-4" id="text-1_1_1">


<p>
The machines being managed require no special dependencies to be installed. As
long as they have bash and ssh running, they can be used with pallet.  For me
this was important - it means that you can use pretty much any image out there,
which is great for ad-hoc testing and development.
</p>
</div>

</div>

<div id="outline-container-1_1_2" class="outline-4">
<h4 id="sec-1_1_2"><span class="section-number-4">1.1.2</span> No Server </h4>
<div class="outline-text-4" id="text-1_1_2">


<p>
Pallet has no central server to set up and maintain - it simply runs on
demand. You can run it from anywhere, even over a remote REPL connection.
</p>
</div>

</div>

<div id="outline-container-1_1_3" class="outline-4">
<h4 id="sec-1_1_3"><span class="section-number-4">1.1.3</span> Everything in Version Control </h4>
<div class="outline-text-4" id="text-1_1_3">


<p>
In pallet, all your configuration is handled in SCM controlled files - there is
no database involved.  This means that your configuration can always be kept in
step with the development of your crates, and the versions of the external
crates that you use.
</p>
</div>

</div>

<div id="outline-container-1_1_4" class="outline-4">
<h4 id="sec-1_1_4"><span class="section-number-4">1.1.4</span> Jar File Distribution of Crates </h4>
<div class="outline-text-4" id="text-1_1_4">


<p>
Custom crates can be distributed as jar files, and so can be published in maven
repositories, and be consumed in a version controlled manner.  Hopefully this
will promote shared crates.
</p>
</div>

</div>

<div id="outline-container-1_1_5" class="outline-4">
<h4 id="sec-1_1_5"><span class="section-number-4">1.1.5</span> Provisioning, Configuration and Administration </h4>
<div class="outline-text-4" id="text-1_1_5">


<p>
Pallet aims quite wide. You can use it for starting an stopping nodes, for
configuring nodes, deploying projects and also for running administration tasks.
To be honest, this wasn't an initial design goal, but has come out of the wash
that way.
</p>
</div>
</div>

</div>

<div id="outline-container-1_2" class="outline-3">
<h3 id="sec-1_2"><span class="section-number-3">1.2</span> How it works </h3>
<div class="outline-text-3" id="text-1_2">


<p>
Pallet is written in <a href="http://clojure.org">Clojure</a>, and so runs in a JVM.  You can embed it in any JVM
based project, or use it directly at the REPL.
</p>
<p>
Pallet talks to a cloud provider, in order to start up new nodes, etc.  It does
this using the excellent <a href="http://jclouds.org">jclouds</a> library.  Once the nodes are running,
Pallet uses SSH to communicate with the nodes.
</p>
<p>
To execute actions on the nodes, pallet executes shell scripts.  These scripts
are generated in <a href="http://clojure.org">Clojure</a>.  At the lowest level, Pallet embeds shell script
in <a href="http://clojure.org">Clojure</a>, and wraps shell script fragments into <a href="http://clojure.org">Clojure</a> functions,
creating reusable resources.
</p>
<p>
Of course, no two operating systems are identical, so Pallet allows dispatching
of the functions based on packager, etc, enabling abstraction of a node's
operating system.
</p>
<p>
Higher level "crates" are then put together, that use the resources to install
packages, etc. Crates can also be implemented using the same machinery as
resource functions.
</p>
<p>
<a href="#sec-1_2">Node types</a> are defined that specify a tag and the sequence of crates to apply
for each of a number of phases. By default, pallet defines <code>:bootstrap</code> and
<code>:configure</code> phases, but you can add as many phases as you like
(e.g. <code>:backup</code>).
</p>
<p>
Phases are executed using either the <code>converge</code> or <code>lift</code> commands, with
<code>converge</code> also adjusting the number of nodes running for each tag.
</p>

</div>

</div>

<div id="outline-container-1_3" class="outline-3">
<h3 id="sec-1_3"><span class="section-number-3">1.3</span> Related Projects </h3>
<div class="outline-text-3" id="text-1_3">



</div>

<div id="outline-container-1_3_1" class="outline-4">
<h4 id="sec-1_3_1"><span class="section-number-4">1.3.1</span> Configuration </h4>
<div class="outline-text-4" id="text-1_3_1">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">Project Name</th><th scope="col">Link</th></tr>
</thead>
<tbody>
<tr><td>Chef</td><td><a href="http://wiki.opscode.com/display/chef/Home">http://wiki.opscode.com/display/chef/Home</a></td></tr>
<tr><td>Puppet</td><td><a href="http://www.puppetlabs.com/">http://www.puppetlabs.com/</a></td></tr>
<tr><td>cfengine</td><td><a href="http://www.cfengine.org">http://www.cfengine.org</a></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1_3_2" class="outline-4">
<h4 id="sec-1_3_2"><span class="section-number-4">1.3.2</span> Node Provisioning </h4>
<div class="outline-text-4" id="text-1_3_2">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">Project Name</th><th scope="col">Link</th></tr>
</thead>
<tbody>
<tr><td>jClouds</td><td><a href="http://www.jclouds.org/ ">http://www.jclouds.org/ </a></td></tr>
<tr><td>fog</td><td><a href="http://github.com/geemus/fog">http://github.com/geemus/fog</a></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-1_3_3" class="outline-4">
<h4 id="sec-1_3_3"><span class="section-number-4">1.3.3</span> Application Services </h4>
<div class="outline-text-4" id="text-1_3_3">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption></caption>
<colgroup><col align="left" /><col align="left" />
</colgroup>
<thead>
<tr><th scope="col">Project Name</th><th scope="col">Link</th></tr>
</thead>
<tbody>
<tr><td>Capistrano</td><td></td></tr>
<tr><td>Fabric</td><td></td></tr>
<tr><td>Func</td><td></td></tr>
</tbody>
</table>



<p>
If you have a project that you would like included above, I'll be happy to add it.
</p>
</div>
</div>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> First Steps </h2>
<div class="outline-text-2" id="text-2">


</div>

<div id="outline-container-2_1" class="outline-3">
<h3 id="sec-2_1"><span class="section-number-3">2.1</span> Overview </h3>
<div class="outline-text-3" id="text-2_1">


<p>
The simplest way to start pallet (but definitely not the nicest) is with a git
checkout of the source and maven (see below).
</p>



<div class="org-src-container"><label class="org-src-name">def-service()</label><pre class="src src-clojure">
(<span style="color: #0000ff;">require</span> 'pallet.maven)
(<span style="color: #0000ff;">require</span> 'org.jclouds.compute)
(<span style="color: #4682b4;">def</span> <span style="color: #0000ff;">service</span>
     (<span style="color: #0000ff;">apply</span> org.jclouds.compute/compute-service
      (<span style="color: #0000ff;">concat</span> (pallet.maven/credentials) [<span style="color: #0000ff;">:log4j</span> <span style="color: #0000ff;">:enterprise</span> <span style="color: #0000ff;">:ssh</span>])))
</pre></div>





</div>

</div>

<div id="outline-container-2_2" class="outline-3">
<h3 id="sec-2_2"><span class="section-number-3">2.2</span> Install </h3>
<div class="outline-text-3" id="text-2_2">


<p>
Pallet can be used in projects as a jar file.  It is available at <a href="http://clojars.org/pallet">Clojars</a>, and
can be used with maven, leiningen or any maven repository aware tool.
</p>



<pre class="src src-clojure">(<span style="color: #4682b4;">def</span> <span style="color: #0000ff;">service</span>
     (<span style="color: #0000ff;">apply</span> org.jclouds.compute/compute-service
      (<span style="color: #0000ff;">concat</span> (pallet.maven/credentials) [<span style="color: #0000ff;">:log4j</span> <span style="color: #0000ff;">:enterprise</span> <span style="color: #0000ff;">:ssh</span>])))
</pre>






</div>

<div id="outline-container-2_2_1" class="outline-4">
<h4 id="sec-2_2_1"><span class="section-number-4">2.2.1</span> Source </h4>
<div class="outline-text-4" id="text-2_2_1">

<p>Pallet is available on <a href="http://github.com/hugoduncan/pallet">github</a>. Pallet requires <a href="http://clojure.org/">Clojure 1.2</a>, and uses <a href="http://github.com/jclouds/jclouds">JClouds</a>.
</p>



<pre class="src src-sh">git clone git://github.com/hugoduncan/pallet.git
</pre>



<p>
You can start a REPL using maven.  At this time lein can not be used to start a
REPL.
</p>



<pre class="src src-sh">mvn clojure:repl
</pre>



<p>
Using lein or maven you can also start a swank session, and connect to it with
Emacs, etc.
</p>



<pre class="src src-sh">mvn clojure:swank -Dmaven.test.skip=true
</pre>




<pre class="src src-sh">lein swank
</pre>







</div>
</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Talking to the cloud </h2>
<div class="outline-text-2" id="text-3">


<p>
Pallet uses <a href="http://jclouds.org">jclouds</a> to create, start and stop nodes.  In order to use the cloud,
you will need to specify your cloud credentials.  Each cloud has a slightly
different terminology for the username/key and password/secret.
</p>

</div>

<div id="outline-container-3_1" class="outline-3">
<h3 id="sec-3_1"><span class="section-number-3">3.1</span> Cloud Provider Names </h3>
<div class="outline-text-3" id="text-3_1">


<p>
In order to sign in to your cloud API, you will need to tell pallet the name of
your cloud.  The names pallet recognises can be displayed with the following:
</p>



<pre class="src src-clojure">(<span style="color: #0000ff;">require</span> 'pallet.compute)
(pallet.compute/supported-clouds)
</pre>



</div>

</div>

<div id="outline-container-3_2" class="outline-3">
<h3 id="sec-3_2"><span class="section-number-3">3.2</span> Explicit credentials </h3>
<div class="outline-text-3" id="text-3_2">


<p>
You can log in to the cloud explicitly
</p>



<div class="org-src-container"><label class="org-src-name">explicit-credentials()</label><pre class="src src-clojure">
(<span style="color: #0000ff;">require</span> 'org.jclouds.compute)
(<span style="color: #4682b4;">defn</span> <span style="color: #0000ff;">service</span> []
  (org.jclouds.compute/compute-service
   <span style="color: #f4a460;">"provider"</span> <span style="color: #f4a460;">"username"</span> <span style="color: #f4a460;">"password"</span> <span style="color: #0000ff;">:log4j</span> <span style="color: #0000ff;">:enterprise</span> <span style="color: #0000ff;">:ssh</span>))
</pre></div>



</div>

</div>

<div id="outline-container-3_3" class="outline-3">
<h3 id="sec-3_3"><span class="section-number-3">3.3</span> Credentials in settings.xml </h3>
<div class="outline-text-3" id="text-3_3">


<p>
Settings.xml is a maven file, often used to hold user specific configuration for
maven.  You can add your cloud provider information to this file, which is
normally located at <a href="/Users/duncan/.m2/settings.xml">~/.m2/settings.xml</a>.
</p>



<pre class="src src-nxml"><span style="color: #00cd00;">&lt;</span><span style="color: #5f9ea0;">settings</span><span style="color: #00cd00;">&gt;</span>
  <span style="color: #00cd00;">&lt;</span><span style="color: #5f9ea0;">profiles</span><span style="color: #00cd00;">&gt;</span>
    <span style="color: #00cd00;">&lt;</span><span style="color: #5f9ea0;">profile</span><span style="color: #00cd00;">&gt;</span>
      <span style="color: #00cd00;">&lt;</span><span style="color: #5f9ea0;">id</span><span style="color: #00cd00;">&gt;</span>terremark<span style="color: #00cd00;">&lt;</span><span style="color: #00cd00;">/</span><span style="color: #5f9ea0;">id</span><span style="color: #00cd00;">&gt;</span>
      <span style="color: #00cd00;">&lt;</span><span style="color: #5f9ea0;">activation</span><span style="color: #00cd00;">&gt;</span>
        <span style="color: #00cd00;">&lt;</span><span style="color: #5f9ea0;">activeByDefault</span><span style="color: #00cd00;">&gt;</span>true<span style="color: #00cd00;">&lt;</span><span style="color: #00cd00;">/</span><span style="color: #5f9ea0;">activeByDefault</span><span style="color: #00cd00;">&gt;</span>
      <span style="color: #00cd00;">&lt;</span><span style="color: #00cd00;">/</span><span style="color: #5f9ea0;">activation</span><span style="color: #00cd00;">&gt;</span>
      <span style="color: #00cd00;">&lt;</span><span style="color: #5f9ea0;">properties</span><span style="color: #00cd00;">&gt;</span>
        <span style="color: #00cd00;">&lt;</span><span style="color: #5f9ea0;">pallet.service</span><span style="color: #00cd00;">&gt;</span>Your Cloud serivce name<span style="color: #00cd00;">&lt;</span><span style="color: #00cd00;">/</span><span style="color: #5f9ea0;">pallet.service</span><span style="color: #00cd00;">&gt;</span>
        <span style="color: #00cd00;">&lt;</span><span style="color: #5f9ea0;">pallet.user</span><span style="color: #00cd00;">&gt;</span>Your Cloud API username or key<span style="color: #00cd00;">&lt;</span><span style="color: #00cd00;">/</span><span style="color: #5f9ea0;">pallet.user</span><span style="color: #00cd00;">&gt;</span>
        <span style="color: #00cd00;">&lt;</span><span style="color: #5f9ea0;">pallet.key</span><span style="color: #00cd00;">&gt;</span>Your Cloud API secret or password<span style="color: #00cd00;">&lt;</span><span style="color: #00cd00;">/</span><span style="color: #5f9ea0;">pallet.key</span><span style="color: #00cd00;">&gt;</span>
      <span style="color: #00cd00;">&lt;</span><span style="color: #00cd00;">/</span><span style="color: #5f9ea0;">properties</span><span style="color: #00cd00;">&gt;</span>
    <span style="color: #00cd00;">&lt;</span><span style="color: #00cd00;">/</span><span style="color: #5f9ea0;">profile</span><span style="color: #00cd00;">&gt;</span>
  <span style="color: #00cd00;">&lt;</span><span style="color: #00cd00;">/</span><span style="color: #5f9ea0;">profiles</span><span style="color: #00cd00;">&gt;</span>
<span style="color: #00cd00;">&lt;</span><span style="color: #00cd00;">/</span><span style="color: #5f9ea0;">settings</span><span style="color: #00cd00;">&gt;</span>
</pre>



<p>
You can then use this information with pallet:
</p>



<pre class="src src-clojure">(<span style="color: #0000ff;">require</span> 'pallet.maven)
(<span style="color: #4682b4;">def</span> <span style="color: #0000ff;">service</span>
     (<span style="color: #0000ff;">apply</span> org.jclouds.compute/compute-service
            (<span style="color: #0000ff;">concat</span> (pallet.maven/credentials) [<span style="color: #0000ff;">:log4j</span> <span style="color: #0000ff;">:enterprise</span> <span style="color: #0000ff;">:ssh</span>])))
</pre>



</div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Node Types </h2>
<div class="outline-text-2" id="text-4">


<p>
In pallet, node types are defined with <code>defnode</code>.  The minimum requirement is
for a tag and an empty image template specification.
</p>



<pre class="src src-clojure">(<span style="color: #0000ff;">require</span> 'pallet.core)
(pallet.core/defnode mytag [])
</pre>



<p>
An empty template specification implies a default image will be used for the
nodes, usually the latest Ubuntu version, or CentOS if no Ubuntu images are
available.
</p>

</div>

<div id="outline-container-4_1" class="outline-3">
<h3 id="sec-4_1"><span class="section-number-3">4.1</span> Tags </h3>
<div class="outline-text-3" id="text-4_1">


<p>
In pallet, tags are used to identify identically configured machines.  The
<code>converge</code> command can be used to control the number of machines running with
each tag, allowing simple cluster management. Tag names may not contain hyphens.
</p>
<p>
Tags are used to select the nodes targeted by a <code>converge</code> or <code>lift</code> operation.
</p>
</div>

</div>

<div id="outline-container-4_2" class="outline-3">
<h3 id="sec-4_2"><span class="section-number-3">4.2</span> Image Templates </h3>
<div class="outline-text-3" id="text-4_2">


<p>
The image used for a node can be specified by using JCloud's template
mechanism.  The image template in <code>defnode</code> is exactly as for jclouds clojure API.
</p>
</div>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Phases </h2>
<div class="outline-text-2" id="text-5">


<p>
A phase specifies a sequence of crates to be executed.  A phase can be defined
as part of a <a href="#sec-1_2">node type</a>, or inline in a <code>configure</code> or <code>lift</code> invocation, using
the <code>phase</code> macro.
</p>

</div>

<div id="outline-container-5_1" class="outline-3">
<h3 id="sec-5_1"><span class="section-number-3">5.1</span> :bootstrap </h3>
<div class="outline-text-3" id="text-5_1">


<p>
The <code>:bootstrap</code> phase is applied whenever pallet starts a new node.
</p>
</div>

</div>

<div id="outline-container-5_2" class="outline-3">
<h3 id="sec-5_2"><span class="section-number-3">5.2</span> :configure </h3>
<div class="outline-text-3" id="text-5_2">


<p>
The <code>:configue</code> phase is applied by default by both the <code>converge</code> and the
<code>lift</code> commands.
</p>

</div>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Operations </h2>
<div class="outline-text-2" id="text-6">


</div>

<div id="outline-container-6_1" class="outline-3">
<h3 id="sec-6_1"><span class="section-number-3">6.1</span> Converge </h3>
<div class="outline-text-3" id="text-6_1">


<p>
The <code>converge</code> function can be used to adjust node counts and to apply phases.
The <code>:bootstrap</code> phase is the first phase applied to any new node that is
started, and <code>:configure</code> is always applied.  Additional phases may also be
specified. If the <code>:configure</code> phase is not explicitly passed, then it will
always be applied as the first phase (or second, after <code>:bootstrap</code> on new
nodes).
</p>



<pre class="src src-clojure">(<span style="color: #0000ff;">require</span> 'pallet.core)
(pallet.core/defnode mytag [])

(<span style="color: #4682b4;">defn</span> <span style="color: #0000ff;">scale-cluster</span> [n]
  (pallet.core/converge {mytag n}))
</pre>



<p>
<code>converge</code> also accepts a prefix, which is applied to the tags in the call.
This can be used to build job specific clusters.
</p>



<pre class="src src-clojure">(<span style="color: #0000ff;">require</span> 'pallet.core)
(pallet.core/defnode lb [] <span style="color: #0000ff;">:configure</span> [])
(pallet.core/defnode webapp [] <span style="color: #0000ff;">:configure</span> [])
(pallet.core/defnode db [] <span style="color: #0000ff;">:configure</span> [])

(<span style="color: #4682b4;">defn</span> <span style="color: #0000ff;">scale-cluster</span> [prefix n]
  (pallet.core/converge prefix {lb 1 webapp n db (<span style="color: #0000ff;">inc</span> (<span style="color: #0000ff;">/</span> n 2))}))
</pre>



</div>

</div>

<div id="outline-container-6_2" class="outline-3">
<h3 id="sec-6_2"><span class="section-number-3">6.2</span> Lift </h3>
<div class="outline-text-3" id="text-6_2">


<p>
The <code>lift</code> function is used to apply phases. The :configure phase is run by
default only if no phases are explicitly specified.
</p>
</div>
</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Crates </h2>
<div class="outline-text-2" id="text-7">

<p>Crates are functions that encapsulate some unit of configuration or
administration. Crates can take arguments.
</p>

</div>

<div id="outline-container-7_1" class="outline-3">
<h3 id="sec-7_1"><span class="section-number-3">7.1</span> Composing existing crates </h3>
<div class="outline-text-3" id="text-7_1">

<p>The simplest way of creating a crate is to compose it from existing crates.
</p>



<pre class="src src-clojure">(<span style="color: #0000ff;">require</span> 'pallet.resource.package)
(<span style="color: #0000ff;">require</span> 'pallet.crate.git)
(<span style="color: #0000ff;">require</span> 'pallet.crate.tomcat)

(<span style="color: #4682b4;">defn</span> <span style="color: #0000ff;">my-simple-config</span>
  []
  (pallet.resource.package/package <span style="color: #f4a460;">"maven2"</span>)
  (pallet.crate.git/git)
  (pallet.crate.tomcat/tomcat))
</pre>



</div>

</div>

<div id="outline-container-7_2" class="outline-3">
<h3 id="sec-7_2"><span class="section-number-3">7.2</span> Creating resources </h3>
<div class="outline-text-3" id="text-7_2">

<p><code>defresource</code> can be used to define crates that rely on node specific details.
</p>
</div>

</div>

<div id="outline-container-7_3" class="outline-3">
<h3 id="sec-7_3"><span class="section-number-3">7.3</span> Aggregate resource </h3>
<div class="outline-text-3" id="text-7_3">


<p>
<code>defaggregate</code> can be used to define crates that collect parameters over
multiple invocations and emit a resource based on the aggregated parameters.
This is used in the sudoers crate, for example, to emit /etc/sudoers.
</p>
</div>

</div>

<div id="outline-container-7_4" class="outline-3">
<h3 id="sec-7_4"><span class="section-number-3">7.4</span> Local resources </h3>
<div class="outline-text-3" id="text-7_4">

<p><code>deflocal</code> defines a crate that will be run on the local machine.
</p></div>

</div>

<div id="outline-container-7_5" class="outline-3">
<h3 id="sec-7_5"><span class="section-number-3">7.5</span> Parameters </h3>
<div class="outline-text-3" id="text-7_5">

</div>

</div>

<div id="outline-container-7_6" class="outline-3">
<h3 id="sec-7_6"><span class="section-number-3">7.6</span> Delayed Arguments </h3>
<div class="outline-text-3" id="text-7_6">

</div>
</div>
</div>
<div id="postamble">
<p class="author"> Author: Hugo Duncan
</p>
<p class="date"> Date: 2010-06-17 Thu</p>
<p class="creator">HTML generated by org-mode 6.36trans in emacs 24</p>
</div>
</div>
</body>
</html>
