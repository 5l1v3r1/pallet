<html>
  <head>
    <title>Pallet - Overview</title>
    <link href="static/favicon.png" rel="icon" />
    <link href="static/favicon.png" rel="shortcut icon" />
    <link media="all" type="text/css" href="static/clojure.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/wiki.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/internal.css" rel="stylesheet" />
    <!-- TODO: are we using these (from clojure.org)? If so, add the files -->
    <script src="file/view/code_highlighter.js" type="text/javascript"></script>
    <script src="file/view/clojure.js" type="text/javascript"></script>
    <style>.menuWrapper{height: 36px;}</style>
    <!--[if lte IE 6]>
    <link rel="stylesheet" href="http://www.wikispaces.com/_/2009051601/s/internal_ie.css" type="text/css" />
    <![endif]-->
  </head>
<!--
This document was auto-generated from the source by the clojure autodoc system.
To report errors or ask questions about the overall documentation structure, formatting,
etc., contact Tom Faulhaber (google mail name: tomfaulhaber).
For errors in the documentation of a particular namespace, contact the author of that
namespace.
-->
  <body>
    <div id="AllContentContainer">
      <div id="Header">
	<a id="Logo" href="index.html"><img alt="Clojure" height="100" width="100" src="static/clojure-icon.gif" /></a>
	<h1><a title="page header title" id="page-header" href="index.html">Pallet</a></h1>
      </div>
      <div id="leftcolumn"><div style="text-align: center;"></div>
<div class="menu">
  <div class="WikiCustomNav WikiElement wiki">
    <a class="wiki_link" href="index.html">Overview</a><br />
    <a class="wiki_link" href="api-index.html">API Index</a><br />
    <a class="wiki_link" href="#">Namespaces:</a>
    <ul id="left-sidebar-list">
      <li><a href="demo-api.html" class="wiki_link">demo</a></li><li><a href="pallet-api.html" class="wiki_link">pallet</a></li>
    </ul>
  </div>
</div>
</div>
      <div id="rightcolumn">
	<div id="Content">
	  <div class="contentBox"><div class="innerContentBox">
              <div id="content_view" class="wiki wikiPage">
                <div id="right-sidebar"><div id="toc">
  <h1 class="nopad">Table of Contents</h1>
  <div style="margin-left: 1em;" class="toc-section">
    <a href="#demo">demo</a>
    
    <br />
  </div><div style="margin-left: 1em;" class="toc-section">
    <a href="#pallet">pallet</a>
    
    <br />
  </div>
</div>
</div>
                <div id="content-tag"><h1 id="toc0">An Overview of the <span id="header-project">Pallet</span> API</h1>
<br />
<div id="project-description">Pallet is used to start provision compute nodes using jclouds and chef.</div>
<br />
<div id="namespace-entry">
  <br />
  <hr />
  <h2 id="demo">demo</h2>
  by <span id="author">Hugo Duncan</span><br />
  <a href="demo-api.html" id="api-link">Detailed API documentation</a><br />
  <pre id="namespace-docstr">A demo for pallet + jclouds.

;; First we load the demo package, and switch to the demo namespace
(require 'demo)
(in-ns 'demo)

;; Supported providers can be found with
(supported-clouds)

;; We provide some credentials
(def my-user "your user")
(def my-password "your api key")

;; and log in to the cloud using the credentials defined above.
;; provider is a string specifiying the provider, as returned
;; from (supported-clouds)
(def service (compute-service "provider" my-user my-password :log4j))

;; nodes can be listed with the nodes function
(nodes service)

;; the compute service can also be bound
(with-compute-service [service]
  (nodes))

;; or even
(with-compute-service ["provider" my-user my-password :log4j]
  (nodes))

;; We can create a node, by specifying a name tag and a template.
;; webserver-template is a vector specifying features we want in
;; our image.
(start-node service :webserver webserver-template)

;; At this point we can manage instance counts as a map.
;; e.g ensure that we have two webserver nodes
(with-node-templates templates
  (converge service {:webserver 2}))

;; ... and we can remove our nodes
(with-node-templates templates
  (converge service {:webserver 0}))

;; templates is a description of the images to use for each of
;; our node tags
templates

;; Images are configured differently between clouds and os's.
;; Pallet comes with some "crates" that can be used to normalise
;; the images.  public-dns-if-no-nameserver ensures there is a
;; nameserver if none is already configured.
;; We probably want an admin user. The default is to use your current login
;; name, with no password and your id_rsa ssh key.
(with-node-templates templates
  (converge service {:webserver 1}
    (bootstrap-with (public-dns-if-no-nameserver)
                    (bootstrap-admin-user))))

;; Bootstrapping is fine, but we might also want to configure the machines
;; with chef.
(with-node-templates templates
  (converge service {:webserver 1}
    (bootstrap-with (public-dns-if-no-nameserver)
                    (bootstrap-admin-user)
                    (chef))
    (configure-with-chef user "path_to_your_chef_repository")))

;; and we can then run chef-solo at any time with
(cook-nodes (nodes service) user "path_to_your_chef_repository")</pre>
  
  Public variables and functions:
  <span id="var-link"><a href="demo-api.html#demo/templates" id="var-tag">templates</a> </span><span id="var-link"><a href="demo-api.html#demo/the-farm" id="var-tag">the-farm</a> </span><br />
  
</div><div id="namespace-entry">
  <br />
  <hr />
  <h2 id="pallet">pallet</h2>
  by <span id="author">Hugo Duncan</span><br />
  <a href="pallet-api.html" id="api-link">Detailed API documentation</a><br />
  <pre id="namespace-docstr">
Pallet is used to provision configured compute nodes, and aims to solve the
problem of providing a consistently configured running image across a range of
clouds.  It is designed for use from the Clojure (<a href="http://clojure.org)">http://clojure.org)</a> REPL, and
from clojure scripts.

It uses jclouds (<a href="http://github.com/jclouds/jclouds)">http://github.com/jclouds/jclouds)</a> to gain portable access to
different cloud providers.  While jclouds solves the issue of creating
destroying and configuring cloud level access to nodes, it does not address the
differences in images used across providers.  This is what Pallet adds.

Pallet works with a declaritive map for specifying the number of nodes with a
given tag.  Each tag is used to look up a machine image template specification
and to lookup configuration information.  The converge function then tries to
bring you compute servers into alignment with your declared counts and
configurations.

The bootstrap process for new compute nodes is configurable.  At the moment
there is the possibility of using scripts, which are specialised by tag or
operating system family, and of using installing an admin user with sudo
permissions, using the specified username and password.  Script templates exist
for ensuring a functional resolv configuration, package manager update
installation of rubygems, etc, and can be added to freely.

An installed admin user can be used to execute chef cookbooks using 'chef-solo'.
Once the nodes are bootstrapped, and fall all existing nodes, the configured
node information is written to the 'compute-nodes' cookbook before chef is run
and this provides a :compute_nodes attribute.  The compute-nodes cookbook is
expected to exist in the site-cookbooks of the chef-repository you specify with
`with-chef-repository`. `chef-solo` is then run with chef repository you have
specified using the node tag as a configuration target.

This can also be used to bootstrap chef-server and chef client installation.

API documentation (<a href="http://hugoduncan.github.com/pallet)">http://hugoduncan.github.com/pallet)</a> is available.

## Usage

See demo documentation (http://hugoduncan.github.com/pallet/demo-api.html).

## Todo

Make password handling shell character safe.
Add error handling.
Add progress reporting.
Add templating by cloud provider.

## Installation

Installation is with Leiningen (<a href="http://github.com/technomancy/leiningen)">http://github.com/technomancy/leiningen)</a>.  Add
`[pallet "0.0.1-SNAPSHOT"]` to your :dependencies in project.clj.</pre>
  <span id="see-also">See also: 
    <span id="see-also-link">
      <a href="chef">http://wiki.opscode.com/display/chef/Home</a>
    </span><span id="see-also-link">
      <a href="jclouds">http://github.com/jclouds/jclouds</a>
    </span><br />
  </span>
  Public variables and functions:
  <br />
  <span id="subspace"><br />Variables and functions in
    <span id="name">pallet.bootstrap</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.bootstrap/bootstrap-admin-user">bootstrap-admin-user</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.bootstrap/bootstrap-fragment">bootstrap-fragment</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.bootstrap/bootstrap-script">bootstrap-script</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.bootstrap/bootstrap-template">bootstrap-template</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.bootstrap/bootstrap-with">bootstrap-with</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.bootstrap/with-bootstrap-repo">with-bootstrap-repo</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.chef</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.chef/chef-cook-solo">chef-cook-solo</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.chef/configure-with-chef">configure-with-chef</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.chef/cook-node">cook-node</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.chef/output-attributes">output-attributes</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.chef/with-chef-repository">with-chef-repository</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.chef/with-remote-chef-path">with-remote-chef-path</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.compute</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.compute/boot-if-down">boot-if-down</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.compute/execute-script">execute-script</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.compute/primary-ip">primary-ip</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.compute/reboot">reboot</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.compute/shutdown">shutdown</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.compute/shutdown-node">shutdown-node</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.core</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.core/*node-templates*">*node-templates*</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.core/adjust-node-counts">adjust-node-counts</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.core/admin-user">admin-user</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.core/bootstrap-none">bootstrap-none</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.core/build-node-template">build-node-template</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.core/configure-nodes-none">configure-nodes-none</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.core/converge">converge</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.core/converge-node-counts">converge-node-counts</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.core/create-nodes">create-nodes</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.core/node-template">node-template</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.core/start-node">start-node</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.core/with-admin-user">with-admin-user</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.core/with-node-templates">with-node-templates</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.crate.automated-admin-user</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.automated-admin-user/automated-admin-user">automated-admin-user</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.crate.chef</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.chef/chef">chef</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.crate.git</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.git/git">git</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.crate.java</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.java/java">java</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.java/java-package-name">java-package-name</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.crate.mysql</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.mysql/mysql-conf">mysql-conf</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.crate.public-dns-if-no-nameserver</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.public-dns-if-no-nameserver/public-dns-if-no-nameserver">public-dns-if-no-nameserver</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.crate.resolv</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.resolv/resolv">resolv</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.crate.ruby</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.ruby/ruby">ruby</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.ruby/ruby-packages">ruby-packages</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.crate.rubygems</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.rubygems/gem">gem</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.rubygems/gem-source">gem-source</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.rubygems/rubygems">rubygems</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.crate.ssh-key</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.ssh-key/authorize-key">authorize-key</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.ssh-key/install-key">install-key</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.crate.sudoers</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.crate.sudoers/sudoers">sudoers</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.resource</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource/bootstrap-resources">bootstrap-resources</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource/build-resource-fn">build-resource-fn</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource/build-resources">build-resources</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource/configured-resources">configured-resources</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource/defcomponent">defcomponent</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource/defresource">defresource</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource/invoke-resource">invoke-resource</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource/output-resources">output-resources</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource/reset-resources">reset-resources</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource/resource-fn">resource-fn</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.resource-apply</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource-apply/configure-node">configure-node</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource-apply/configure-resources">configure-resources</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.resource.directory</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource.directory/directory">directory</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.resource.exec-script</span>:
    
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.resource.file</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource.file/file">file</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.resource.hostinfo</span>:
    
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.resource.package</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource.package/add-scope">add-scope</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource.package/apply-package">apply-package</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource.package/package">package</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource.package/package-manager">package-manager</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource.package/package-manager*">package-manager*</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource.package/packages">packages</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.resource.remote-file</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource.remote-file/remote-file">remote-file</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.resource.resource-when</span>:
    
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.resource.user</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource.user/apply-user">apply-user</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.resource.user/user">user</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.script</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.script/defscript">defscript</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.script/dispatch-target">dispatch-target</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.script/invoke-target">invoke-target</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.script/with-line-number">with-line-number</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.stevedore</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.stevedore/defimpl">defimpl</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.stevedore/map-to-arg-string">map-to-arg-string</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.stevedore/option-args">option-args</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.stevedore/script">script</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.target</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.target/admin-group">admin-group</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.target/os">os</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.target/packager">packager</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.template</span>:
    
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.template.properties</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.template.properties/properties">properties</a>
    </span>
    <br />
  </span><span id="subspace"><br />Variables and functions in
    <span id="name">pallet.utils</span>:
    <span id="sub-var-link">
      <a href="pallet-api.html#pallet.utils/*admin-user*">*admin-user*</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.utils/make-user">make-user</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.utils/remote-sudo">remote-sudo</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.utils/remote-sudo-script">remote-sudo-script</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.utils/sh-script">sh-script</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.utils/slurp-resource">slurp-resource</a>
    </span><span id="sub-var-link">
      <a href="pallet-api.html#pallet.utils/system">system</a>
    </span>
    <br />
  </span>
</div>
</div>
              </div>
            </div>
          </div>
	</div>
	<div id="foot">
	  <div style="text-align: center;" id="copyright">Copyright Hugo Duncan 2010. All rights reserved.</div>
	</div>
      </div>
      <div id="DesignedBy">Logo &amp; site design by <a title="Visit Tom Hickey's website." href="http://www.tomhickey.com">Tom Hickey</a>.<br />
      Clojure auto-documentation system by Tom Faulhaber.</div>
    </div>
    <!-- /AllContentContainer -->
  </body>

</html>