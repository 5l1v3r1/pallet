<html>
  <head>
    <title>Pallet - Overview</title>
    <link href="static/favicon.png" rel="icon" />
    <link href="static/favicon.png" rel="shortcut icon" />
    <link media="all" type="text/css" href="static/clojure.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/wiki.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/internal.css" rel="stylesheet" />
    <!-- TODO: are we using these (from clojure.org)? If so, add the files -->
    <script src="file/view/code_highlighter.js" type="text/javascript"></script>
    <script src="file/view/clojure.js" type="text/javascript"></script>
    <style>.menuWrapper{height: 36px;}</style>
    <!--[if lte IE 6]>
    <link rel="stylesheet" href="http://www.wikispaces.com/_/2009051601/s/internal_ie.css" type="text/css" />
    <![endif]-->
  </head>
<!--
This document was auto-generated from the source by the clojure autodoc system.
To report errors or ask questions about the overall documentation structure, formatting,
etc., contact Tom Faulhaber (google mail name: tomfaulhaber).
For errors in the documentation of a particular namespace, contact the author of that
namespace.
-->
  <body>
    <div id="AllContentContainer">
      <div id="Header">
	<a id="Logo" href="index.html"><img alt="Clojure" height="100" width="100" src="static/clojure-icon.gif" /></a>
	<h1><a title="page header title" id="page-header" href="index.html">Pallet</a></h1>
      </div>
      <div id="leftcolumn"><div style="text-align: center;"></div>
<div class="menu">
  <div class="WikiCustomNav WikiElement wiki">
    <a class="wiki_link" href="index.html">Overview</a><br />
    <a class="wiki_link" href="api-index.html">API Index</a><br />
    <a class="wiki_link" href="#">Namespaces:</a>
    <ul id="left-sidebar-list">
      <li><a href="demo-api.html" class="wiki_link">demo</a></li><li><a href="pallet.bootstrap-api.html" class="wiki_link">pallet.bootstrap</a></li><li><a href="pallet.chef-api.html" class="wiki_link">pallet.chef</a></li><li><a href="pallet.compute-api.html" class="wiki_link">pallet.compute</a></li><li><a href="pallet.core-api.html" class="wiki_link">pallet.core</a></li><li><a href="pallet.utils-api.html" class="wiki_link">pallet.utils</a></li>
    </ul>
  </div>
</div>
</div>
      <div id="rightcolumn">
	<div id="Content">
	  <div class="contentBox"><div class="innerContentBox">
              <div id="content_view" class="wiki wikiPage">
                <div id="right-sidebar"><div id="toc">
  <h1 class="nopad">Table of Contents</h1>
  <div style="margin-left: 1em;" class="toc-section">
    <a href="#demo">demo</a>
    
    <br />
  </div><div style="margin-left: 1em;" class="toc-section">
    <a href="#pallet.bootstrap">pallet.bootstrap</a>
    
    <br />
  </div><div style="margin-left: 1em;" class="toc-section">
    <a href="#pallet.chef">pallet.chef</a>
    
    <br />
  </div><div style="margin-left: 1em;" class="toc-section">
    <a href="#pallet.compute">pallet.compute</a>
    
    <br />
  </div><div style="margin-left: 1em;" class="toc-section">
    <a href="#pallet.core">pallet.core</a>
    
    <br />
  </div><div style="margin-left: 1em;" class="toc-section">
    <a href="#pallet.utils">pallet.utils</a>
    
    <br />
  </div>
</div>
</div>
                <div id="content-tag"><h1 id="toc0">An Overview of the <span id="header-project">Pallet</span> API</h1>
<br />
<div id="project-description">Pallet is used to start provision compute nodes using crane, jclouds and chef.</div>
<br />
<div id="namespace-entry">
  <br />
  <hr />
  <h2 id="demo">demo</h2>
  by <span id="author">Hugo Duncan</span><br />
  <a href="demo-api.html" id="api-link">Detailed API documentation</a><br />
  <pre id="namespace-docstr">
A demo for pallet + crane + jclouds.

  ;; First we provide some credentials
  (def terremark-user "your user")
  (def terremark-password "your api key")

  ;; Npw we can load the demo package
  (require 'demo)
  (in-ns 'demo)

  ;; and log in to the cloud using the credentials defined above.
  (def tm (demo/terremark))

  ;; At this point we can manage instance counts as a map.
  ;; e.g add a node using the webserver template
  (with-node-templates templates
    (converge tm {:webserver 1}))

  ;; ... and remove it again
  (with-node-templates templates
    (converge tm {:webserver 0}))

  ;; templates is a description of the images to use for each of
  ;; our node tags
  templates

  ;; Images are configured differently between clouds and os's.
  ;; We might want to update our machines to use the latest
  ;; package manager.  pallet has a couple of templates, and
  ;; you can add your own, see resources/bootstrap.  Templates
  ;; have a default implementation, but can be specialised
  ;; for a given tag or operating system family.
  (with-node-templates templates
    (converge tm {:webserver 1}
      (bootstrap-with (bootstrap-template :ensure-resolve)
                      (bootstrap-template :update-pkg-mgr))))

  ;; We probably want an admin user.  We can ensure our admin
  ;; user is created with the image by specifying :boostrap-admin-user.
  (def user (make-user "admin-user" "admin-password"))

  ;; this time we create the a bootstrapped node
  (with-node-templates templates
    (converge tm {:webserver 1}
      (bootstrap-with (bootstrap-template :ensure-resolve)
                      (bootstrap-admin-user user))))

  ;; Bootstrapping is fine, but we might also want to configure the machines
  ;; with chef
  (with-node-templates templates
    (converge tm {:webserver 1}
      (bootstrap-with (bootstrap-template :ensure-resolve)
                      (bootstrap-template :update-pkg-mgr)
                      (bootstrap-admin-user user))
      (configure-with-chef user "path_to_your_chef_repository")))

  ;; and we can tun chef-solo at any time with
  (cook-nodes (nodes tm) user "path_to_your_chef_repository")</pre>
  
  Public variables and functions:
  <br />
  
</div><div id="namespace-entry">
  <br />
  <hr />
  <h2 id="pallet.bootstrap">pallet.bootstrap</h2>
  by <span id="author">Hugo Duncan</span><br />
  <a href="pallet.bootstrap-api.html" id="api-link">Detailed API documentation</a><br />
  <pre id="namespace-docstr">Boostrap functions.
</pre>
  
  Public variables and functions:
  <span id="var-link"><a href="pallet.bootstrap-api.html#pallet.bootstrap/bootstrap-admin-user" id="var-tag">bootstrap-admin-user</a> </span><span id="var-link"><a href="pallet.bootstrap-api.html#pallet.bootstrap/bootstrap-fragment" id="var-tag">bootstrap-fragment</a> </span><span id="var-link"><a href="pallet.bootstrap-api.html#pallet.bootstrap/bootstrap-script" id="var-tag">bootstrap-script</a> </span><span id="var-link"><a href="pallet.bootstrap-api.html#pallet.bootstrap/bootstrap-template" id="var-tag">bootstrap-template</a> </span><span id="var-link"><a href="pallet.bootstrap-api.html#pallet.bootstrap/bootstrap-with" id="var-tag">bootstrap-with</a> </span><span id="var-link"><a href="pallet.bootstrap-api.html#pallet.bootstrap/with-bootstrap-repo" id="var-tag">with-bootstrap-repo</a> </span><br />
  
</div><div id="namespace-entry">
  <br />
  <hr />
  <h2 id="pallet.chef">pallet.chef</h2>
  by <span id="author">unknown author</span><br />
  <a href="pallet.chef-api.html" id="api-link">Detailed API documentation</a><br />
  <pre id="namespace-docstr"></pre>
  
  Public variables and functions:
  <span id="var-link"><a href="pallet.chef-api.html#pallet.chef/chef-cook-solo" id="var-tag">chef-cook-solo</a> </span><span id="var-link"><a href="pallet.chef-api.html#pallet.chef/configure-with-chef" id="var-tag">configure-with-chef</a> </span><span id="var-link"><a href="pallet.chef-api.html#pallet.chef/cook-node" id="var-tag">cook-node</a> </span><span id="var-link"><a href="pallet.chef-api.html#pallet.chef/output-attributes" id="var-tag">output-attributes</a> </span><span id="var-link"><a href="pallet.chef-api.html#pallet.chef/with-chef-repository" id="var-tag">with-chef-repository</a> </span><span id="var-link"><a href="pallet.chef-api.html#pallet.chef/with-remote-chef-path" id="var-tag">with-remote-chef-path</a> </span><br />
  
</div><div id="namespace-entry">
  <br />
  <hr />
  <h2 id="pallet.compute">pallet.compute</h2>
  by <span id="author">unknown author</span><br />
  <a href="pallet.compute-api.html" id="api-link">Detailed API documentation</a><br />
  <pre id="namespace-docstr"></pre>
  
  Public variables and functions:
  <span id="var-link"><a href="pallet.compute-api.html#pallet.compute/primary-ip" id="var-tag">primary-ip</a> </span><span id="var-link"><a href="pallet.compute-api.html#pallet.compute/shutdown-node" id="var-tag">shutdown-node</a> </span><br />
  
</div><div id="namespace-entry">
  <br />
  <hr />
  <h2 id="pallet.core">pallet.core</h2>
  by <span id="author">Hugo Duncan</span><br />
  <a href="pallet.core-api.html" id="api-link">Detailed API documentation</a><br />
  <pre id="namespace-docstr">
Pallet is used to provision configured compute nodes using crane, jclouds and chef.

It uses a declaritive map for specifying the number of nodes with a given tag.
Each tag is used to look up a machine image template specification (in crane and
jsclouds), and to lookup configuration information (in chef).  The converge
function then tries to bring you compute servers into alignment with your
declared counts and configurations.

The bootstrap process for new compute nodes installs a user with sudo
permissions, using the specified username and password. The installed user is
used to execute the chef cookbooks.

Once the nodes are bootstrapped, and fall all existing nodes
the configured node information is written to the "compute-nodes" cookbook
before chef is run, and this provides a :compute_nodes attribute.  The
compute-nodes cookbook is expected to exist in the site-cookbooks of the
chef-repository you specify with `with-chef-repository`.

`chef-solo` is then run with chef repository you have specified using the node
tag as a configuration target.</pre>
  
  Public variables and functions:
  <span id="var-link"><a href="pallet.core-api.html#pallet.core/*admin-user*" id="var-tag">*admin-user*</a> </span><span id="var-link"><a href="pallet.core-api.html#pallet.core/*node-templates*" id="var-tag">*node-templates*</a> </span><span id="var-link"><a href="pallet.core-api.html#pallet.core/adjust-node-counts" id="var-tag">adjust-node-counts</a> </span><span id="var-link"><a href="pallet.core-api.html#pallet.core/bootstrap-none" id="var-tag">bootstrap-none</a> </span><span id="var-link"><a href="pallet.core-api.html#pallet.core/configure-nodes-none" id="var-tag">configure-nodes-none</a> </span><span id="var-link"><a href="pallet.core-api.html#pallet.core/converge" id="var-tag">converge</a> </span><span id="var-link"><a href="pallet.core-api.html#pallet.core/converge-node-counts" id="var-tag">converge-node-counts</a> </span><span id="var-link"><a href="pallet.core-api.html#pallet.core/create-nodes" id="var-tag">create-nodes</a> </span><span id="var-link"><a href="pallet.core-api.html#pallet.core/node-template" id="var-tag">node-template</a> </span><span id="var-link"><a href="pallet.core-api.html#pallet.core/with-admin-user" id="var-tag">with-admin-user</a> </span><span id="var-link"><a href="pallet.core-api.html#pallet.core/with-node-templates" id="var-tag">with-node-templates</a> </span><br />
  
</div><div id="namespace-entry">
  <br />
  <hr />
  <h2 id="pallet.utils">pallet.utils</h2>
  by <span id="author">unknown author</span><br />
  <a href="pallet.utils-api.html" id="api-link">Detailed API documentation</a><br />
  <pre id="namespace-docstr"></pre>
  
  Public variables and functions:
  <span id="var-link"><a href="pallet.utils-api.html#pallet.utils/make-user" id="var-tag">make-user</a> </span><span id="var-link"><a href="pallet.utils-api.html#pallet.utils/remote-sudo" id="var-tag">remote-sudo</a> </span><span id="var-link"><a href="pallet.utils-api.html#pallet.utils/slurp-resource" id="var-tag">slurp-resource</a> </span><span id="var-link"><a href="pallet.utils-api.html#pallet.utils/system" id="var-tag">system</a> </span><br />
  
</div>
</div>
              </div>
            </div>
          </div>
	</div>
	<div id="foot">
	  <div style="text-align: center;" id="copyright">Copyright Hugo Duncan 2010. All rights reserved.</div>
	</div>
      </div>
      <div id="DesignedBy">Logo &amp; site design by <a title="Visit Tom Hickey's website." href="http://www.tomhickey.com">Tom Hickey</a>.<br />
      Clojure auto-documentation system by Tom Faulhaber.</div>
    </div>
    <!-- /AllContentContainer -->
  </body>

</html>