<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
lang="en" xml:lang="en">
<head>
<title>Crate Writing Guide</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2011-06-16 23:59:26 EDT"/>
<meta name="author" content="Hugo Duncan"/>
<meta name="description" content="Pallet documentation crate writing guide"/>
<meta name="keywords" content="pallet documentation crate write author guide"/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="doc.css" /><link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Molengo"/>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>
<div id="content">
<div id="org-div-home-and-up" style="text-align:right;font-size:70%;white-space:nowrap;">
 <a accesskey="h" href="index.html"> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div>

<h1 class="title">Crate Writing Guide</h1>

<p>You are of course free to write crates however you wish, but these are the
guiding principles used in the pallet core crates.
</p>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Don't create large monolithic crates </h2>
<div class="outline-text-2" id="text-1">


<p>
There are probably as many ways of configuring a package as there are users of
that package. A monolithic function will either have limited flexibility, or
will have so many options as to render it difficult to use.  By providing
building blocks, for example a function for each configuration file required,
the crate user can decide which parts to use and how to combine them.  At the
same time these component functions can be used to build simplified installers
for common use cases.
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">Configuration Files </h2>
<div class="outline-text-2" id="text-2">


<p>
There are many ways of generating the content of a configuration file, and
installing the content should be a reusable function.
</p>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">Prefer content generation to templates </h2>
<div class="outline-text-2" id="text-3">


<p>
Using templates for configuration files is certainly convenient, but providing
clojure based configuration generation functions ensures that all configuration
is available within clojure for querying, etc.
</p>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4">Install paths, users, etc </h2>
<div class="outline-text-2" id="text-4">


<p>
In order to expose details of your crate install to other crates, you should
use the request :parameters to record paths, user names etc.
</p>
<p>
Information for consumption on the same node should go into the host parameters
using <code>assoc-for-target</code>, <code>update-for-target</code> and <code>get-for-target</code> in the
<code>pallet.parameters</code> namespace.
</p>
<p>
Information for consumption on the other nodes should go into the service
parameters using <code>assoc-for-service</code>, <code>update-for-service</code> and <code>get-for-service</code> in
the <code>pallet.parameters</code> namespace.
</p>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5">Package based install </h2>
<div class="outline-text-2" id="text-5">


<p>
Package based installs are preferred.
</p>
<ul>
<li>
a function to install a package or a set of packages should be called <code>install</code>

</li>
<li>
ensure the package manager is up to date by calling
<code>(pallet.resource.package/package-manager :update)</code>
</li>
</ul>


</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6">Source based install </h2>
<div class="outline-text-2" id="text-6">


<p>
Sometimes a source based install can be useful. This should be optional.
</p>
</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7">Init Service </h2>
<div class="outline-text-2" id="text-7">


<p>
Not all crates will use an init service, but many packages install one.
</p>
<p>
The crate should wrap a provided init service in an <code>init-service</code> function that
forwards actions to <code>pallet.resource.service/service</code>, so the name of the
service is encapsulated. This wrapper should also expose an <code>:if-config-changed</code>
option to make its actions condtional on a change in configuration.  The flag
should be set by any changes in configuration, eg. using the
remote-file <code>:flag-on-changed</code> option.
</p>
</div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8">Finally </h2>
<div class="outline-text-2" id="text-8">


<p>
Not all of the core crates live up to these, yet.
</p></div>
</div>
<div id="postamble">
<p class="author"> Author: Hugo Duncan
</p>
<p class="date"> Date: 2011-06-16 23:59:26 EDT</p>
<p class="creator">HTML generated by org-mode 7.4 in emacs 24</p>
</div>
</div>
</body>
</html>
