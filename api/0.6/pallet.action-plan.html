<html lang="en">
  <head>
    <title>pallet.action-plan documentation</title>
    <link href="css/default.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/page_effects.js"></script>
  </head>
  <body>
    <header>
      <div id="header">
        <h1 class="project-title">Pallet 0.6 API documentation</h1>
      </div>
    </header>
    <navigation>
      <div id="namespaces" class="sidebar">
        <h3>Namespaces</h3>
        <ul class="ns-links">
          <li class="ns-link"><a href="pallet.action.html">pallet.action</a></li><li class="ns-link"><a href="pallet.action.conditional.html">pallet.action.conditional</a></li><li class="ns-link"><a href="pallet.action.directory.html">pallet.action.directory</a></li><li class="ns-link"><a href="pallet.action.environment.html">pallet.action.environment</a></li><li class="ns-link"><a href="pallet.action.exec-script.html">pallet.action.exec-script</a></li><li class="ns-link"><a href="pallet.action.file.html">pallet.action.file</a></li><li class="ns-link"><a href="pallet.action.filesystem.html">pallet.action.filesystem</a></li><li class="ns-link"><a href="pallet.action.package.html">pallet.action.package</a></li><li class="ns-link"><a href="pallet.action.package.centos.html">pallet.action.package.centos</a></li><li class="ns-link"><a href="pallet.action.package.debian-backports.html">pallet.action.package.debian-backports</a></li><li class="ns-link"><a href="pallet.action.package.epel.html">pallet.action.package.epel</a></li><li class="ns-link"><a href="pallet.action.package.jpackage.html">pallet.action.package.jpackage</a></li><li class="ns-link"><a href="pallet.action.package.rpmforge.html">pallet.action.package.rpmforge</a></li><li class="ns-link"><a href="pallet.action.remote-directory.html">pallet.action.remote-directory</a></li><li class="ns-link"><a href="pallet.action.remote-file.html">pallet.action.remote-file</a></li><li class="ns-link"><a href="pallet.action.retry.html">pallet.action.retry</a></li><li class="ns-link"><a href="pallet.action.rsync.html">pallet.action.rsync</a></li><li class="ns-link"><a href="pallet.action.service.html">pallet.action.service</a></li><li class="ns-link"><a href="pallet.action.user.html">pallet.action.user</a></li><li class="ns-link"><a href="pallet.action-plan.html">pallet.action-plan</a></li><li class="ns-link"><a href="pallet.argument.html">pallet.argument</a></li><li class="ns-link"><a href="pallet.blobstore.html">pallet.blobstore</a></li><li class="ns-link"><a href="pallet.blobstore.implementation.html">pallet.blobstore.implementation</a></li><li class="ns-link"><a href="pallet.blobstore.jclouds.html">pallet.blobstore.jclouds</a></li><li class="ns-link"><a href="pallet.blobstore.url-blobstore.html">pallet.blobstore.url-blobstore</a></li><li class="ns-link"><a href="pallet.command-line.html">pallet.command-line</a></li><li class="ns-link"><a href="pallet.command-script.html">pallet.command-script</a></li><li class="ns-link"><a href="pallet.compute.html">pallet.compute</a></li><li class="ns-link"><a href="pallet.compute.hybrid.html">pallet.compute.hybrid</a></li><li class="ns-link"><a href="pallet.compute.implementation.html">pallet.compute.implementation</a></li><li class="ns-link"><a href="pallet.compute.jclouds.html">pallet.compute.jclouds</a></li><li class="ns-link"><a href="pallet.compute.jvm.html">pallet.compute.jvm</a></li><li class="ns-link"><a href="pallet.compute.node-list.html">pallet.compute.node-list</a></li><li class="ns-link"><a href="pallet.compute.vmfest.html">pallet.compute.vmfest</a></li><li class="ns-link"><a href="pallet.config-file.format.html">pallet.config-file.format</a></li><li class="ns-link"><a href="pallet.configure.html">pallet.configure</a></li><li class="ns-link"><a href="pallet.core.html">pallet.core</a></li><li class="ns-link"><a href="pallet.crate.network-service.html">pallet.crate.network-service</a></li><li class="ns-link"><a href="pallet.debug.html">pallet.debug</a></li><li class="ns-link"><a href="pallet.enlive.html">pallet.enlive</a></li><li class="ns-link"><a href="pallet.environment.html">pallet.environment</a></li><li class="ns-link"><a href="pallet.execute.html">pallet.execute</a></li><li class="ns-link"><a href="pallet.futures.html">pallet.futures</a></li><li class="ns-link"><a href="pallet.main.html">pallet.main</a></li><li class="ns-link"><a href="pallet.main-invoker.html">pallet.main-invoker</a></li><li class="ns-link"><a href="pallet.map-merge.html">pallet.map-merge</a></li><li class="ns-link"><a href="pallet.maven.html">pallet.maven</a></li><li class="ns-link"><a href="pallet.md5crypt.html">pallet.md5crypt</a></li><li class="ns-link"><a href="pallet.node.html">pallet.node</a></li><li class="ns-link"><a href="pallet.parameter.html">pallet.parameter</a></li><li class="ns-link"><a href="pallet.phase.html">pallet.phase</a></li><li class="ns-link"><a href="pallet.repl.html">pallet.repl</a></li><li class="ns-link"><a href="pallet.request-map.html">pallet.request-map</a></li><li class="ns-link"><a href="pallet.resource.html">pallet.resource</a></li><li class="ns-link"><a href="pallet.resource.directory.html">pallet.resource.directory</a></li><li class="ns-link"><a href="pallet.resource.exec-script.html">pallet.resource.exec-script</a></li><li class="ns-link"><a href="pallet.resource.file.html">pallet.resource.file</a></li><li class="ns-link"><a href="pallet.resource.filesystem.html">pallet.resource.filesystem</a></li><li class="ns-link"><a href="pallet.resource.filesystem-layout.html">pallet.resource.filesystem-layout</a></li><li class="ns-link"><a href="pallet.resource.format.html">pallet.resource.format</a></li><li class="ns-link"><a href="pallet.resource.hostinfo.html">pallet.resource.hostinfo</a></li><li class="ns-link"><a href="pallet.resource.lib.html">pallet.resource.lib</a></li><li class="ns-link"><a href="pallet.resource.network-service.html">pallet.resource.network-service</a></li><li class="ns-link"><a href="pallet.resource.package.html">pallet.resource.package</a></li><li class="ns-link"><a href="pallet.resource.remote-directory.html">pallet.resource.remote-directory</a></li><li class="ns-link"><a href="pallet.resource.remote-file.html">pallet.resource.remote-file</a></li><li class="ns-link"><a href="pallet.resource.resource-when.html">pallet.resource.resource-when</a></li><li class="ns-link"><a href="pallet.resource.rsync.html">pallet.resource.rsync</a></li><li class="ns-link"><a href="pallet.resource.service.html">pallet.resource.service</a></li><li class="ns-link"><a href="pallet.resource.shell.html">pallet.resource.shell</a></li><li class="ns-link"><a href="pallet.resource.user.html">pallet.resource.user</a></li><li class="ns-link"><a href="pallet.script.lib.html">pallet.script.lib</a></li><li class="ns-link"><a href="pallet.session.html">pallet.session</a></li><li class="ns-link"><a href="pallet.shell.html">pallet.shell</a></li><li class="ns-link"><a href="pallet.strint.html">pallet.strint</a></li><li class="ns-link"><a href="pallet.target.html">pallet.target</a></li><li class="ns-link"><a href="pallet.task.add-service.html">pallet.task.add-service</a></li><li class="ns-link"><a href="pallet.task.containers.html">pallet.task.containers</a></li><li class="ns-link"><a href="pallet.task.converge.html">pallet.task.converge</a></li><li class="ns-link"><a href="pallet.task.converge-cluster.html">pallet.task.converge-cluster</a></li><li class="ns-link"><a href="pallet.task.describe-node.html">pallet.task.describe-node</a></li><li class="ns-link"><a href="pallet.task.destroy-cluster.html">pallet.task.destroy-cluster</a></li><li class="ns-link"><a href="pallet.task.help.html">pallet.task.help</a></li><li class="ns-link"><a href="pallet.task.images.html">pallet.task.images</a></li><li class="ns-link"><a href="pallet.task.lift.html">pallet.task.lift</a></li><li class="ns-link"><a href="pallet.task.new-project.html">pallet.task.new-project</a></li><li class="ns-link"><a href="pallet.task.nodes.html">pallet.task.nodes</a></li><li class="ns-link"><a href="pallet.task.providers.html">pallet.task.providers</a></li><li class="ns-link"><a href="pallet.task.to-blob.html">pallet.task.to-blob</a></li><li class="ns-link"><a href="pallet.task.version.html">pallet.task.version</a></li><li class="ns-link"><a href="pallet.task.vmfest-script.html">pallet.task.vmfest-script</a></li><li class="ns-link"><a href="pallet.template.html">pallet.template</a></li><li class="ns-link"><a href="pallet.template.properties.html">pallet.template.properties</a></li><li class="ns-link"><a href="pallet.utils.html">pallet.utils</a></li>
        </ul>
      </div>
      <div id="vars" class="sidebar">
        <h3>Public Vars</h3>
        <ul class="ns-var-links">
          <li class="ns-var-link"><a href="pallet.action-plan.html#var-action-dependencies">action-dependencies</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-action-instances">action-instances</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-action-map">action-map</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-add-action">add-action</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-augment-return">augment-return</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-bind-action-arguments">bind-action-arguments</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-build-for-target">build-for-target</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-collect-action-id">collect-action-id</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-combine-actions">combine-actions</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-execute">execute</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-execute-action">execute-action</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-execute-for-target">execute-for-target</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-get-for-target">get-for-target</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-merge-union">merge-union</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-phase-for-target">phase-for-target</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-pop-block">pop-block</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-push-block">push-block</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-reset-for-target">reset-for-target</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-script-template">script-template</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-script-template-for-server">script-template-for-server</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-target-path">target-path</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-transform-nested-scopes">transform-nested-scopes</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-translate">translate</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-translate-for-target">translate-for-target</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-translated%3F">translated?</a></li>
        </ul>
      </div>
    </navigation>
    <article>
      <div id="content" class="namespace-docs">
        <h2 class="namespace-title">pallet.action-plan documentation</h2>
        <div class="doc"><p>An action plan contains actions for execution.</p>

<p>The action plan is built by executing a phase function. Each phase function
calls actions which insert themselves into the action plan.</p>

<p>The action plan is transformed to provide aggregated operations, and to
resolve precedence relations between actions.</p>

<p>A translated plan is executed by passing an executor, which is a map
from action type to function.  The executor functions are called with the
result of evaluating the action with it's arguments.</p>
</div>
        <div class="ns-vars">
          <div class="public">
            <h3 id="var-action-dependencies">action-dependencies</h3>
            <div class="usage">[action-id-map action]</div>
            
            
            <div class="doc"><p>Extract an action's dependencies.  Actions are id'd with keywords,
and dependencies are declared on an action's id or function.</p>
</div>
          </div><div class="public">
            <h3 id="var-action-instances">action-instances</h3>
            <div class="usage">[actions dependencies]</div>
            
            
            <div class="doc"><p>Given a map of dependencies, each with an :f and maybe a :action-id,
returns a map where the values are all matching action instances</p>
</div>
          </div><div class="public">
            <h3 id="var-action-map">action-map</h3>
            <div class="usage">[action-fn precedence args execution action-type location]</div>
            
            
            <div class="doc"><p>Return an action map for the given args. The action plan is a tree of
action maps.</p>

<p>precedence specifies naming and dependencies, with :action-id, :always-before
and :always-after. If a precedence is supplied, an action-id is generated
if none present, to ensure that the standard action precedence is not
altered.</p>

<ul>
<li>:f            the action function</li>
<li>:args         the arguments to pass to the action function</li>
<li>:location     where to execute the action - :orgin or :target</li>
<li>:action-type  the type of action - :script/bash, :fn/clojure, etc</li>
<li>:execution    the execution type - :in-sequence, :aggregated, :collected</li>
<li>:value        the result of calling the action function, :f, with :args</li>
<li>:session      the session map after calling the action function.</li>
</ul>
</div>
          </div><div class="public">
            <h3 id="var-add-action">add-action</h3>
            <div class="usage">[action-plan action]</div>
            
            
            <div class="doc"><p>Add an action to the plan</p>
</div>
          </div><div class="public">
            <h3 id="var-augment-return">augment-return</h3>
            
            
            
            <div class="doc"><p>Change the return type of an action, to be an action map with
:value and :session keys that are the value of the action, and the updated
session map for the next action.  This creates a consistent return value for
all action types (effectively creating a monadic value which is a map).</p>
</div>
          </div><div class="public">
            <h3 id="var-bind-action-arguments">bind-action-arguments</h3>
            
            
            
            <div class="doc"><p>Bind an action's arguments.</p>
</div>
          </div><div class="public">
            <h3 id="var-build-for-target">build-for-target</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Create the action plan by calling the current phase for the target group.</p>
</div>
          </div><div class="public">
            <h3 id="var-collect-action-id">collect-action-id</h3>
            <div class="usage">[m action]</div>
            
            
            <div class="doc"><p>Extract an action's id to function mapping</p>
</div>
          </div><div class="public">
            <h3 id="var-combine-actions">combine-actions</h3>
            
            
            
            <div class="doc"><p>Combine actions by action-type</p>
</div>
          </div><div class="public">
            <h3 id="var-execute">execute</h3>
            <div class="usage">[action-plan session executor execute-status-fn]</div>
            
            
            <div class="doc"><p>Execute actions by passing the un-evaluated actions to the <code>executor</code>
function (a function with an arglist of [session f action-type location]).</p>
</div>
          </div><div class="public">
            <h3 id="var-execute-action">execute-action</h3>
            <div class="usage">[executor session {:keys [f action-type location], :as action}]</div>
            
            
            <div class="doc"><p>Execute a single action</p>
</div>
          </div><div class="public">
            <h3 id="var-execute-for-target">execute-for-target</h3>
            <div class="usage">[session executor execute-status-fn]</div>
            
            
            <div class="doc"><p>Execute the translated action plan for the current target.</p>
</div>
          </div><div class="public">
            <h3 id="var-get-for-target">get-for-target</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Get the action plan for the current phase and target node.</p>
</div>
          </div><div class="public">
            <h3 id="var-merge-union">merge-union</h3>
            <div class="usage">[&amp; m]</div>
            
            
            <div class="doc"><p>Merge-with clojure.set/union</p>
</div>
          </div><div class="public">
            <h3 id="var-phase-for-target">phase-for-target</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Return the phase for the target</p>
</div>
          </div><div class="public">
            <h3 id="var-pop-block">pop-block</h3>
            <div class="usage">[action-plan]</div>
            
            
            <div class="doc"><p>Take the last block and add it to the scope below it in the stack.
The block is reversed to put it into the order in which elements
were added. Once pop'd, nothing should be added to the block.</p>
</div>
          </div><div class="public">
            <h3 id="var-push-block">push-block</h3>
            <div class="usage">[action-plan]</div>
            
            
            <div class="doc"><p>Push a block onto the action-plan</p>
</div>
          </div><div class="public">
            <h3 id="var-reset-for-target">reset-for-target</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Reset the action plan for the current phase and target.</p>
</div>
          </div><div class="public">
            <h3 id="var-script-template">script-template</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Return the script template for the current group node.</p>
</div>
          </div><div class="public">
            <h3 id="var-script-template-for-server">script-template-for-server</h3>
            <div class="usage">[server]</div>
            
            
            <div class="doc"><p>Return the script template for the specified server.</p>
</div>
          </div><div class="public">
            <h3 id="var-target-path">target-path</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Return the vector path of the action plan for the current session target
node, or target group.</p>
</div>
          </div><div class="public">
            <h3 id="var-transform-nested-scopes">transform-nested-scopes</h3>
            <div class="usage">[action-plan]</div>
            
            
            <div class="doc"><p>Traverses an action-plan structure. Converting nested scopes into
action-map's.</p>
</div>
          </div><div class="public">
            <h3 id="var-translate">translate</h3>
            <div class="usage">[action-plan]</div>
            
            
            <div class="doc"><p>Process the action-plan, applying groupings and precedence, producing
an action plan with fully bound functions, ready for execution.</p>

<p>This is equivalent to using an identity monad with a monadic value
that is a tree of action maps.</p>
</div>
          </div><div class="public">
            <h3 id="var-translate-for-target">translate-for-target</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Build the action plan and translate for the current phase and target node.</p>
</div>
          </div><div class="public">
            <h3 id="var-translated%3F">translated?</h3>
            <div class="usage">[action-plan]</div>
            
            
            <div class="doc"><p>Predicate to test if an action plan has been translated</p>
</div>
          </div>
        </div>
      </div>
    </article>
  </body>

</html>