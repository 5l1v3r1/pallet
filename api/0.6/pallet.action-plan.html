<!DOCTYPE html>
<html><head><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>pallet.action-plan documentation</title></head><body><div id="header"><h1><a href="index.html">Pallet 0.6.7-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3>Namespaces</h3><ul><li><a href="pallet.action.html">pallet.action</a></li><li><a href="pallet.action.conditional.html">pallet.action.conditional</a></li><li><a href="pallet.action.directory.html">pallet.action.directory</a></li><li><a href="pallet.action.environment.html">pallet.action.environment</a></li><li><a href="pallet.action.exec-script.html">pallet.action.exec-script</a></li><li><a href="pallet.action.file.html">pallet.action.file</a></li><li><a href="pallet.action.filesystem.html">pallet.action.filesystem</a></li><li><a href="pallet.action.package.html">pallet.action.package</a></li><li><a href="pallet.action.package.centos.html">pallet.action.package.centos</a></li><li><a href="pallet.action.package.debian-backports.html">pallet.action.package.debian-backports</a></li><li><a href="pallet.action.package.epel.html">pallet.action.package.epel</a></li><li><a href="pallet.action.package.jpackage.html">pallet.action.package.jpackage</a></li><li><a href="pallet.action.package.rpmforge.html">pallet.action.package.rpmforge</a></li><li><a href="pallet.action.remote-directory.html">pallet.action.remote-directory</a></li><li><a href="pallet.action.remote-file.html">pallet.action.remote-file</a></li><li><a href="pallet.action.retry.html">pallet.action.retry</a></li><li><a href="pallet.action.rsync.html">pallet.action.rsync</a></li><li><a href="pallet.action.service.html">pallet.action.service</a></li><li><a href="pallet.action.user.html">pallet.action.user</a></li><li class="current"><a href="pallet.action-plan.html">pallet.action-plan</a></li><li><a href="pallet.argument.html">pallet.argument</a></li><li><a href="pallet.blobstore.html">pallet.blobstore</a></li><li><a href="pallet.blobstore.implementation.html">pallet.blobstore.implementation</a></li><li><a href="pallet.blobstore.jclouds.html">pallet.blobstore.jclouds</a></li><li><a href="pallet.blobstore.url-blobstore.html">pallet.blobstore.url-blobstore</a></li><li><a href="pallet.command-line.html">pallet.command-line</a></li><li><a href="pallet.command-script.html">pallet.command-script</a></li><li><a href="pallet.compute.html">pallet.compute</a></li><li><a href="pallet.compute.hybrid.html">pallet.compute.hybrid</a></li><li><a href="pallet.compute.implementation.html">pallet.compute.implementation</a></li><li><a href="pallet.compute.jclouds.html">pallet.compute.jclouds</a></li><li><a href="pallet.compute.jvm.html">pallet.compute.jvm</a></li><li><a href="pallet.compute.node-list.html">pallet.compute.node-list</a></li><li><a href="pallet.compute.vmfest.html">pallet.compute.vmfest</a></li><li><a href="pallet.config-file.format.html">pallet.config-file.format</a></li><li><a href="pallet.configure.html">pallet.configure</a></li><li><a href="pallet.core.html">pallet.core</a></li><li><a href="pallet.crate.network-service.html">pallet.crate.network-service</a></li><li><a href="pallet.debug.html">pallet.debug</a></li><li><a href="pallet.enlive.html">pallet.enlive</a></li><li><a href="pallet.environment.html">pallet.environment</a></li><li><a href="pallet.execute.html">pallet.execute</a></li><li><a href="pallet.futures.html">pallet.futures</a></li><li><a href="pallet.main.html">pallet.main</a></li><li><a href="pallet.main-invoker.html">pallet.main-invoker</a></li><li><a href="pallet.map-merge.html">pallet.map-merge</a></li><li><a href="pallet.maven.html">pallet.maven</a></li><li><a href="pallet.md5crypt.html">pallet.md5crypt</a></li><li><a href="pallet.node.html">pallet.node</a></li><li><a href="pallet.parameter.html">pallet.parameter</a></li><li><a href="pallet.phase.html">pallet.phase</a></li><li><a href="pallet.repl.html">pallet.repl</a></li><li><a href="pallet.request-map.html">pallet.request-map</a></li><li><a href="pallet.resource.html">pallet.resource</a></li><li><a href="pallet.resource.directory.html">pallet.resource.directory</a></li><li><a href="pallet.resource.exec-script.html">pallet.resource.exec-script</a></li><li><a href="pallet.resource.file.html">pallet.resource.file</a></li><li><a href="pallet.resource.filesystem.html">pallet.resource.filesystem</a></li><li><a href="pallet.resource.filesystem-layout.html">pallet.resource.filesystem-layout</a></li><li><a href="pallet.resource.format.html">pallet.resource.format</a></li><li><a href="pallet.resource.hostinfo.html">pallet.resource.hostinfo</a></li><li><a href="pallet.resource.lib.html">pallet.resource.lib</a></li><li><a href="pallet.resource.network-service.html">pallet.resource.network-service</a></li><li><a href="pallet.resource.package.html">pallet.resource.package</a></li><li><a href="pallet.resource.remote-directory.html">pallet.resource.remote-directory</a></li><li><a href="pallet.resource.remote-file.html">pallet.resource.remote-file</a></li><li><a href="pallet.resource.resource-when.html">pallet.resource.resource-when</a></li><li><a href="pallet.resource.rsync.html">pallet.resource.rsync</a></li><li><a href="pallet.resource.service.html">pallet.resource.service</a></li><li><a href="pallet.resource.shell.html">pallet.resource.shell</a></li><li><a href="pallet.resource.user.html">pallet.resource.user</a></li><li><a href="pallet.script.lib.html">pallet.script.lib</a></li><li><a href="pallet.session.html">pallet.session</a></li><li><a href="pallet.shell.html">pallet.shell</a></li><li><a href="pallet.strint.html">pallet.strint</a></li><li><a href="pallet.target.html">pallet.target</a></li><li><a href="pallet.task.add-service.html">pallet.task.add-service</a></li><li><a href="pallet.task.containers.html">pallet.task.containers</a></li><li><a href="pallet.task.converge.html">pallet.task.converge</a></li><li><a href="pallet.task.converge-cluster.html">pallet.task.converge-cluster</a></li><li><a href="pallet.task.describe-node.html">pallet.task.describe-node</a></li><li><a href="pallet.task.destroy-cluster.html">pallet.task.destroy-cluster</a></li><li><a href="pallet.task.help.html">pallet.task.help</a></li><li><a href="pallet.task.images.html">pallet.task.images</a></li><li><a href="pallet.task.lift.html">pallet.task.lift</a></li><li><a href="pallet.task.new-project.html">pallet.task.new-project</a></li><li><a href="pallet.task.nodes.html">pallet.task.nodes</a></li><li><a href="pallet.task.providers.html">pallet.task.providers</a></li><li><a href="pallet.task.to-blob.html">pallet.task.to-blob</a></li><li><a href="pallet.task.version.html">pallet.task.version</a></li><li><a href="pallet.task.vmfest-script.html">pallet.task.vmfest-script</a></li><li><a href="pallet.template.html">pallet.template</a></li><li><a href="pallet.template.properties.html">pallet.template.properties</a></li><li><a href="pallet.utils.html">pallet.utils</a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="pallet.action-plan.html#var-action-dependencies">action-dependencies</a></li><li><a href="pallet.action-plan.html#var-action-instances">action-instances</a></li><li><a href="pallet.action-plan.html#var-action-map">action-map</a></li><li><a href="pallet.action-plan.html#var-add-action">add-action</a></li><li><a href="pallet.action-plan.html#var-augment-return">augment-return</a></li><li><a href="pallet.action-plan.html#var-bind-action-arguments">bind-action-arguments</a></li><li><a href="pallet.action-plan.html#var-build-for-target">build-for-target</a></li><li><a href="pallet.action-plan.html#var-collect-action-id">collect-action-id</a></li><li><a href="pallet.action-plan.html#var-combine-actions">combine-actions</a></li><li><a href="pallet.action-plan.html#var-execute">execute</a></li><li><a href="pallet.action-plan.html#var-execute-action">execute-action</a></li><li><a href="pallet.action-plan.html#var-execute-for-target">execute-for-target</a></li><li><a href="pallet.action-plan.html#var-get-for-target">get-for-target</a></li><li><a href="pallet.action-plan.html#var-merge-union">merge-union</a></li><li><a href="pallet.action-plan.html#var-phase-for-target">phase-for-target</a></li><li><a href="pallet.action-plan.html#var-pop-block">pop-block</a></li><li><a href="pallet.action-plan.html#var-push-block">push-block</a></li><li><a href="pallet.action-plan.html#var-reset-for-target">reset-for-target</a></li><li><a href="pallet.action-plan.html#var-script-template">script-template</a></li><li><a href="pallet.action-plan.html#var-script-template-for-server">script-template-for-server</a></li><li><a href="pallet.action-plan.html#var-target-path">target-path</a></li><li><a href="pallet.action-plan.html#var-transform-nested-scopes">transform-nested-scopes</a></li><li><a href="pallet.action-plan.html#var-translate">translate</a></li><li><a href="pallet.action-plan.html#var-translate-for-target">translate-for-target</a></li><li><a href="pallet.action-plan.html#var-translated%3F">translated?</a></li></ul></div><div class="namespace-docs" id="content"><h2>pallet.action-plan documentation</h2><pre class="doc">An action plan contains actions for execution.

The action plan is built by executing a phase function. Each phase function
calls actions which insert themselves into the action plan.

The action plan is transformed to provide aggregated operations, and to
resolve precedence relations between actions.

A translated plan is executed by passing an executor, which is a map
from action type to function.  The executor functions are called with the
result of evaluating the action with it's arguments.</pre><div class="public" id="var-action-dependencies"><h3>action-dependencies</h3><div class="usage"><code>(action-dependencies action-id-map action)</code></div><pre class="doc">Extract an action's dependencies.  Actions are id'd with keywords,
and dependencies are declared on an action's id or function.</pre></div><div class="public" id="var-action-instances"><h3>action-instances</h3><div class="usage"><code>(action-instances actions dependencies)</code></div><pre class="doc">Given a map of dependencies, each with an :f and maybe a :action-id,
returns a map where the values are all matching action instances</pre></div><div class="public" id="var-action-map"><h3>action-map</h3><div class="usage"><code>(action-map action-fn precedence args execution action-type location)</code></div><pre class="doc">Return an action map for the given args. The action plan is a tree of
action maps.

precedence specifies naming and dependencies, with :action-id, :always-before
and :always-after. If a precedence is supplied, an action-id is generated
if none present, to ensure that the standard action precedence is not
altered.

- :f            the action function
- :args         the arguments to pass to the action function
- :location     where to execute the action - :orgin or :target
- :action-type  the type of action - :script/bash, :fn/clojure, etc
- :execution    the execution type - :in-sequence, :aggregated, :collected
- :value        the result of calling the action function, :f, with :args
- :session      the session map after calling the action function.</pre></div><div class="public" id="var-add-action"><h3>add-action</h3><div class="usage"><code>(add-action action-plan action)</code></div><pre class="doc">Add an action to the plan
</pre></div><div class="public" id="var-augment-return"><h3>augment-return</h3><div class="usage"></div><pre class="doc">Change the return type of an action, to be an action map with
:value and :session keys that are the value of the action, and the updated
session map for the next action.  This creates a consistent return value for
all action types (effectively creating a monadic value which is a map).</pre></div><div class="public" id="var-bind-action-arguments"><h3>bind-action-arguments</h3><div class="usage"></div><pre class="doc">Bind an action's arguments.
</pre></div><div class="public" id="var-build-for-target"><h3>build-for-target</h3><div class="usage"><code>(build-for-target session)</code></div><pre class="doc">Create the action plan by calling the current phase for the target group.
</pre></div><div class="public" id="var-collect-action-id"><h3>collect-action-id</h3><div class="usage"><code>(collect-action-id m action)</code></div><pre class="doc">Extract an action's id to function mapping
</pre></div><div class="public" id="var-combine-actions"><h3>combine-actions</h3><div class="usage"></div><pre class="doc">Combine actions by action-type
</pre></div><div class="public" id="var-execute"><h3>execute</h3><div class="usage"><code>(execute action-plan session executor execute-status-fn)</code></div><pre class="doc">Execute actions by passing the un-evaluated actions to the `executor`
function (a function with an arglist of [session f action-type location]).</pre></div><div class="public" id="var-execute-action"><h3>execute-action</h3><div class="usage"><code>(execute-action executor session {:keys [f action-type location], :as action})</code></div><pre class="doc">Execute a single action
</pre></div><div class="public" id="var-execute-for-target"><h3>execute-for-target</h3><div class="usage"><code>(execute-for-target session executor execute-status-fn)</code></div><pre class="doc">Execute the translated action plan for the current target.
</pre></div><div class="public" id="var-get-for-target"><h3>get-for-target</h3><div class="usage"><code>(get-for-target session)</code></div><pre class="doc">Get the action plan for the current phase and target node.
</pre></div><div class="public" id="var-merge-union"><h3>merge-union</h3><div class="usage"><code>(merge-union &amp; m)</code></div><pre class="doc">Merge-with clojure.set/union
</pre></div><div class="public" id="var-phase-for-target"><h3>phase-for-target</h3><div class="usage"><code>(phase-for-target session)</code></div><pre class="doc">Return the phase for the target
</pre></div><div class="public" id="var-pop-block"><h3>pop-block</h3><div class="usage"><code>(pop-block action-plan)</code></div><pre class="doc">Take the last block and add it to the scope below it in the stack.
The block is reversed to put it into the order in which elements
were added. Once pop'd, nothing should be added to the block.</pre></div><div class="public" id="var-push-block"><h3>push-block</h3><div class="usage"><code>(push-block action-plan)</code></div><pre class="doc">Push a block onto the action-plan
</pre></div><div class="public" id="var-reset-for-target"><h3>reset-for-target</h3><div class="usage"><code>(reset-for-target session)</code></div><pre class="doc">Reset the action plan for the current phase and target.
</pre></div><div class="public" id="var-script-template"><h3>script-template</h3><div class="usage"><code>(script-template session)</code></div><pre class="doc">Return the script template for the current group node.
</pre></div><div class="public" id="var-script-template-for-server"><h3>script-template-for-server</h3><div class="usage"><code>(script-template-for-server server)</code></div><pre class="doc">Return the script template for the specified server.
</pre></div><div class="public" id="var-target-path"><h3>target-path</h3><div class="usage"><code>(target-path session)</code></div><pre class="doc">Return the vector path of the action plan for the current session target
node, or target group.</pre></div><div class="public" id="var-transform-nested-scopes"><h3>transform-nested-scopes</h3><div class="usage"><code>(transform-nested-scopes action-plan)</code></div><pre class="doc">Traverses an action-plan structure. Converting nested scopes into
action-map's.</pre></div><div class="public" id="var-translate"><h3>translate</h3><div class="usage"><code>(translate action-plan)</code></div><pre class="doc">Process the action-plan, applying groupings and precedence, producing
an action plan with fully bound functions, ready for execution.

This is equivalent to using an identity monad with a monadic value
that is a tree of action maps.</pre></div><div class="public" id="var-translate-for-target"><h3>translate-for-target</h3><div class="usage"><code>(translate-for-target session)</code></div><pre class="doc">Build the action plan and translate for the current phase and target node.
</pre></div><div class="public" id="var-translated%3F"><h3>translated?</h3><div class="usage"><code>(translated? action-plan)</code></div><pre class="doc">Predicate to test if an action plan has been translated
</pre></div></div></body></html>