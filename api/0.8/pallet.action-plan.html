<html lang="en">
  <head>
    <title>pallet.action-plan documentation</title>
    <link href="css/default.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/page_effects.js"></script>
  </head>
  <body>
    <header>
      <div id="header">
        <h1 class="project-title">Pallet 0.8 API documentation</h1>
      </div>
    </header>
    <navigation>
      <div id="namespaces" class="sidebar">
        <h3>Namespaces</h3>
        <ul class="ns-links">
          <li class="ns-link"><a href="pallet.action.html">pallet.action</a></li><li class="ns-link"><a href="pallet.action-impl.html">pallet.action-impl</a></li><li class="ns-link"><a href="pallet.action-plan.html">pallet.action-plan</a></li><li class="ns-link"><a href="pallet.actions.html">pallet.actions</a></li><li class="ns-link"><a href="pallet.actions.direct.html">pallet.actions.direct</a></li><li class="ns-link"><a href="pallet.actions.direct.conditional.html">pallet.actions.direct.conditional</a></li><li class="ns-link"><a href="pallet.actions.direct.directory.html">pallet.actions.direct.directory</a></li><li class="ns-link"><a href="pallet.actions.direct.exec-script.html">pallet.actions.direct.exec-script</a></li><li class="ns-link"><a href="pallet.actions.direct.file.html">pallet.actions.direct.file</a></li><li class="ns-link"><a href="pallet.actions.direct.package.html">pallet.actions.direct.package</a></li><li class="ns-link"><a href="pallet.actions.direct.remote-directory.html">pallet.actions.direct.remote-directory</a></li><li class="ns-link"><a href="pallet.actions.direct.remote-file.html">pallet.actions.direct.remote-file</a></li><li class="ns-link"><a href="pallet.actions.direct.retry.html">pallet.actions.direct.retry</a></li><li class="ns-link"><a href="pallet.actions.direct.rsync.html">pallet.actions.direct.rsync</a></li><li class="ns-link"><a href="pallet.actions.direct.service.html">pallet.actions.direct.service</a></li><li class="ns-link"><a href="pallet.actions.direct.settings.html">pallet.actions.direct.settings</a></li><li class="ns-link"><a href="pallet.actions.direct.user.html">pallet.actions.direct.user</a></li><li class="ns-link"><a href="pallet.actions-impl.html">pallet.actions-impl</a></li><li class="ns-link"><a href="pallet.api.html">pallet.api</a></li><li class="ns-link"><a href="pallet.argument.html">pallet.argument</a></li><li class="ns-link"><a href="pallet.blobstore.html">pallet.blobstore</a></li><li class="ns-link"><a href="pallet.blobstore.implementation.html">pallet.blobstore.implementation</a></li><li class="ns-link"><a href="pallet.blobstore.url-blobstore.html">pallet.blobstore.url-blobstore</a></li><li class="ns-link"><a href="pallet.cache.html">pallet.cache</a></li><li class="ns-link"><a href="pallet.cache.impl.html">pallet.cache.impl</a></li><li class="ns-link"><a href="pallet.command-line.html">pallet.command-line</a></li><li class="ns-link"><a href="pallet.command-script.html">pallet.command-script</a></li><li class="ns-link"><a href="pallet.compute.hybrid.html">pallet.compute.hybrid</a></li><li class="ns-link"><a href="pallet.compute.implementation.html">pallet.compute.implementation</a></li><li class="ns-link"><a href="pallet.compute.jvm.html">pallet.compute.jvm</a></li><li class="ns-link"><a href="pallet.compute.node-list.html">pallet.compute.node-list</a></li><li class="ns-link"><a href="pallet.config-file.format.html">pallet.config-file.format</a></li><li class="ns-link"><a href="pallet.configure.html">pallet.configure</a></li><li class="ns-link"><a href="pallet.context.html">pallet.context</a></li><li class="ns-link"><a href="pallet.core.html">pallet.core</a></li><li class="ns-link"><a href="pallet.core.api.html">pallet.core.api</a></li><li class="ns-link"><a href="pallet.core.api-impl.html">pallet.core.api-impl</a></li><li class="ns-link"><a href="pallet.core.operations.html">pallet.core.operations</a></li><li class="ns-link"><a href="pallet.core.plan-state.html">pallet.core.plan-state</a></li><li class="ns-link"><a href="pallet.core.primitives.html">pallet.core.primitives</a></li><li class="ns-link"><a href="pallet.core.session.html">pallet.core.session</a></li><li class="ns-link"><a href="pallet.core.user.html">pallet.core.user</a></li><li class="ns-link"><a href="pallet.crate.html">pallet.crate</a></li><li class="ns-link"><a href="pallet.crate.automated-admin-user.html">pallet.crate.automated-admin-user</a></li><li class="ns-link"><a href="pallet.crate.crontab.html">pallet.crate.crontab</a></li><li class="ns-link"><a href="pallet.crate.environment.html">pallet.crate.environment</a></li><li class="ns-link"><a href="pallet.crate.etc-default.html">pallet.crate.etc-default</a></li><li class="ns-link"><a href="pallet.crate.etc-hosts.html">pallet.crate.etc-hosts</a></li><li class="ns-link"><a href="pallet.crate.filesystem.html">pallet.crate.filesystem</a></li><li class="ns-link"><a href="pallet.crate.network-service.html">pallet.crate.network-service</a></li><li class="ns-link"><a href="pallet.crate.package.centos.html">pallet.crate.package.centos</a></li><li class="ns-link"><a href="pallet.crate.package.debian-backports.html">pallet.crate.package.debian-backports</a></li><li class="ns-link"><a href="pallet.crate.package.epel.html">pallet.crate.package.epel</a></li><li class="ns-link"><a href="pallet.crate.package.jpackage.html">pallet.crate.package.jpackage</a></li><li class="ns-link"><a href="pallet.crate.package.rpmforge.html">pallet.crate.package.rpmforge</a></li><li class="ns-link"><a href="pallet.crate.package-repo.html">pallet.crate.package-repo</a></li><li class="ns-link"><a href="pallet.crate.ssh-key.html">pallet.crate.ssh-key</a></li><li class="ns-link"><a href="pallet.crate.sudoers.html">pallet.crate.sudoers</a></li><li class="ns-link"><a href="pallet.crate-install.html">pallet.crate-install</a></li><li class="ns-link"><a href="pallet.debug.html">pallet.debug</a></li><li class="ns-link"><a href="pallet.echo.execute.html">pallet.echo.execute</a></li><li class="ns-link"><a href="pallet.enlive.html">pallet.enlive</a></li><li class="ns-link"><a href="pallet.environment.html">pallet.environment</a></li><li class="ns-link"><a href="pallet.event.html">pallet.event</a></li><li class="ns-link"><a href="pallet.execute.html">pallet.execute</a></li><li class="ns-link"><a href="pallet.executors.html">pallet.executors</a></li><li class="ns-link"><a href="pallet.feature.html">pallet.feature</a></li><li class="ns-link"><a href="pallet.futures.html">pallet.futures</a></li><li class="ns-link"><a href="pallet.local.execute.html">pallet.local.execute</a></li><li class="ns-link"><a href="pallet.main.html">pallet.main</a></li><li class="ns-link"><a href="pallet.main-invoker.html">pallet.main-invoker</a></li><li class="ns-link"><a href="pallet.md5crypt.html">pallet.md5crypt</a></li><li class="ns-link"><a href="pallet.monad.html">pallet.monad</a></li><li class="ns-link"><a href="pallet.monad.state-accessors.html">pallet.monad.state-accessors</a></li><li class="ns-link"><a href="pallet.monad.state-monad.html">pallet.monad.state-monad</a></li><li class="ns-link"><a href="pallet.node-value.html">pallet.node-value</a></li><li class="ns-link"><a href="pallet.phase.html">pallet.phase</a></li><li class="ns-link"><a href="pallet.plugin.html">pallet.plugin</a></li><li class="ns-link"><a href="pallet.repl.html">pallet.repl</a></li><li class="ns-link"><a href="pallet.script.lib.html">pallet.script.lib</a></li><li class="ns-link"><a href="pallet.script-builder.html">pallet.script-builder</a></li><li class="ns-link"><a href="pallet.script-exec.html">pallet.script-exec</a></li><li class="ns-link"><a href="pallet.session.action-plan.html">pallet.session.action-plan</a></li><li class="ns-link"><a href="pallet.session.verify.html">pallet.session.verify</a></li><li class="ns-link"><a href="pallet.ssh.execute.html">pallet.ssh.execute</a></li><li class="ns-link"><a href="pallet.strint.html">pallet.strint</a></li><li class="ns-link"><a href="pallet.task.add-service.html">pallet.task.add-service</a></li><li class="ns-link"><a href="pallet.task.config.html">pallet.task.config</a></li><li class="ns-link"><a href="pallet.task.containers.html">pallet.task.containers</a></li><li class="ns-link"><a href="pallet.task.converge.html">pallet.task.converge</a></li><li class="ns-link"><a href="pallet.task.converge-cluster.html">pallet.task.converge-cluster</a></li><li class="ns-link"><a href="pallet.task.describe-node.html">pallet.task.describe-node</a></li><li class="ns-link"><a href="pallet.task.destroy-cluster.html">pallet.task.destroy-cluster</a></li><li class="ns-link"><a href="pallet.task.help.html">pallet.task.help</a></li><li class="ns-link"><a href="pallet.task.images.html">pallet.task.images</a></li><li class="ns-link"><a href="pallet.task.lift.html">pallet.task.lift</a></li><li class="ns-link"><a href="pallet.task.new-project.html">pallet.task.new-project</a></li><li class="ns-link"><a href="pallet.task.nodes.html">pallet.task.nodes</a></li><li class="ns-link"><a href="pallet.task.providers.html">pallet.task.providers</a></li><li class="ns-link"><a href="pallet.task.to-blob.html">pallet.task.to-blob</a></li><li class="ns-link"><a href="pallet.task.version.html">pallet.task.version</a></li><li class="ns-link"><a href="pallet.template.html">pallet.template</a></li><li class="ns-link"><a href="pallet.template.properties.html">pallet.template.properties</a></li><li class="ns-link"><a href="pallet.utils.html">pallet.utils</a></li><li class="ns-link"><a href="pallet.version-dispatch.html">pallet.version-dispatch</a></li><li class="ns-link"><a href="pallet.versions.html">pallet.versions</a></li>
        </ul>
      </div>
      <div id="vars" class="sidebar">
        <h3>Public Vars</h3>
        <ul class="ns-var-links">
          <li class="ns-var-link"><a href="pallet.action-plan.html#var-action-map">action-map</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-action-map-execution">action-map-execution</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-checked-commands">checked-commands</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-checked-commands*">checked-commands*</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-checked-script">checked-script</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-defining-context-string">defining-context-string</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-execute-action-map">execute-action-map</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-execute-if">execute-if</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-pop-block">pop-block</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-push-block">push-block</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-schedule-action-map">schedule-action-map</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-short-circuiting-state-m">short-circuiting-state-m</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-stop-execution-on-error">stop-execution-on-error</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-translate">translate</a></li><li class="ns-var-link"><a href="pallet.action-plan.html#var-translated%3F">translated?</a></li>
        </ul>
      </div>
    </navigation>
    <article>
      <div id="content" class="namespace-docs">
        <h2 class="namespace-title">pallet.action-plan documentation</h2>
        <div class="doc"><p>An action plan contains instances of actions (action maps) for execution.</p>

<p>The action plan is built by executing a phase function. Each phase function
calls actions which insert themselves into the action plan.</p>

<p>The action plan is transformed to provide aggregated operations, run delayed
crate functions, and to resolve precedence relations between actions.</p>

<p>A translated plan is executed by passing an executor, which is a function
that will be passed each action map in the plan.  The executor function is
responsible for selecting the implementation of the action to be used, and
calling the implementation with the action-map arguments.</p>

<p>Note this is an implementation namespace.</p>
</div>
        <div class="ns-vars">
          <div class="public">
            <h3 id="var-action-map">action-map</h3>
            <div class="usage">[action arg-vector {:as options}]</div>
            
            
            <div class="doc"><p>Return an action map for the given <code>action</code> and <code>args</code>. The action map is an
instance of an action. The action plan is a tree of action maps.</p>

<p><code>options</code> specifies naming and dependencies for this instance of the action,
and may contain :action-id, :always-before and :always-after keys. If an
<code>options</code> is supplied, an action-id is generated if none present, to ensure
that the standard action precedence is not altered. <code>:script-dir</code> and user
options like <code>:sudo-user</code> may also be specified. <code>:script-prefix</code> can
be used to prefix with something other than sudo.</p>

<ul>
<li>:action          the action that is scheduled,</li>
<li>:args            the arguments to pass to the action function,</li>
<li>:context         captures the phase context, for use at execution time,</li>
<li>:action-id       a keyword that identifies the instance of an action,</li>
<li>:always-before   a symbol, keyword or set thereof. A symbol references an
               action, and a keyword references an instance of an action,</li>
<li>:always-after    a symbol, keyword or set thereof,</li>
<li>:node-value-path a symbol specifying a node value (added when scheduled).</li>
</ul>

<p>The action is generated by the specified action function and arguments that
will be applied to the function when the action plan is executed.</p>
</div>
          </div><div class="public">
            <h3 id="var-action-map-execution">action-map-execution</h3>
            <div class="usage">[action-map]</div>
            
            
            <div class="doc"><p>Helper to return the execution of the action associated with an action-map.</p>
</div>
          </div><div class="public">
            <h3 id="var-checked-commands">checked-commands</h3>
            <div class="usage">[name &amp; script]</div>
            
            
            <div class="doc"><p>Return a stevedore script that uses the current context to label the
action</p>
</div>
          </div><div class="public">
            <h3 id="var-checked-commands*">checked-commands*</h3>
            <div class="usage">[name scripts]</div>
            
            
            <div class="doc"><p>Return a stevedore script that uses the current context to label the
action</p>
</div>
          </div><div class="public">
            <h3 id="var-checked-script">checked-script</h3>
            <div class="usage">[name &amp; script]</div>
            
            
            <div class="doc"><p>Return a stevedore script that uses the current context to label the
action</p>
</div>
          </div><div class="public">
            <h3 id="var-defining-context-string">defining-context-string</h3>
            <div class="usage">[]</div>
            
            
            <div class="doc"><p>Returns a context string for the defining phase context.</p>
</div>
          </div><div class="public">
            <h3 id="var-execute-action-map">execute-action-map</h3>
            <div class="usage">[executor session {:keys [node-value-path context], :as action}]</div>
            
            
            <div class="doc"><p>Execute a single action, catching any exception and reporting it as
an error map.</p>
</div>
          </div><div class="public">
            <h3 id="var-execute-if">execute-if</h3>
            <div class="usage">[session {:keys [blocks], :as action} value]</div>
            
            
            <div class="doc"><p>Execute an if action</p>
</div>
          </div><div class="public">
            <h3 id="var-pop-block">pop-block</h3>
            <div class="usage">[action-plan]</div>
            
            
            <div class="doc"><p>Take the last block and add it to the :blocks key of the scope below it in
the stack.  The block is reversed to put it into the order in which elements
were added.</p>
</div>
          </div><div class="public">
            <h3 id="var-push-block">push-block</h3>
            <div class="usage">[action-plan]</div>
            
            
            <div class="doc"><p>Push a block onto the action-plan</p>
</div>
          </div><div class="public">
            <h3 id="var-schedule-action-map">schedule-action-map</h3>
            <div class="usage">[action-plan action-map]</div>
            
            
            <div class="doc"><p>Registers an action map in the action plan for execution. This function is
responsible for creating a node-value (as node-value-path's have to be unique
for all instances of an aggregated action) as a handle to the value that will
be returned when the action map is executed.</p>
</div>
          </div><div class="public">
            <h3 id="var-short-circuiting-state-m">short-circuiting-state-m</h3>
            
            
            
            <div class="doc"><p>Monad describing stateful computations. The monadic values have the
structure (fn [old-state] [result new-state]). If result is a map with
:action-plan/flag set to :action-plan/stop, then further calculations are
short circuited.</p>
</div>
          </div><div class="public">
            <h3 id="var-stop-execution-on-error">stop-execution-on-error</h3>
            <div class="usage">[[result session]]</div>
            
            
            <div class="doc"><p>:execute-status-fn algorithm to stop execution on an error</p>
</div>
          </div><div class="public">
            <h3 id="var-translate">translate</h3>
            <div class="usage">[action-plan session]</div>
            
            
            <div class="doc"><p>Process the action-plan, applying groupings and precedence, producing
an action plan with fully bound functions, ready for execution.</p>

<p>This is equivalent to using an identity monad with a monadic value
that is a tree of action maps.</p>
</div>
          </div><div class="public">
            <h3 id="var-translated%3F">translated?</h3>
            <div class="usage">[action-plan]</div>
            
            
            <div class="doc"><p>Predicate to test if an action plan has been translated</p>
</div>
          </div>
        </div>
      </div>
    </article>
  </body>

</html>