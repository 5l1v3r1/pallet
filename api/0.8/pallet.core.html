<html lang="en">
  <head>
    <title>pallet.core documentation</title>
    <link href="css/default.css" type="text/css" rel="stylesheet" />
    <link href="css/codox-md.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/page_effects.js"></script>
  </head>
  <body>
    <header>
    <div data-scrollspy="scrollspy" class="topbar">
      <div class="topbar-inner">
        <div class="container">
          <a href="/" class="brand">Pallet</a>
          <ul class="nav">
            <li class=""><a href="/doc">Documentation</a></li>
            <li class=""><a href="/news">News</a></li>
            <li class=""><a href="/blog">Blog</a></li>
            <li class=""><a href="https://github.com/pallet/pallet">Code</a></li>
            <li class=""><a href="/services">Services</a></li>
            <li class=""><a href="/support">Support</a></li>
            <li class=""><a href="/contact">Contact</a></li>
          </ul>
          <form action="http://www.google.com/search" method="get" class="pull-right">
            <input placeholder="Search" value="" maxlength="255" name="q" type="text" />
            <input value="palletops.com" type="hidden" name="sitesearch" />
          </form>
        </div>
      </div>
    </div>
      <div id="header">
        <h1><a href="http://palletops.com"><span class="project-title">Pallet 0.8.0-RC.3 API documentation</span></a></h1>
      </div>
    </header>
    <navigation>
      <div id="namespaces" class="sidebar">
        <h3>Namespaces</h3>
        <ul class="ns-links">
          <li class="ns-list"><a class="ns-link ns-name" href="pallet.action.html">pallet.action</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.action-impl.html">pallet.action-impl</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.action-plan.html">pallet.action-plan</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.actions.html">pallet.actions</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.actions.direct.html">pallet.actions.direct</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.actions.direct.conditional.html">pallet.actions.direct.conditional</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.actions.direct.directory.html">pallet.actions.direct.directory</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.actions.direct.exec-script.html">pallet.actions.direct.exec-script</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.actions.direct.file.html">pallet.actions.direct.file</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.actions.direct.package.html">pallet.actions.direct.package</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.actions.direct.remote-directory.html">pallet.actions.direct.remote-directory</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.actions.direct.remote-file.html">pallet.actions.direct.remote-file</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.actions.direct.retry.html">pallet.actions.direct.retry</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.actions.direct.rsync.html">pallet.actions.direct.rsync</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.actions.direct.service.html">pallet.actions.direct.service</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.actions.direct.settings.html">pallet.actions.direct.settings</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.actions.direct.user.html">pallet.actions.direct.user</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.actions-impl.html">pallet.actions-impl</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.api.html">pallet.api</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.argument.html">pallet.argument</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.blobstore.html">pallet.blobstore</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.blobstore.implementation.html">pallet.blobstore.implementation</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.blobstore.url-blobstore.html">pallet.blobstore.url-blobstore</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.command-line.html">pallet.command-line</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.compute.html">pallet.compute</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.compute.hybrid.html">pallet.compute.hybrid</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.compute.implementation.html">pallet.compute.implementation</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.compute.jvm.html">pallet.compute.jvm</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.compute.localhost.html">pallet.compute.localhost</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.compute.node-list.html">pallet.compute.node-list</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.config-file.format.html">pallet.config-file.format</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.configure.html">pallet.configure</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.context.html">pallet.context</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.contracts.html">pallet.contracts</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.core.html">pallet.core</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.core.api.html">pallet.core.api</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.core.api-impl.html">pallet.core.api-impl</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.core.data-api.html">pallet.core.data-api</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.core.operations.html">pallet.core.operations</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.core.plan-state.html">pallet.core.plan-state</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.core.primitives.html">pallet.core.primitives</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.core.session.html">pallet.core.session</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.core.thread-local.html">pallet.core.thread-local</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.core.user.html">pallet.core.user</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.core.version-dispatch.html">pallet.core.version-dispatch</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.html">pallet.crate</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.automated-admin-user.html">pallet.crate.automated-admin-user</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.crontab.html">pallet.crate.crontab</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.environment.html">pallet.crate.environment</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.etc-default.html">pallet.crate.etc-default</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.etc-hosts.html">pallet.crate.etc-hosts</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.filesystem.html">pallet.crate.filesystem</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.initd.html">pallet.crate.initd</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.limits-conf.html">pallet.crate.limits-conf</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.network-service.html">pallet.crate.network-service</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.nohup.html">pallet.crate.nohup</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.os.html">pallet.crate.os</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.package.centos.html">pallet.crate.package.centos</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.package.debian-backports.html">pallet.crate.package.debian-backports</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.package.epel.html">pallet.crate.package.epel</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.package.jpackage.html">pallet.crate.package.jpackage</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.package.rpmforge.html">pallet.crate.package.rpmforge</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.package-repo.html">pallet.crate.package-repo</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.service.html">pallet.crate.service</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.ssh-key.html">pallet.crate.ssh-key</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate.sudoers.html">pallet.crate.sudoers</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.crate-install.html">pallet.crate-install</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.debug.html">pallet.debug</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.echo.execute.html">pallet.echo.execute</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.enlive.html">pallet.enlive</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.environment.html">pallet.environment</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.environment-impl.html">pallet.environment-impl</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.event.html">pallet.event</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.execute.html">pallet.execute</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.executors.html">pallet.executors</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.feature.html">pallet.feature</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.futures.html">pallet.futures</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.local.execute.html">pallet.local.execute</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.main.html">pallet.main</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.main-invoker.html">pallet.main-invoker</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.md5crypt.html">pallet.md5crypt</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.node.html">pallet.node</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.node-value.html">pallet.node-value</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.phase.html">pallet.phase</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.plugin.html">pallet.plugin</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.project.html">pallet.project</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.project.load.html">pallet.project.load</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.project.loader.html">pallet.project.loader</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.script.lib.html">pallet.script.lib</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.script-builder.html">pallet.script-builder</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.script-exec.html">pallet.script-exec</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.session.action-plan.html">pallet.session.action-plan</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.session.verify.html">pallet.session.verify</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.ssh.credentials.html">pallet.ssh.credentials</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.ssh.execute.html">pallet.ssh.execute</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.strint.html">pallet.strint</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.html">pallet.task</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.add-service.html">pallet.task.add-service</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.bootstrap.html">pallet.task.bootstrap</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.config.html">pallet.task.config</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.containers.html">pallet.task.containers</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.converge.html">pallet.task.converge</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.describe-node.html">pallet.task.describe-node</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.down.html">pallet.task.down</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.help.html">pallet.task.help</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.images.html">pallet.task.images</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.lift.html">pallet.task.lift</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.nodes.html">pallet.task.nodes</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.project-init.html">pallet.task.project-init</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.providers.html">pallet.task.providers</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.to-blob.html">pallet.task.to-blob</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.up.html">pallet.task.up</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task.version.html">pallet.task.version</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.task-utils.html">pallet.task-utils</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.template.html">pallet.template</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.template.properties.html">pallet.template.properties</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.utils.html">pallet.utils</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.version-dispatch.html">pallet.version-dispatch</a></li><li class="ns-list"><a class="ns-link ns-name" href="pallet.versions.html">pallet.versions</a></li>
        </ul>
      </div>
      <div id="vars" class="sidebar">
        <h3>Public Vars</h3>
        <ul class="ns-var-links">
          <li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-cluster-spec">cluster-spec</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-compute-service">compute-service</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-converge">converge</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-converge*">converge*</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-environment-args">environment-args</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-execute-on-unflagged-metadata">execute-on-unflagged-metadata</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-execute-with-image-credentials-metadata">execute-with-image-credentials-metadata</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-expand-cluster-groups">expand-cluster-groups</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-expand-group-spec-with-counts">expand-group-spec-with-counts</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-extend-specs">extend-specs</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-group-node-maps">group-node-maps</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-group-nodes">group-nodes</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-group-spec">group-spec</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-lift">lift</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-lift*">lift*</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-lift-nodes">lift-nodes</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-make-user">make-user</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-node-spec">node-spec</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-plan-fn">plan-fn</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-print-nodes">print-nodes</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-print-targets">print-targets</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-server-spec">server-spec</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-split-groups-and-targets">split-groups-and-targets</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-version">version</a></li><li class="ns-var-list"><a class="ns-var-link ns-var-name" href="pallet.core.html#var-with-admin-user">with-admin-user</a></li>
        </ul>
      </div>
    </navigation>
    <article>
      <div id="content" class="namespace-docs">
        <h2 class="namespace-title">pallet.core documentation</h2>
        <div class="doc"><p>Namespace for compatibility with pallet 0.7.x and earlier</p>
</div>
        <div class="ns-vars">
          <div class="public">
            <h3><a id="var-cluster-spec" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L245">cluster-spec</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[cluster-name &amp; {:keys [extends groups phases node-spec roles], :as options}]</div>
            
            
            <div class="doc"><p>Create a cluster-spec.</p>

<p><code>name</code> is used as a prefix for all groups in the cluster.</p>

<ul>
<li><p>:groups    specify a sequence of groups that define the cluster</p></li>
<li><p>:extends   specify a server-spec, a group-spec, or sequence thereof
         for all groups in the cluster</p></li>
<li><p>:phases    define phases on all groups.</p></li>
<li><p>:node-spec default node-spec for the nodes in the cluster</p></li>
<li><p>:roles     roles for all group-specs in the cluster</p></li>
</ul>
</div>
          </div><div class="public">
            <h3><a id="var-compute-service" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L288">compute-service</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[service-or-provider-name &amp; options]</div>
            
            
            <div class="doc"><p>Returns a compute service object, used to perform actions on a cloud
provider.</p>
</div>
          </div><div class="public">
            <h3><a id="var-converge" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L478">converge</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[group-spec-&gt;count &amp; {:keys [compute blobstore user phase all-nodes all-node-set environment async timeout-ms timeout-val debug plan-state], :as options}]</div>
            
            
            <div class="doc"><p>Converge the existing compute resources with the counts specified in
<code>group-spec-&gt;count</code>. New nodes are started, or nodes are destroyed to obtain the
specified node counts.</p>

<p><code>group-spec-&gt;count</code> can be a map from group-spec to node count, or can be a
sequence of group-specs containing a :count key.</p>

<p>This applies the <code>:bootstrap</code> phase to all new nodes and, by default,
the :configure phase to all running nodes whose group-name matches a key in the
node map.  Phases can also be specified with the <code>:phase</code> option, and will be
applied to all matching nodes.  The :configure phase is the default phase
applied.</p>

<h2>Options</h2>

<p><code>:compute</code>
: a compute service.</p>

<p><code>:blobstore</code>
: a blobstore service.</p>

<p><code>:phase</code>
: a phase keyword, phase function, or sequence of these.</p>

<p><code>:user</code>
the admin-user on the nodes.</p>

<h3>Partitioning</h3>

<p><code>:partition-f</code>
: a function that takes a sequence of targets, and returns a sequence of
  sequences of targets.  Used to partition or filter the targets.  Defaults to
  any :partition metadata on the phase, or no partitioning otherwise.</p>

<h2>Post phase options</h2>

<p><code>:post-phase-f</code>
: specifies an optional function that is run after a phase is applied.  It is
  passed <code>targets</code>, <code>phase</code> and <code>results</code> arguments, and is called before any
  error checking is done.  The return value is ignored, so this is for side
  affect only.</p>

<p><code>:post-phase-fsm</code>
: specifies an optional fsm returning function that is run after a phase is
  applied.  It is passed <code>targets</code>, <code>phase</code> and <code>results</code> arguments, and is
  called before any error checking is done.  The return value is ignored, so
  this is for side affect only.</p>

<h3>Asynchronous and Timeouts</h3>

<p><code>:async</code>
: a flag to control whether the function executes asynchronously.  When truthy,
  the function returns an Operation that can be deref'd like a future.  When not
  truthy, <code>:timeout-ms</code> may be used to specify a timeout.  Defaults to nil.</p>

<p><code>:timeout-ms</code>
: an integral number of milliseconds to wait for completion before timeout.
  Only applies if <code>:async</code> is not truthy (the default).</p>

<p><code>:timeout-val</code>
: a value to be returned should the operation time out.</p>

<h3>Algorithm options</h3>

<p><code>:phase-execution-f</code>
: specifies the function used to execute a phase on the targets.  Defaults
  to <code>pallet.core.primitives/build-and-execute-phase</code>.</p>

<p><code>:execution-settings-f</code>
: specifies a function that will be called with a node argument, and which
  should return a map with <code>:user</code>, <code>:executor</code> and <code>:executor-status-fn</code> keys.</p>

<h3>OS detection</h3>

<p><code>:os-detect</code>
: controls detection of nodes' os (default true).</p>
</div>
          </div><div class="public">
            <h3><a id="var-converge*" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L406">converge*</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[group-spec-&gt;count &amp; {:keys [compute blobstore user phase all-nodes all-node-set environment plan-state debug os-detect], :or {os-detect true}, :as options}]</div>
            
            
            <div class="doc"><p>Returns a FSM to converge the existing compute resources with the counts
specified in <code>group-spec-&gt;count</code>.  Options are as for <code>converge</code>.</p>
</div>
          </div><div class="public">
            <h3><a id="var-environment-args" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L391">environment-args</a></h3>
            <h4 class="var-type var" id="var-type">var</h4>
            
            
            
            <div class="doc"><p>Arguments that are forwarded to be part of the environment</p>
</div>
          </div><div class="public">
            <h3><a id="var-execute-on-unflagged-metadata" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L104">execute-on-unflagged-metadata</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[flag-kw]</div>
            
            
            <div class="doc"><p>Returns a metadata map that specifies a phase should be run only if the
specified <code>flag-kw</code> is not set on a node.  The map is suitable for use as a
value in a map passed to the <code>:phases-meta</code> clause of a <code>server-spec</code> or
<code>group-spec</code>.</p>
</div>
          </div><div class="public">
            <h3><a id="var-execute-with-image-credentials-metadata" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L96">execute-with-image-credentials-metadata</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[]</div>
            
            
            <div class="doc"><p>Returns a metadata map that specifies a phase should be run using the image
credentials (rather than the admin-user).  The map is suitable for use as a
value in a map passed to the <code>:phases-meta</code> clause of a <code>server-spec</code> or
<code>group-spec</code>.</p>
</div>
          </div><div class="public">
            <h3><a id="var-expand-cluster-groups" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L340">expand-cluster-groups</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[node-set]</div>
            
            
            <div class="doc"><p>Expand a node-set into its groups</p>
</div>
          </div><div class="public">
            <h3><a id="var-expand-group-spec-with-counts" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L217">expand-group-spec-with-counts</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[node-set spec-count]</div><div class="usage">[node-set]</div>
            
            
            <div class="doc"><p>Expand a converge node spec into its groups</p>
</div>
          </div><div class="public">
            <h3><a id="var-extend-specs" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L114">extend-specs</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[spec inherits algorithms]</div><div class="usage">[spec inherits]</div>
            
            
            <div class="doc"><p>Merge in the inherited specs</p>
</div>
          </div><div class="public">
            <h3><a id="var-group-node-maps" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L394">group-node-maps</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[compute groups &amp; {:keys [async timeout-ms timeout-val], :as options}]</div>
            
            
            <div class="doc"><p>Returns a FSM to converge the existing compute resources with the counts
specified in <code>group-spec-&gt;count</code>.  Options are as for <code>converge</code>.</p>
</div>
          </div><div class="public">
            <h3><a id="var-group-nodes" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L771">group-nodes</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[compute groups &amp; {:keys [async timeout-ms timeout-val]}]</div>
            
            
            <div class="doc"><p>Return a sequence of node-maps for each node in the specified group-specs.</p>

<h2>Options:</h2>

<p><code>:async</code>
: a flag to control whether the function executes asynchronously.  When truthy,
  the function returns an Operation that can be deref'd like a future.  When not
  truthy, <code>:timeout-ms</code> may be used to specify a timeout.  Defaults to nil.</p>

<p><code>:timeout-ms</code>
: an integral number of milliseconds to wait for completion before timeout.
  Only applies if <code>:async</code> is not truthy (the default).</p>

<p><code>:timeout-val</code>
: a value to be returned should the operation time out.</p>
</div>
          </div><div class="public">
            <h3><a id="var-group-spec" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L165">group-spec</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[name &amp; {:keys [extends count image phases phases-meta default-phases packager node-spec roles node-filter], :as options}]</div>
            
            
            <div class="doc"><p>Create a group-spec.</p>

<p><code>name</code> is used for the group name, which is set on each node and links a node
to its node-spec</p>

<ul>
<li><p>:extends        specify a server-spec, a group-spec, or sequence thereof
              and is used to inherit phases, etc.</p></li>
<li><p>:phases         used to define phases. Standard phases are:</p></li>
<li>:phases-meta    metadata to add to the phases</li>
<li>:default-phases a sequence specifying the default phases</li>
<li>:bootstrap      run on first boot of a new node</li>
<li><p>:configure      defines the configuration of the node.</p></li>
<li><p>:count          specify the target number of nodes for this node-spec</p></li>
<li>:packager       override the choice of packager to use</li>
<li>:node-spec      default node-spec for this group-spec</li>
<li>:node-filter    a predicate that tests if a node is a member of this
              group.</li>
</ul>
</div>
          </div><div class="public">
            <h3><a id="var-lift" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L625">lift</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[node-set &amp; {:keys [compute phase user all-node-set environment async timeout-ms timeout-val partition-f post-phase-f post-phase-fsm phase-execution-f execution-settings-f debug plan-state], :as options}]</div>
            
            
            <div class="doc"><p>Lift the running nodes in the specified node-set by applying the specified
phases.  The compute service may be supplied as an option, otherwise the
bound compute-service is used.  The configure phase is applied by default
unless other phases are specified.</p>

<p>node-set can be a group spec, a sequence of group specs, or a map
of group specs to nodes. Examples:</p>

<pre><code>[group-spec1 group-spec2 {group-spec #{node1 node2}}]
group-spec
{group-spec #{node1 node2}}
</code></pre>

<h2>Options:</h2>

<p><code>:compute</code>
: a compute service.</p>

<p><code>:blobstore</code>
: a blobstore service.</p>

<p><code>:phase</code>
: a phase keyword, phase function, or sequence of these.</p>

<p><code>:user</code>
the admin-user on the nodes.</p>

<h3>Partitioning</h3>

<p><code>:partition-f</code>
: a function that takes a sequence of targets, and returns a sequence of
  sequences of targets.  Used to partition or filter the targets.  Defaults to
  any :partition metadata on the phase, or no partitioning otherwise.</p>

<h2>Post phase options</h2>

<p><code>:post-phase-f</code>
: specifies an optional function that is run after a phase is applied.  It is
  passed <code>targets</code>, <code>phase</code> and <code>results</code> arguments, and is called before any
  error checking is done.  The return value is ignored, so this is for side
  affect only.</p>

<p><code>:post-phase-fsm</code>
: specifies an optional fsm returning function that is run after a phase is
  applied.  It is passed <code>targets</code>, <code>phase</code> and <code>results</code> arguments, and is
  called before any error checking is done.  The return value is ignored, so
  this is for side affect only.</p>

<h3>Asynchronous and Timeouts</h3>

<p><code>:async</code>
: a flag to control whether the function executes asynchronously.  When truthy,
  the function returns an Operation that can be deref'd like a future.  When not
  truthy, <code>:timeout-ms</code> may be used to specify a timeout.  Defaults to nil.</p>

<p><code>:timeout-ms</code>
: an integral number of milliseconds to wait for completion before timeout.
  Only applies if <code>:async</code> is not truthy (the default).</p>

<p><code>:timeout-val</code>
: a value to be returned should the operation time out.</p>

<h3>Algorithm options</h3>

<p><code>:phase-execution-f</code>
: specifies the function used to execute a phase on the targets.  Defaults
  to <code>pallet.core.primitives/build-and-execute-phase</code>.</p>

<p><code>:execution-settings-f</code>
: specifies a function that will be called with a node argument, and which
  should return a map with <code>:user</code>, <code>:executor</code> and <code>:executor-status-fn</code> keys.</p>

<h3>OS detection</h3>

<p><code>:os-detect</code>
: controls detection of nodes' os (default true).</p>
</div>
          </div><div class="public">
            <h3><a id="var-lift*" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L568">lift*</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[node-set &amp; {:keys [compute phase all-node-set environment debug plan-state os-detect], :or {os-detect true}, :as options}]</div>
            
            
            <div class="doc"><p>Returns a FSM to lift the running nodes in the specified node-set by applying
the specified phases.  Options as specified in <code>lift</code>.</p>
</div>
          </div><div class="public">
            <h3><a id="var-lift-nodes" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L715">lift-nodes</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[targets phases &amp; {:keys [user environment plan-state async timeout-ms timeout-val], :or {environment {}, plan-state {}}, :as options}]</div>
            
            
            <div class="doc"><p>Lift <code>targets</code>, a sequence of node-maps, using the specified <code>phases</code>.  This
provides a way of lifting phases, which doesn't tie you to working with all
nodes in a group.  Consider using this only if the functionality in <code>lift</code> is
insufficient.</p>

<p><code>phases</code>
: a sequence of phase keywords (identifying phases) or plan functions, that
  should be applied to the target nodes.  Note that there are no default phases.</p>

<h2>Options:</h2>

<p><code>:user</code>
: the admin-user to use for operations on the target nodes.</p>

<p><code>:environment</code>
: an environment map, to be merged into the environment.</p>

<p><code>:plan-state</code>
: an state map, which can be used to passing settings across multiple lift-nodes
  invocations.</p>

<p><code>:async</code>
: a flag to control whether the function executes asynchronously.  When truthy,
  the function returns an Operation that can be deref'd like a future.  When not
  truthy, <code>:timeout-ms</code> may be used to specify a timeout.  Defaults to nil.</p>

<p><code>:timeout-ms</code>
: an integral number of milliseconds to wait for completion before timeout.
  Only applies if <code>:async</code> is not truthy (the default).</p>

<p><code>:timeout-val</code>
: a value to be returned should the operation time out.</p>
</div>
          </div><div class="public">
            <h3><a id="var-make-user" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L796">make-user</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[username &amp; {:keys [public-key-path private-key-path passphrase password sudo-password no-sudo sudo-user], :as options}]</div>
            
            
            <div class="doc"><p>Creates a User record with the given username and options. Generally used
in conjunction with <em>admin-user</em> and pallet.api/with-admin-user, or passed
to <code>lift</code> or <code>converge</code> as the named :user argument.</p>

<p>Options:
 - :public-key-path (defaults to ~/.ssh/id_rsa.pub)
 - :private-key-path (defaults to ~/.ssh/id_rsa)
 - :passphrase
 - :password
 - :sudo-password (defaults to :password)
 - :no-sudo</p>
</div>
          </div><div class="public">
            <h3><a id="var-node-spec" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L59">node-spec</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[&amp; {:keys [image hardware location network qos], :as options}]</div>
            
            
            <div class="doc"><p>Create a node-spec.</p>

<p>Defines the compute image and hardware selector template.</p>

<p>This is used to filter a cloud provider's image and hardware list to select
an image and hardware for nodes created for this node-spec.</p>

<p>:image     a map describing a predicate for matching an image:
           os-family os-name-matches os-version-matches
           os-description-matches os-64-bit
           image-version-matches image-name-matches
           image-description-matches image-id</p>

<p>:location  a map describing a predicate for matching location:
           location-id
:hardware  a map describing a predicate for matching hardware:
           min-cores min-ram smallest fastest biggest architecture
           hardware-id
:network   a map for network connectivity options:
           inbound-ports
:qos       a map for quality of service options:
           spot-price enable-monitoring</p>
</div>
          </div><div class="public">
            <h3><a id="var-plan-fn" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L295">plan-fn</a></h3>
            <h4 class="var-type macro" id="var-type">macro</h4>
            <div class="usage">[&amp; body]</div>
            
            
            <div class="doc"><p>Create a plan function from a sequence of plan function invocations.</p>

<p>eg. (plan-fn
      (file "/some-file")
      (file "/other-file"))</p>

<p>This generates a new plan function, and adds code to verify the state
around each plan function call.</p>
</div>
          </div><div class="public">
            <h3><a id="var-print-nodes" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L832">print-nodes</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[nodes]</div>
            
            
            <div class="doc"><p>Print the targets of an operation</p>
</div>
          </div><div class="public">
            <h3><a id="var-print-targets" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L841">print-targets</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[op]</div>
            
            
            <div class="doc"><p>Print the targets of an operation</p>
</div>
          </div><div class="public">
            <h3><a id="var-server-spec" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L130">server-spec</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[&amp; {:keys [phases phases-meta default-phases packager node-spec extends roles], :as options}]</div>
            
            
            <div class="doc"><p>Create a server-spec.</p>

<ul>
<li>:phases         a hash-map used to define phases. Phases are inherited by
                 anything that :extends the server-spec.
                 Standard phases are:
<ul><li>:bootstrap    run on first boot of a new node</li>
<li>:configure    defines the configuration of the node</li></ul></li>
<li>:default-phases a sequence specifying the default phases</li>
<li>:phases-meta    metadata to add to the phases</li>
<li>:extends        takes a server-spec, or sequence thereof, and is used to
                 inherit phases, etc.</li>
<li>:roles          defines a sequence of roles for the server-spec. Inherited
                 by anything that :extends the server-spec.</li>
<li>:node-spec      default node-spec for this server-spec</li>
<li>:packager       override the choice of packager to use</li>
</ul>

<p>For a given phase, inherited phase functions are run first, in the order
specified in the <code>:extends</code> argument.</p>
</div>
          </div><div class="public">
            <h3><a id="var-split-groups-and-targets" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L350">split-groups-and-targets</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[node-set]</div>
            
            
            <div class="doc"><p>Split a node-set into groups and targets. Returns a map with
:groups and :targets keys</p>
</div>
          </div><div class="public">
            <h3><a id="var-version" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L40">version</a></h3>
            <h4 class="var-type fn" id="var-type">fn</h4>
            <div class="usage">[]</div>
            
            
            <div class="doc"><p>Returns the pallet version.</p>
</div>
          </div><div class="public">
            <h3><a id="var-with-admin-user" class="source var-name" href="https://github.com/pallet/pallet/blob/develop/src/pallet/api.clj#L820">with-admin-user</a></h3>
            <h4 class="var-type macro" id="var-type">macro</h4>
            <div class="usage">[user &amp; exprs]</div>
            
            
            <div class="doc"><p>Specify the admin user for running remote commands.  The user is specified
either as pallet.utils.User record (see the pallet.utils/make-user
convenience fn) or as an argument list that will be passed to make-user.</p>

<p>This is mainly for use at the repl, since the admin user can be specified
functionally using the :user key in a lift or converge call, or in the
environment.</p>
</div>
          </div>
        </div>
      </div>
    </article>
  </body>

</html>