<html lang="en">
  <head>
    <title>pallet.action documentation</title>
    <link href="css/default.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/page_effects.js"></script>
  </head>
  <body>
    <header>
      <div id="header">
        <h1 class="project-title">Pallet 0.7 API documentation</h1>
      </div>
    </header>
    <navigation>
      <div id="namespaces" class="sidebar">
        <h3>Namespaces</h3>
        <ul class="ns-links">
          <li class="ns-link"><a href="pallet.action.html">pallet.action</a></li><li class="ns-link"><a href="pallet.action.conditional.html">pallet.action.conditional</a></li><li class="ns-link"><a href="pallet.action.directory.html">pallet.action.directory</a></li><li class="ns-link"><a href="pallet.action.environment.html">pallet.action.environment</a></li><li class="ns-link"><a href="pallet.action.exec-script.html">pallet.action.exec-script</a></li><li class="ns-link"><a href="pallet.action.file.html">pallet.action.file</a></li><li class="ns-link"><a href="pallet.action.filesystem.html">pallet.action.filesystem</a></li><li class="ns-link"><a href="pallet.action.package.html">pallet.action.package</a></li><li class="ns-link"><a href="pallet.action.package.centos.html">pallet.action.package.centos</a></li><li class="ns-link"><a href="pallet.action.package.debian-backports.html">pallet.action.package.debian-backports</a></li><li class="ns-link"><a href="pallet.action.package.epel.html">pallet.action.package.epel</a></li><li class="ns-link"><a href="pallet.action.package.jpackage.html">pallet.action.package.jpackage</a></li><li class="ns-link"><a href="pallet.action.package.rpmforge.html">pallet.action.package.rpmforge</a></li><li class="ns-link"><a href="pallet.action.remote-directory.html">pallet.action.remote-directory</a></li><li class="ns-link"><a href="pallet.action.remote-file.html">pallet.action.remote-file</a></li><li class="ns-link"><a href="pallet.action.retry.html">pallet.action.retry</a></li><li class="ns-link"><a href="pallet.action.rsync.html">pallet.action.rsync</a></li><li class="ns-link"><a href="pallet.action.service.html">pallet.action.service</a></li><li class="ns-link"><a href="pallet.action.user.html">pallet.action.user</a></li><li class="ns-link"><a href="pallet.action-plan.html">pallet.action-plan</a></li><li class="ns-link"><a href="pallet.argument.html">pallet.argument</a></li><li class="ns-link"><a href="pallet.blobstore.html">pallet.blobstore</a></li><li class="ns-link"><a href="pallet.blobstore.implementation.html">pallet.blobstore.implementation</a></li><li class="ns-link"><a href="pallet.blobstore.url-blobstore.html">pallet.blobstore.url-blobstore</a></li><li class="ns-link"><a href="pallet.command-line.html">pallet.command-line</a></li><li class="ns-link"><a href="pallet.command-script.html">pallet.command-script</a></li><li class="ns-link"><a href="pallet.compute.html">pallet.compute</a></li><li class="ns-link"><a href="pallet.compute.hybrid.html">pallet.compute.hybrid</a></li><li class="ns-link"><a href="pallet.compute.implementation.html">pallet.compute.implementation</a></li><li class="ns-link"><a href="pallet.compute.jvm.html">pallet.compute.jvm</a></li><li class="ns-link"><a href="pallet.compute.node-list.html">pallet.compute.node-list</a></li><li class="ns-link"><a href="pallet.config-file.format.html">pallet.config-file.format</a></li><li class="ns-link"><a href="pallet.configure.html">pallet.configure</a></li><li class="ns-link"><a href="pallet.core.html">pallet.core</a></li><li class="ns-link"><a href="pallet.crate.automated-admin-user.html">pallet.crate.automated-admin-user</a></li><li class="ns-link"><a href="pallet.crate.crontab.html">pallet.crate.crontab</a></li><li class="ns-link"><a href="pallet.crate.environment.html">pallet.crate.environment</a></li><li class="ns-link"><a href="pallet.crate.etc-default.html">pallet.crate.etc-default</a></li><li class="ns-link"><a href="pallet.crate.etc-hosts.html">pallet.crate.etc-hosts</a></li><li class="ns-link"><a href="pallet.crate.network-service.html">pallet.crate.network-service</a></li><li class="ns-link"><a href="pallet.crate.package-repo.html">pallet.crate.package-repo</a></li><li class="ns-link"><a href="pallet.crate.ssh-key.html">pallet.crate.ssh-key</a></li><li class="ns-link"><a href="pallet.crate.sudoers.html">pallet.crate.sudoers</a></li><li class="ns-link"><a href="pallet.debug.html">pallet.debug</a></li><li class="ns-link"><a href="pallet.enlive.html">pallet.enlive</a></li><li class="ns-link"><a href="pallet.environment.html">pallet.environment</a></li><li class="ns-link"><a href="pallet.execute.html">pallet.execute</a></li><li class="ns-link"><a href="pallet.futures.html">pallet.futures</a></li><li class="ns-link"><a href="pallet.main.html">pallet.main</a></li><li class="ns-link"><a href="pallet.main-invoker.html">pallet.main-invoker</a></li><li class="ns-link"><a href="pallet.map-merge.html">pallet.map-merge</a></li><li class="ns-link"><a href="pallet.md5crypt.html">pallet.md5crypt</a></li><li class="ns-link"><a href="pallet.node.html">pallet.node</a></li><li class="ns-link"><a href="pallet.parameter.html">pallet.parameter</a></li><li class="ns-link"><a href="pallet.phase.html">pallet.phase</a></li><li class="ns-link"><a href="pallet.repl.html">pallet.repl</a></li><li class="ns-link"><a href="pallet.request-map.html">pallet.request-map</a></li><li class="ns-link"><a href="pallet.resource.html">pallet.resource</a></li><li class="ns-link"><a href="pallet.resource.directory.html">pallet.resource.directory</a></li><li class="ns-link"><a href="pallet.resource.exec-script.html">pallet.resource.exec-script</a></li><li class="ns-link"><a href="pallet.resource.file.html">pallet.resource.file</a></li><li class="ns-link"><a href="pallet.resource.filesystem.html">pallet.resource.filesystem</a></li><li class="ns-link"><a href="pallet.resource.filesystem-layout.html">pallet.resource.filesystem-layout</a></li><li class="ns-link"><a href="pallet.resource.format.html">pallet.resource.format</a></li><li class="ns-link"><a href="pallet.resource.hostinfo.html">pallet.resource.hostinfo</a></li><li class="ns-link"><a href="pallet.resource.lib.html">pallet.resource.lib</a></li><li class="ns-link"><a href="pallet.resource.network-service.html">pallet.resource.network-service</a></li><li class="ns-link"><a href="pallet.resource.package.html">pallet.resource.package</a></li><li class="ns-link"><a href="pallet.resource.remote-directory.html">pallet.resource.remote-directory</a></li><li class="ns-link"><a href="pallet.resource.remote-file.html">pallet.resource.remote-file</a></li><li class="ns-link"><a href="pallet.resource.resource-when.html">pallet.resource.resource-when</a></li><li class="ns-link"><a href="pallet.resource.rsync.html">pallet.resource.rsync</a></li><li class="ns-link"><a href="pallet.resource.service.html">pallet.resource.service</a></li><li class="ns-link"><a href="pallet.resource.shell.html">pallet.resource.shell</a></li><li class="ns-link"><a href="pallet.resource.user.html">pallet.resource.user</a></li><li class="ns-link"><a href="pallet.script.lib.html">pallet.script.lib</a></li><li class="ns-link"><a href="pallet.session.html">pallet.session</a></li><li class="ns-link"><a href="pallet.shell.html">pallet.shell</a></li><li class="ns-link"><a href="pallet.strint.html">pallet.strint</a></li><li class="ns-link"><a href="pallet.target.html">pallet.target</a></li><li class="ns-link"><a href="pallet.task.add-service.html">pallet.task.add-service</a></li><li class="ns-link"><a href="pallet.task.config.html">pallet.task.config</a></li><li class="ns-link"><a href="pallet.task.containers.html">pallet.task.containers</a></li><li class="ns-link"><a href="pallet.task.converge.html">pallet.task.converge</a></li><li class="ns-link"><a href="pallet.task.converge-cluster.html">pallet.task.converge-cluster</a></li><li class="ns-link"><a href="pallet.task.describe-node.html">pallet.task.describe-node</a></li><li class="ns-link"><a href="pallet.task.destroy-cluster.html">pallet.task.destroy-cluster</a></li><li class="ns-link"><a href="pallet.task.help.html">pallet.task.help</a></li><li class="ns-link"><a href="pallet.task.images.html">pallet.task.images</a></li><li class="ns-link"><a href="pallet.task.lift.html">pallet.task.lift</a></li><li class="ns-link"><a href="pallet.task.new-project.html">pallet.task.new-project</a></li><li class="ns-link"><a href="pallet.task.nodes.html">pallet.task.nodes</a></li><li class="ns-link"><a href="pallet.task.providers.html">pallet.task.providers</a></li><li class="ns-link"><a href="pallet.task.to-blob.html">pallet.task.to-blob</a></li><li class="ns-link"><a href="pallet.task.version.html">pallet.task.version</a></li><li class="ns-link"><a href="pallet.template.html">pallet.template</a></li><li class="ns-link"><a href="pallet.template.properties.html">pallet.template.properties</a></li><li class="ns-link"><a href="pallet.utils.html">pallet.utils</a></li><li class="ns-link"><a href="pallet.version-dispatch.html">pallet.version-dispatch</a></li><li class="ns-link"><a href="pallet.versions.html">pallet.versions</a></li>
        </ul>
      </div>
      <div id="vars" class="sidebar">
        <h3>Public Vars</h3>
        <ul class="ns-var-links">
          <li class="ns-var-link"><a href="pallet.action.html#var-action">action</a></li><li class="ns-var-link"><a href="pallet.action.html#var-action-fn">action-fn</a></li><li class="ns-var-link"><a href="pallet.action.html#var-action-metadata">action-metadata</a></li><li class="ns-var-link"><a href="pallet.action.html#var-aggregated-action">aggregated-action</a></li><li class="ns-var-link"><a href="pallet.action.html#var-as-clj-action">as-clj-action</a></li><li class="ns-var-link"><a href="pallet.action.html#var-bash-action">bash-action</a></li><li class="ns-var-link"><a href="pallet.action.html#var-clj-action">clj-action</a></li><li class="ns-var-link"><a href="pallet.action.html#var-collected-action">collected-action</a></li><li class="ns-var-link"><a href="pallet.action.html#var-def-action-def">def-action-def</a></li><li class="ns-var-link"><a href="pallet.action.html#var-enter-scope">enter-scope</a></li><li class="ns-var-link"><a href="pallet.action.html#var-leave-scope">leave-scope</a></li><li class="ns-var-link"><a href="pallet.action.html#var-schedule-action">schedule-action</a></li><li class="ns-var-link"><a href="pallet.action.html#var-with-action-options">with-action-options</a></li><li class="ns-var-link"><a href="pallet.action.html#var-with-precedence">with-precedence</a></li>
        </ul>
      </div>
    </navigation>
    <article>
      <div id="content" class="namespace-docs">
        <h2 class="namespace-title">pallet.action documentation</h2>
        <div class="doc"><p>Actions implement the conversion of phase functions to script and other
execution code.</p>

<p>An action has an <code>:action-type</code>. Known types include <code>:script/bash</code>
and <code>:fn/clojure</code>.</p>

<p>An action has a <code>:location</code>, with a value of <code>:origin</code> for execution on the
node running pallet, and <code>:target</code> for the target node.</p>

<p>An action has an <code>:execution</code>, which is one of <code>:aggregated</code>, <code>:in-sequence</code>
or <code>:collected</code>. Calls to <code>:aggregated</code> actions will be grouped, and run
before <code>:in-sequence</code> actions. Calls to <code>:collected</code> actions will be grouped,
and run after <code>:in-sequence</code> actions.</p>
</div>
        <div class="ns-vars">
          <div class="public">
            <h3 id="var-action">action</h3>
            <div class="usage">[execution action-type location [session &amp; args] &amp; body]</div>
            
            
            <div class="doc"><p>Define an anonymous action</p>
</div>
          </div><div class="public">
            <h3 id="var-action-fn">action-fn</h3>
            <div class="usage">[action]</div>
            
            
            <div class="doc"><p>Retrieve the action-fn that is used to execute the specified action.</p>
</div>
          </div><div class="public">
            <h3 id="var-action-metadata">action-metadata</h3>
            <div class="usage">[session f]</div>
            
            
            <div class="doc"><p>Compute action metadata from precedence specification in session</p>
</div>
          </div><div class="public">
            <h3 id="var-aggregated-action">aggregated-action</h3>
            <div class="usage">[[session &amp; args] &amp; body]</div>
            
            
            <div class="doc"><p>Define a remotely executed aggregated action function, which will
be executed before :in-sequence actions.</p>
</div>
          </div><div class="public">
            <h3 id="var-as-clj-action">as-clj-action</h3>
            <div class="usage">[f [session &amp; args]]</div><div class="usage">[f]</div>
            
            
            <div class="doc"><p>An adaptor for using a normal function as a local action function</p>
</div>
          </div><div class="public">
            <h3 id="var-bash-action">bash-action</h3>
            <div class="usage">[[session &amp; args] &amp; body]</div>
            
            
            <div class="doc"><p>Define a remotely executed bash action function.</p>
</div>
          </div><div class="public">
            <h3 id="var-clj-action">clj-action</h3>
            <div class="usage">[[session &amp; args] &amp; body]</div>
            
            
            <div class="doc"><p>Define a clojure action to be executed on the origin machine.</p>
</div>
          </div><div class="public">
            <h3 id="var-collected-action">collected-action</h3>
            <div class="usage">[[session &amp; args] &amp; body]</div>
            
            
            <div class="doc"><p>Define a remotely executed collected action function, which will
be executed after :in-sequence actions.</p>
</div>
          </div><div class="public">
            <h3 id="var-def-action-def">def-action-def</h3>
            <div class="usage">[name actionfn1]</div>
            
            
            <div class="doc"><p>Define a macro for definining action defining vars</p>
</div>
          </div><div class="public">
            <h3 id="var-enter-scope">enter-scope</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Enter a new action scope.</p>
</div>
          </div><div class="public">
            <h3 id="var-leave-scope">leave-scope</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Leave the current action scope.</p>
</div>
          </div><div class="public">
            <h3 id="var-schedule-action">schedule-action</h3>
            <div class="usage">[session action-fn metadata args execution action-type location]</div>
            
            
            <div class="doc"><p>Registers an action in the action plan. The action is generated by the
specified action function and arguments that will be applied to the function
when the action plan is executed.</p>

<p>The action can be scheduled within one of three 'executions'
(conceptually, sub-phases):</p>

<p><code>:in-sequence</code>
: The generated action will be applied to the node "in order", as it is
     defined lexically in the source crate.  This is the default.</p>

<p><code>:aggregated</code>
: All aggregated actions are applied to the node in the order they are
     defined, but before all :in-sequence actions. Note that all of the
     arguments to any given action function are gathered such that there is
     only ever one invocation of each fn within each phase.</p>

<p><code>:collected</code>
: All collected actions are applied to the node in the order they are
     defined, but after all :in-sequence action. Note that all of the
     arguments to any given action function are gathered such that there is
     only ever one invocation of each fn within each phase.</p>

<p>The action-type determines how the action should be handled:</p>

<p><code>:script/bash</code>
: action produces bash script for execution on remote machine</p>

<p><code>:fn/clojure</code>
: action is a function for local execution</p>

<p><code>:transfer/to-local</code>
: action is a function specifying remote source and local destination.</p>

<p><code>:transfer/from-local</code>
: action is a function specifying local source and remote destination.</p>
</div>
          </div><div class="public">
            <h3 id="var-with-action-options">with-action-options</h3>
            <div class="usage">[request m &amp; body]</div>
            
            
            <div class="doc"><p>Set up local precedence relations between actions</p>
</div>
          </div><div class="public">
            <h3 id="var-with-precedence">with-precedence</h3>
            <div class="usage">[request m &amp; body]</div>
            
            <div class="deprecated">
              <p>Deprecated: <span class="version">0.7.0</span></p>
            </div>
            <div class="doc"><p>Set up local precedence relations between actions</p>
</div>
          </div>
        </div>
      </div>
    </article>
  </body>

</html>