<!DOCTYPE html>
<html><head><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>pallet.action-plan documentation</title></head><body><div id="header"><h1><a href="index.html">Pallet 0.7.0-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3>Namespaces</h3><ul><li><a href="pallet.action.html">pallet.action</a></li><li><a href="pallet.action-impl.html">pallet.action-impl</a></li><li class="current"><a href="pallet.action-plan.html">pallet.action-plan</a></li><li><a href="pallet.actions.html">pallet.actions</a></li><li><a href="pallet.actions.direct.html">pallet.actions.direct</a></li><li><a href="pallet.actions.direct.conditional.html">pallet.actions.direct.conditional</a></li><li><a href="pallet.actions.direct.directory.html">pallet.actions.direct.directory</a></li><li><a href="pallet.actions.direct.exec-script.html">pallet.actions.direct.exec-script</a></li><li><a href="pallet.actions.direct.file.html">pallet.actions.direct.file</a></li><li><a href="pallet.actions.direct.package.html">pallet.actions.direct.package</a></li><li><a href="pallet.actions.direct.remote-directory.html">pallet.actions.direct.remote-directory</a></li><li><a href="pallet.actions.direct.remote-file.html">pallet.actions.direct.remote-file</a></li><li><a href="pallet.actions.direct.retry.html">pallet.actions.direct.retry</a></li><li><a href="pallet.actions.direct.rsync.html">pallet.actions.direct.rsync</a></li><li><a href="pallet.actions.direct.service.html">pallet.actions.direct.service</a></li><li><a href="pallet.actions.direct.user.html">pallet.actions.direct.user</a></li><li><a href="pallet.actions-impl.html">pallet.actions-impl</a></li><li><a href="pallet.argument.html">pallet.argument</a></li><li><a href="pallet.blobstore.html">pallet.blobstore</a></li><li><a href="pallet.blobstore.implementation.html">pallet.blobstore.implementation</a></li><li><a href="pallet.blobstore.jclouds.html">pallet.blobstore.jclouds</a></li><li><a href="pallet.blobstore.url-blobstore.html">pallet.blobstore.url-blobstore</a></li><li><a href="pallet.cache.html">pallet.cache</a></li><li><a href="pallet.cache.impl.html">pallet.cache.impl</a></li><li><a href="pallet.command-line.html">pallet.command-line</a></li><li><a href="pallet.component.html">pallet.component</a></li><li><a href="pallet.compute.html">pallet.compute</a></li><li><a href="pallet.compute.hybrid.html">pallet.compute.hybrid</a></li><li><a href="pallet.compute.implementation.html">pallet.compute.implementation</a></li><li><a href="pallet.compute.jclouds.html">pallet.compute.jclouds</a></li><li><a href="pallet.compute.jvm.html">pallet.compute.jvm</a></li><li><a href="pallet.compute.mccloud.html">pallet.compute.mccloud</a></li><li><a href="pallet.compute.node-list.html">pallet.compute.node-list</a></li><li><a href="pallet.compute.vmfest.html">pallet.compute.vmfest</a></li><li><a href="pallet.config-file.format.html">pallet.config-file.format</a></li><li><a href="pallet.configure.html">pallet.configure</a></li><li><a href="pallet.context.html">pallet.context</a></li><li><a href="pallet.core.html">pallet.core</a></li><li><a href="pallet.crate.automated-admin-user.html">pallet.crate.automated-admin-user</a></li><li><a href="pallet.crate.crontab.html">pallet.crate.crontab</a></li><li><a href="pallet.crate.environment.html">pallet.crate.environment</a></li><li><a href="pallet.crate.etc-default.html">pallet.crate.etc-default</a></li><li><a href="pallet.crate.etc-hosts.html">pallet.crate.etc-hosts</a></li><li><a href="pallet.crate.filesystem.html">pallet.crate.filesystem</a></li><li><a href="pallet.crate.network-service.html">pallet.crate.network-service</a></li><li><a href="pallet.crate.package.centos.html">pallet.crate.package.centos</a></li><li><a href="pallet.crate.package.debian-backports.html">pallet.crate.package.debian-backports</a></li><li><a href="pallet.crate.package.epel.html">pallet.crate.package.epel</a></li><li><a href="pallet.crate.package.jpackage.html">pallet.crate.package.jpackage</a></li><li><a href="pallet.crate.package.rpmforge.html">pallet.crate.package.rpmforge</a></li><li><a href="pallet.crate.ssh-key.html">pallet.crate.ssh-key</a></li><li><a href="pallet.crate.sudoers.html">pallet.crate.sudoers</a></li><li><a href="pallet.debug.html">pallet.debug</a></li><li><a href="pallet.echo.execute.html">pallet.echo.execute</a></li><li><a href="pallet.enlive.html">pallet.enlive</a></li><li><a href="pallet.environment.html">pallet.environment</a></li><li><a href="pallet.event.html">pallet.event</a></li><li><a href="pallet.execute.html">pallet.execute</a></li><li><a href="pallet.executors.html">pallet.executors</a></li><li><a href="pallet.futures.html">pallet.futures</a></li><li><a href="pallet.local.execute.html">pallet.local.execute</a></li><li><a href="pallet.main.html">pallet.main</a></li><li><a href="pallet.main-invoker.html">pallet.main-invoker</a></li><li><a href="pallet.map-merge.html">pallet.map-merge</a></li><li><a href="pallet.maven.html">pallet.maven</a></li><li><a href="pallet.md5crypt.html">pallet.md5crypt</a></li><li><a href="pallet.monad.html">pallet.monad</a></li><li><a href="pallet.monad.state-accessors.html">pallet.monad.state-accessors</a></li><li><a href="pallet.node.html">pallet.node</a></li><li><a href="pallet.node-value.html">pallet.node-value</a></li><li><a href="pallet.parameter.html">pallet.parameter</a></li><li><a href="pallet.phase.html">pallet.phase</a></li><li><a href="pallet.plugin.html">pallet.plugin</a></li><li><a href="pallet.repl.html">pallet.repl</a></li><li><a href="pallet.request-map.html">pallet.request-map</a></li><li><a href="pallet.script.lib.html">pallet.script.lib</a></li><li><a href="pallet.script-builder.html">pallet.script-builder</a></li><li><a href="pallet.script-exec.html">pallet.script-exec</a></li><li><a href="pallet.session.html">pallet.session</a></li><li><a href="pallet.session-verify.html">pallet.session-verify</a></li><li><a href="pallet.shell.html">pallet.shell</a></li><li><a href="pallet.ssh.execute.html">pallet.ssh.execute</a></li><li><a href="pallet.strint.html">pallet.strint</a></li><li><a href="pallet.target.html">pallet.target</a></li><li><a href="pallet.task.add-service.html">pallet.task.add-service</a></li><li><a href="pallet.task.containers.html">pallet.task.containers</a></li><li><a href="pallet.task.converge.html">pallet.task.converge</a></li><li><a href="pallet.task.converge-cluster.html">pallet.task.converge-cluster</a></li><li><a href="pallet.task.describe-node.html">pallet.task.describe-node</a></li><li><a href="pallet.task.destroy-cluster.html">pallet.task.destroy-cluster</a></li><li><a href="pallet.task.help.html">pallet.task.help</a></li><li><a href="pallet.task.images.html">pallet.task.images</a></li><li><a href="pallet.task.lift.html">pallet.task.lift</a></li><li><a href="pallet.task.new-project.html">pallet.task.new-project</a></li><li><a href="pallet.task.nodes.html">pallet.task.nodes</a></li><li><a href="pallet.task.providers.html">pallet.task.providers</a></li><li><a href="pallet.task.to-blob.html">pallet.task.to-blob</a></li><li><a href="pallet.task.version.html">pallet.task.version</a></li><li><a href="pallet.task.vmfest-script.html">pallet.task.vmfest-script</a></li><li><a href="pallet.template.html">pallet.template</a></li><li><a href="pallet.template.properties.html">pallet.template.properties</a></li><li><a href="pallet.utils.html">pallet.utils</a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="pallet.action-plan.html#var-action-map">action-map</a></li><li><a href="pallet.action-plan.html#var-action-map-execution">action-map-execution</a></li><li><a href="pallet.action-plan.html#var-build-for-target">build-for-target</a></li><li><a href="pallet.action-plan.html#var-checked-commands">checked-commands</a></li><li><a href="pallet.action-plan.html#var-checked-commands*">checked-commands*</a></li><li><a href="pallet.action-plan.html#var-checked-script">checked-script</a></li><li><a href="pallet.action-plan.html#var-defining-context-string">defining-context-string</a></li><li><a href="pallet.action-plan.html#var-enter-scope">enter-scope</a></li><li><a href="pallet.action-plan.html#var-execute-action-map">execute-action-map</a></li><li><a href="pallet.action-plan.html#var-execute-for-target">execute-for-target</a></li><li><a href="pallet.action-plan.html#var-execute-if">execute-if</a></li><li><a href="pallet.action-plan.html#var-get-for-target">get-for-target</a></li><li><a href="pallet.action-plan.html#var-leave-scope">leave-scope</a></li><li><a href="pallet.action-plan.html#var-phase-for-target">phase-for-target</a></li><li><a href="pallet.action-plan.html#var-reset-for-target">reset-for-target</a></li><li><a href="pallet.action-plan.html#var-schedule-action-map">schedule-action-map</a></li><li><a href="pallet.action-plan.html#var-script-template">script-template</a></li><li><a href="pallet.action-plan.html#var-script-template-for-server">script-template-for-server</a></li><li><a href="pallet.action-plan.html#var-short-circuiting-state-m">short-circuiting-state-m</a></li><li><a href="pallet.action-plan.html#var-stop-execution-on-error">stop-execution-on-error</a></li><li><a href="pallet.action-plan.html#var-target-path">target-path</a></li><li><a href="pallet.action-plan.html#var-translate">translate</a></li><li><a href="pallet.action-plan.html#var-translate-for-target">translate-for-target</a></li><li><a href="pallet.action-plan.html#var-translated%3F">translated?</a></li></ul></div><div class="namespace-docs" id="content"><h2>pallet.action-plan documentation</h2><pre class="doc">An action plan contains instances of actions (action maps) for execution.

The action plan is built by executing a phase function. Each phase function
calls actions which insert themselves into the action plan.

The action plan is transformed to provide aggregated operations, run delayed
crate functions, and to resolve precedence relations between actions.

A translated plan is executed by passing an executor, which is a function
that will be passed each action map in the plan.  The executor function is
responsible for selecting the implementation of the action to be used, and
calling the implementation with the action-map arguments.

Note this is an implementation namespace.</pre><div class="public" id="var-action-map"><h3>action-map</h3><div class="usage"><code>(action-map action arg-vector precedence-map)</code></div><pre class="doc">Return an action map for the given `action` and `args`. The action map is an
instance of an action. The action plan is a tree of action maps.

`precedence-map` specifies naming and dependencies for this instance of the
action, and may contain :action-id, :always-before and :always-after keys. If
a precedence-map is supplied, an action-id is generated if none present, to
ensure that the standard action precedence is not altered.

- :action          the action that is scheduled,
- :args            the arguments to pass to the action function,
- :context         captures the phase context, for use at execution time,
- :action-id       a keyword that identifies the instance of an action,
- :always-before   a symbol, keyword or set thereof. A symbol references an
                   action, and a keyword references an instance of an action,
- :always-after    a symbol, keyword or set thereof,
- :node-value-path a symbol specifying a node value (added when scheduled).

The action is generated by the specified action function and arguments that
will be applied to the function when the action plan is executed.</pre></div><div class="public" id="var-action-map-execution"><h3>action-map-execution</h3><div class="usage"><code>(action-map-execution action-map)</code></div><pre class="doc">Helper to return the execution of the action associated with an action-map.
</pre></div><div class="public" id="var-build-for-target"><h3>build-for-target</h3><div class="usage"><code>(build-for-target session)</code></div><pre class="doc">Create the action plan by calling the current phase for the target group.
</pre></div><div class="public" id="var-checked-commands"><h3>checked-commands</h3><div class="usage"><code>(checked-commands name &amp; script)</code></div><pre class="doc">Return a stevedore script that uses the current context to label the
action</pre></div><div class="public" id="var-checked-commands*"><h3>checked-commands*</h3><div class="usage"><code>(checked-commands* name scripts)</code></div><pre class="doc">Return a stevedore script that uses the current context to label the
action</pre></div><div class="public" id="var-checked-script"><h3>checked-script</h3><div class="usage"><code>(checked-script name &amp; script)</code></div><pre class="doc">Return a stevedore script that uses the current context to label the
action</pre></div><div class="public" id="var-defining-context-string"><h3>defining-context-string</h3><div class="usage"><code>(defining-context-string)</code></div><pre class="doc">Returns a context string for the defining phase context.
</pre></div><div class="public" id="var-enter-scope"><h3>enter-scope</h3><div class="usage"><code>(enter-scope session)</code></div><pre class="doc">Enter a new action scope.
</pre></div><div class="public" id="var-execute-action-map"><h3>execute-action-map</h3><div class="usage"><code>(execute-action-map executor session {:keys [node-value-path context], :as action})</code></div><pre class="doc">Execute a single action, catching any exception and reporting it as
an error map.</pre></div><div class="public" id="var-execute-for-target"><h3>execute-for-target</h3><div class="usage"><code>(execute-for-target session executor execute-status-fn)</code></div><pre class="doc">Execute the translated action plan for the current target.
</pre></div><div class="public" id="var-execute-if"><h3>execute-if</h3><div class="usage"><code>(execute-if session {:keys [blocks], :as action} value)</code></div><pre class="doc">Execute an if action
</pre></div><div class="public" id="var-get-for-target"><h3>get-for-target</h3><div class="usage"><code>(get-for-target session)</code></div><pre class="doc">Get the action plan for the current phase and target node.
</pre></div><div class="public" id="var-leave-scope"><h3>leave-scope</h3><div class="usage"><code>(leave-scope session)</code></div><pre class="doc">Leave the current action scope.
</pre></div><div class="public" id="var-phase-for-target"><h3>phase-for-target</h3><div class="usage"><code>(phase-for-target session)</code></div><pre class="doc">Return the phase function for the target phase.
</pre></div><div class="public" id="var-reset-for-target"><h3>reset-for-target</h3><div class="usage"><code>(reset-for-target phases)</code></div><pre class="doc">Reset the action plan for the current phase and target.
</pre></div><div class="public" id="var-schedule-action-map"><h3>schedule-action-map</h3><div class="usage"><code>(schedule-action-map session action-map)</code></div><pre class="doc">Registers an action map in the action plan for execution. This function is
responsible for creating a node-value (as node-value-path's have to be unique
for all instances of an aggregated action) as a handle to the value that will
be returned when the action map is executed.</pre></div><div class="public" id="var-script-template"><h3>script-template</h3><div class="usage"><code>(script-template session)</code></div><pre class="doc">Return the script template for the current group node.
</pre></div><div class="public" id="var-script-template-for-server"><h3>script-template-for-server</h3><div class="usage"><code>(script-template-for-server server)</code></div><pre class="doc">Return the script template for the specified server.
</pre></div><div class="public" id="var-short-circuiting-state-m"><h3>short-circuiting-state-m</h3><div class="usage"></div><pre class="doc">Monad describing stateful computations. The monadic values have the
structure (fn [old-state] [result new-state]). If result is a map with
:action-plan/flag set to :action-plan/stop, then further calculations are
short circuited.</pre></div><div class="public" id="var-stop-execution-on-error"><h3>stop-execution-on-error</h3><div class="usage"><code>(stop-execution-on-error [result session])</code></div><pre class="doc">:execute-status-fn algorithm to stop execution on an error
</pre></div><div class="public" id="var-target-path"><h3>target-path</h3><div class="usage"><code>(target-path session)</code></div><pre class="doc">Return the vector path of the action plan for the current session target
node, or target group.</pre></div><div class="public" id="var-translate"><h3>translate</h3><div class="usage"><code>(translate action-plan session)</code></div><pre class="doc">Process the action-plan, applying groupings and precedence, producing
an action plan with fully bound functions, ready for execution.

This is equivalent to using an identity monad with a monadic value
that is a tree of action maps.</pre></div><div class="public" id="var-translate-for-target"><h3>translate-for-target</h3><div class="usage"><code>(translate-for-target session)</code></div><pre class="doc">Build the action plan and translate for the current phase and target node.
</pre></div><div class="public" id="var-translated%3F"><h3>translated?</h3><div class="usage"><code>(translated? action-plan)</code></div><pre class="doc">Predicate to test if an action plan has been translated
</pre></div></div></body></html>