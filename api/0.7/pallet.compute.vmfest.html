<!DOCTYPE html>
<html><head><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>pallet.compute.vmfest documentation</title></head><body><div id="header"><h1><a href="index.html">Pallet 0.7.0-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3>Namespaces</h3><ul><li><a href="pallet.action.html">pallet.action</a></li><li><a href="pallet.action-impl.html">pallet.action-impl</a></li><li><a href="pallet.action-plan.html">pallet.action-plan</a></li><li><a href="pallet.actions.html">pallet.actions</a></li><li><a href="pallet.actions.direct.html">pallet.actions.direct</a></li><li><a href="pallet.actions.direct.conditional.html">pallet.actions.direct.conditional</a></li><li><a href="pallet.actions.direct.directory.html">pallet.actions.direct.directory</a></li><li><a href="pallet.actions.direct.exec-script.html">pallet.actions.direct.exec-script</a></li><li><a href="pallet.actions.direct.file.html">pallet.actions.direct.file</a></li><li><a href="pallet.actions.direct.package.html">pallet.actions.direct.package</a></li><li><a href="pallet.actions.direct.remote-directory.html">pallet.actions.direct.remote-directory</a></li><li><a href="pallet.actions.direct.remote-file.html">pallet.actions.direct.remote-file</a></li><li><a href="pallet.actions.direct.retry.html">pallet.actions.direct.retry</a></li><li><a href="pallet.actions.direct.rsync.html">pallet.actions.direct.rsync</a></li><li><a href="pallet.actions.direct.service.html">pallet.actions.direct.service</a></li><li><a href="pallet.actions.direct.user.html">pallet.actions.direct.user</a></li><li><a href="pallet.actions-impl.html">pallet.actions-impl</a></li><li><a href="pallet.argument.html">pallet.argument</a></li><li><a href="pallet.blobstore.html">pallet.blobstore</a></li><li><a href="pallet.blobstore.implementation.html">pallet.blobstore.implementation</a></li><li><a href="pallet.blobstore.jclouds.html">pallet.blobstore.jclouds</a></li><li><a href="pallet.blobstore.url-blobstore.html">pallet.blobstore.url-blobstore</a></li><li><a href="pallet.cache.html">pallet.cache</a></li><li><a href="pallet.cache.impl.html">pallet.cache.impl</a></li><li><a href="pallet.command-line.html">pallet.command-line</a></li><li><a href="pallet.component.html">pallet.component</a></li><li><a href="pallet.compute.html">pallet.compute</a></li><li><a href="pallet.compute.hybrid.html">pallet.compute.hybrid</a></li><li><a href="pallet.compute.implementation.html">pallet.compute.implementation</a></li><li><a href="pallet.compute.jclouds.html">pallet.compute.jclouds</a></li><li><a href="pallet.compute.jvm.html">pallet.compute.jvm</a></li><li><a href="pallet.compute.mccloud.html">pallet.compute.mccloud</a></li><li><a href="pallet.compute.node-list.html">pallet.compute.node-list</a></li><li class="current"><a href="pallet.compute.vmfest.html">pallet.compute.vmfest</a></li><li><a href="pallet.config-file.format.html">pallet.config-file.format</a></li><li><a href="pallet.configure.html">pallet.configure</a></li><li><a href="pallet.context.html">pallet.context</a></li><li><a href="pallet.core.html">pallet.core</a></li><li><a href="pallet.crate.automated-admin-user.html">pallet.crate.automated-admin-user</a></li><li><a href="pallet.crate.crontab.html">pallet.crate.crontab</a></li><li><a href="pallet.crate.environment.html">pallet.crate.environment</a></li><li><a href="pallet.crate.etc-default.html">pallet.crate.etc-default</a></li><li><a href="pallet.crate.etc-hosts.html">pallet.crate.etc-hosts</a></li><li><a href="pallet.crate.filesystem.html">pallet.crate.filesystem</a></li><li><a href="pallet.crate.network-service.html">pallet.crate.network-service</a></li><li><a href="pallet.crate.package.centos.html">pallet.crate.package.centos</a></li><li><a href="pallet.crate.package.debian-backports.html">pallet.crate.package.debian-backports</a></li><li><a href="pallet.crate.package.epel.html">pallet.crate.package.epel</a></li><li><a href="pallet.crate.package.jpackage.html">pallet.crate.package.jpackage</a></li><li><a href="pallet.crate.package.rpmforge.html">pallet.crate.package.rpmforge</a></li><li><a href="pallet.crate.ssh-key.html">pallet.crate.ssh-key</a></li><li><a href="pallet.crate.sudoers.html">pallet.crate.sudoers</a></li><li><a href="pallet.debug.html">pallet.debug</a></li><li><a href="pallet.echo.execute.html">pallet.echo.execute</a></li><li><a href="pallet.enlive.html">pallet.enlive</a></li><li><a href="pallet.environment.html">pallet.environment</a></li><li><a href="pallet.event.html">pallet.event</a></li><li><a href="pallet.execute.html">pallet.execute</a></li><li><a href="pallet.executors.html">pallet.executors</a></li><li><a href="pallet.futures.html">pallet.futures</a></li><li><a href="pallet.local.execute.html">pallet.local.execute</a></li><li><a href="pallet.main.html">pallet.main</a></li><li><a href="pallet.main-invoker.html">pallet.main-invoker</a></li><li><a href="pallet.map-merge.html">pallet.map-merge</a></li><li><a href="pallet.maven.html">pallet.maven</a></li><li><a href="pallet.md5crypt.html">pallet.md5crypt</a></li><li><a href="pallet.monad.html">pallet.monad</a></li><li><a href="pallet.monad.state-accessors.html">pallet.monad.state-accessors</a></li><li><a href="pallet.node.html">pallet.node</a></li><li><a href="pallet.node-value.html">pallet.node-value</a></li><li><a href="pallet.parameter.html">pallet.parameter</a></li><li><a href="pallet.phase.html">pallet.phase</a></li><li><a href="pallet.plugin.html">pallet.plugin</a></li><li><a href="pallet.repl.html">pallet.repl</a></li><li><a href="pallet.request-map.html">pallet.request-map</a></li><li><a href="pallet.script.lib.html">pallet.script.lib</a></li><li><a href="pallet.script-builder.html">pallet.script-builder</a></li><li><a href="pallet.script-exec.html">pallet.script-exec</a></li><li><a href="pallet.session.html">pallet.session</a></li><li><a href="pallet.session-verify.html">pallet.session-verify</a></li><li><a href="pallet.shell.html">pallet.shell</a></li><li><a href="pallet.ssh.execute.html">pallet.ssh.execute</a></li><li><a href="pallet.strint.html">pallet.strint</a></li><li><a href="pallet.target.html">pallet.target</a></li><li><a href="pallet.task.add-service.html">pallet.task.add-service</a></li><li><a href="pallet.task.containers.html">pallet.task.containers</a></li><li><a href="pallet.task.converge.html">pallet.task.converge</a></li><li><a href="pallet.task.converge-cluster.html">pallet.task.converge-cluster</a></li><li><a href="pallet.task.describe-node.html">pallet.task.describe-node</a></li><li><a href="pallet.task.destroy-cluster.html">pallet.task.destroy-cluster</a></li><li><a href="pallet.task.help.html">pallet.task.help</a></li><li><a href="pallet.task.images.html">pallet.task.images</a></li><li><a href="pallet.task.lift.html">pallet.task.lift</a></li><li><a href="pallet.task.new-project.html">pallet.task.new-project</a></li><li><a href="pallet.task.nodes.html">pallet.task.nodes</a></li><li><a href="pallet.task.providers.html">pallet.task.providers</a></li><li><a href="pallet.task.to-blob.html">pallet.task.to-blob</a></li><li><a href="pallet.task.version.html">pallet.task.version</a></li><li><a href="pallet.task.vmfest-script.html">pallet.task.vmfest-script</a></li><li><a href="pallet.template.html">pallet.template</a></li><li><a href="pallet.template.properties.html">pallet.template.properties</a></li><li><a href="pallet.utils.html">pallet.utils</a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="pallet.compute.vmfest.html#var-*piped-stream-buffer-size*">*piped-stream-buffer-size*</a></li><li><a href="pallet.compute.vmfest.html#var-all-images-from-template">all-images-from-template</a></li><li><a href="pallet.compute.vmfest.html#var-has-image%3F">has-image?</a></li><li><a href="pallet.compute.vmfest.html#var-image-from-template">image-from-template</a></li><li><a href="pallet.compute.vmfest.html#var-install-image">install-image</a></li><li><a href="pallet.compute.vmfest.html#var-machine-name">machine-name</a></li><li><a href="pallet.compute.vmfest.html#var-medium-formats">medium-formats</a></li><li><a href="pallet.compute.vmfest.html#var-os-families">os-families</a></li><li><a href="pallet.compute.vmfest.html#var-parallel-create-nodes">parallel-create-nodes</a></li><li><a href="pallet.compute.vmfest.html#var-publish-image">publish-image</a></li><li><a href="pallet.compute.vmfest.html#var-serial-create-nodes">serial-create-nodes</a></li><li><a href="pallet.compute.vmfest.html#var-wait-for-ip">wait-for-ip</a></li></ul></div><div class="namespace-docs" id="content"><h2>pallet.compute.vmfest documentation</h2><pre class="doc">A vmfest provider.

An example service configuration in ~/.pallet/config.clj

    :vb {:provider &quot;virtualbox&quot;
         :default-local-interface &quot;vboxnet0&quot;
         :default-bridged-interface &quot;en1: Wi-Fi 2 (AirPort)&quot;
         :default-network-type :local
         :hardware-models
         {:test
          {:memory-size 768
           :cpu-count 1}
          :test-2
          {:memory-size 512
           :network-type :bridged}
         :images {:centos-5-3 {:description &quot;CentOS 5.3 32bit&quot;
                               :uuid &quot;4697bdf7-7acf-4a20-8c28-e20b6bb58e25&quot;
                               :os-family :centos
                               :os-version &quot;5.3&quot;
                               :os-type-id &quot;RedHat&quot;}
                  :ubuntu-10-04 {:description &quot;Ubuntu 10.04 32bit&quot;
                                 :uuid &quot;8a31e3aa-0d46-41a5-936d-25130dcb16b7&quot;
                                 :os-family :ubuntu
                                 :os-version &quot;10.04&quot;
                                 :os-type-id &quot;Ubuntu&quot;
                                 :username
                                 :password}}
         :model-path &quot;/Volumes/My Book/vms/disks&quot;
         :node-path &quot;/Volumes/My Book/vms/nodes&quot;}

The uuid's can be found using vboxmanage
    vboxmanage list hdds
 or it can be the path to time image file itself (.vdi)

The images are disks that are immutable.  The virtualbox extensions need
to be installed on the image.

VMs' hardware configuration
===========================
The hardware model to be run by pallet can be defined in the node template or
built from the template and a default model. The model will determine by the
first match in the following options
   * The template has a :hardware-model entry with a vmfest hardware map. The
     VMs created will follow this model
        e.g. {... :hardware-model {:memory-size 1400 ...}}
   * The template has a :hardware-id entry. The value for this entry should
     correspond to an entry in the hardware-models map (or one of the entries
     that pallet offers by default.
        e.g. {... :hardware-id :small ...}
   * The template has no hardware entry. Pallet will use the first model
     in the hardware-models map to build an image that matches the rest of
     the relevant entries in the map.

By default, pallet offers the following specializations of this base model:

   {:memory-size 512
    :cpu-count 1
    :storage [{:name &quot;IDE Controller&quot;
               :bus :ide
               :devices [nil nil nil nil]}]
    :boot-mount-point [&quot;IDE Controller&quot; 0]})

The defined machines correspond to the above with some overrides:

   {:micro {:memory 512 :cpu-count 1}
    :small {:memory-size 1024 :cpu-count 1}
    :medium {:memory-size 2048 :cpu-count 2}
    :large {:memory-size (* 4 1024) :cpu-count 4}

You can define your own hardware models that will be added to the default ones,
or in the case that they're named the same, they will replace the default ones.
Custom models will also extend the base model above.

Networking
==========

Pallet offers two networking models: local and bridged.

In Local mode pallet creates two network interfaces in the VM, one for an internal
network (e.g. vboxnet0), and the other one for a NAT network. This option doesn't
require VM's to obtain an external IP address, but requires the image booted to
bring up at least eth0 and eth1, so this method won't work on all images.

In Bridged mode pallet creates one interface in the VM that is bridged on a phisical
network interface. For pallet to work, this physical interface must have an IP address
that must be hooked in an existing network. This mode works with all images.

The networking configuration for each VM created is determined by (in order):
   * the template contains a :hardware-model map with a :network-type entry
   * the template contains a :network-type entry
   * the service configuration contains a :default-network-type entry
   * :local

Each networking type must attach to a network interface, be it local or bridged.
The decision about which network interface to attach is done in the following way
(in order):
  * For bridged networking:
      * A :default-bridged-interface entry exists in the service defition
      * Pallet will try to find a suitable interface for the machine.
      * if all fails, VMs will fail to start
  * For local networking:
      * A :default-local-interface entry exists in the service definition
      * vboxnet0 (created by default by VirtualBox)</pre><div class="public" id="var-*piped-stream-buffer-size*"><h3>*piped-stream-buffer-size*</h3><div class="usage"></div><pre class="doc">The buffer size (in bytes) for the piped stream used to implement
the :stream option for :out. If your ssh commands generate a high volume of
output, then this buffer size can become a bottleneck. You might also
increase the frequency with which you read the output stream if this is an
issue.</pre></div><div class="public" id="var-all-images-from-template"><h3>all-images-from-template</h3><div class="usage"><code>(all-images-from-template images template)</code></div><pre class="doc">Finds all the images that match a template
</pre></div><div class="public" id="var-has-image%3F"><h3>has-image?</h3><div class="usage"><code>(has-image? service image-key)</code></div><pre class="doc">Predicate to test for the presence of a specific image
</pre></div><div class="public" id="var-image-from-template"><h3>image-from-template</h3><div class="usage"><code>(image-from-template images template)</code></div><pre class="doc">Use the template to select an image from the image map.
</pre></div><div class="public" id="var-install-image"><h3>install-image</h3><div class="usage"><code>(install-image service url {:as options})</code></div><pre class="doc">Install the image from the specified `url`
</pre></div><div class="public" id="var-machine-name"><h3>machine-name</h3><div class="usage"><code>(machine-name group-name n)</code></div><pre class="doc">Generate a machine name based on the grup name and an index
</pre></div><div class="public" id="var-medium-formats"><h3>medium-formats</h3><div class="usage"><code>(medium-formats compute)</code></div><pre class="doc">Return supported medium-formats
</pre></div><div class="public" id="var-os-families"><h3>os-families</h3><div class="usage"><code>(os-families compute)</code></div><pre class="doc">Return supported os-families
</pre></div><div class="public" id="var-parallel-create-nodes"><h3>parallel-create-nodes</h3><div class="usage"><code>(parallel-create-nodes target-machines-to-create server node-path node-spec image machine-model group-name init-script user)</code></div><pre class="doc">Create all nodes for a group in parallel.
</pre></div><div class="public" id="var-publish-image"><h3>publish-image</h3><div class="usage"><code>(publish-image service image blobstore container {:keys [path], :as options})</code></div><pre class="doc">Publish the image to the specified blobstore container
</pre></div><div class="public" id="var-serial-create-nodes"><h3>serial-create-nodes</h3><div class="usage"><code>(serial-create-nodes target-machines-to-create server node-path node-spec image machine-model group-name init-script user)</code></div><pre class="doc">Create all nodes for a group in parallel.
</pre></div><div class="public" id="var-wait-for-ip"><h3>wait-for-ip</h3><div class="usage"><code>(wait-for-ip machine)</code><code>(wait-for-ip machine timeout)</code></div><pre class="doc">Wait for the machines IP to become available by the provided amount of
milliseconds, or 5min by default.</pre></div></div></body></html>