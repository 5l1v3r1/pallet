<html lang="en">
  <head>
    <title>pallet.core documentation</title>
    <link href="css/default.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/page_effects.js"></script>
  </head>
  <body>
    <header>
      <div id="header">
        <h1 class="project-title">Pallet 0.7 API documentation</h1>
      </div>
    </header>
    <navigation>
      <div id="namespaces" class="sidebar">
        <h3>Namespaces</h3>
        <ul class="ns-links">
          <li class="ns-link"><a href="pallet.action.html">pallet.action</a></li><li class="ns-link"><a href="pallet.action.conditional.html">pallet.action.conditional</a></li><li class="ns-link"><a href="pallet.action.directory.html">pallet.action.directory</a></li><li class="ns-link"><a href="pallet.action.environment.html">pallet.action.environment</a></li><li class="ns-link"><a href="pallet.action.exec-script.html">pallet.action.exec-script</a></li><li class="ns-link"><a href="pallet.action.file.html">pallet.action.file</a></li><li class="ns-link"><a href="pallet.action.filesystem.html">pallet.action.filesystem</a></li><li class="ns-link"><a href="pallet.action.package.html">pallet.action.package</a></li><li class="ns-link"><a href="pallet.action.package.centos.html">pallet.action.package.centos</a></li><li class="ns-link"><a href="pallet.action.package.debian-backports.html">pallet.action.package.debian-backports</a></li><li class="ns-link"><a href="pallet.action.package.epel.html">pallet.action.package.epel</a></li><li class="ns-link"><a href="pallet.action.package.jpackage.html">pallet.action.package.jpackage</a></li><li class="ns-link"><a href="pallet.action.package.rpmforge.html">pallet.action.package.rpmforge</a></li><li class="ns-link"><a href="pallet.action.remote-directory.html">pallet.action.remote-directory</a></li><li class="ns-link"><a href="pallet.action.remote-file.html">pallet.action.remote-file</a></li><li class="ns-link"><a href="pallet.action.retry.html">pallet.action.retry</a></li><li class="ns-link"><a href="pallet.action.rsync.html">pallet.action.rsync</a></li><li class="ns-link"><a href="pallet.action.service.html">pallet.action.service</a></li><li class="ns-link"><a href="pallet.action.user.html">pallet.action.user</a></li><li class="ns-link"><a href="pallet.action-plan.html">pallet.action-plan</a></li><li class="ns-link"><a href="pallet.argument.html">pallet.argument</a></li><li class="ns-link"><a href="pallet.blobstore.html">pallet.blobstore</a></li><li class="ns-link"><a href="pallet.blobstore.implementation.html">pallet.blobstore.implementation</a></li><li class="ns-link"><a href="pallet.blobstore.url-blobstore.html">pallet.blobstore.url-blobstore</a></li><li class="ns-link"><a href="pallet.command-line.html">pallet.command-line</a></li><li class="ns-link"><a href="pallet.command-script.html">pallet.command-script</a></li><li class="ns-link"><a href="pallet.compute.html">pallet.compute</a></li><li class="ns-link"><a href="pallet.compute.hybrid.html">pallet.compute.hybrid</a></li><li class="ns-link"><a href="pallet.compute.implementation.html">pallet.compute.implementation</a></li><li class="ns-link"><a href="pallet.compute.jvm.html">pallet.compute.jvm</a></li><li class="ns-link"><a href="pallet.compute.node-list.html">pallet.compute.node-list</a></li><li class="ns-link"><a href="pallet.config-file.format.html">pallet.config-file.format</a></li><li class="ns-link"><a href="pallet.configure.html">pallet.configure</a></li><li class="ns-link"><a href="pallet.core.html">pallet.core</a></li><li class="ns-link"><a href="pallet.crate.automated-admin-user.html">pallet.crate.automated-admin-user</a></li><li class="ns-link"><a href="pallet.crate.crontab.html">pallet.crate.crontab</a></li><li class="ns-link"><a href="pallet.crate.environment.html">pallet.crate.environment</a></li><li class="ns-link"><a href="pallet.crate.etc-default.html">pallet.crate.etc-default</a></li><li class="ns-link"><a href="pallet.crate.etc-hosts.html">pallet.crate.etc-hosts</a></li><li class="ns-link"><a href="pallet.crate.network-service.html">pallet.crate.network-service</a></li><li class="ns-link"><a href="pallet.crate.package-repo.html">pallet.crate.package-repo</a></li><li class="ns-link"><a href="pallet.crate.ssh-key.html">pallet.crate.ssh-key</a></li><li class="ns-link"><a href="pallet.crate.sudoers.html">pallet.crate.sudoers</a></li><li class="ns-link"><a href="pallet.debug.html">pallet.debug</a></li><li class="ns-link"><a href="pallet.enlive.html">pallet.enlive</a></li><li class="ns-link"><a href="pallet.environment.html">pallet.environment</a></li><li class="ns-link"><a href="pallet.execute.html">pallet.execute</a></li><li class="ns-link"><a href="pallet.futures.html">pallet.futures</a></li><li class="ns-link"><a href="pallet.main.html">pallet.main</a></li><li class="ns-link"><a href="pallet.main-invoker.html">pallet.main-invoker</a></li><li class="ns-link"><a href="pallet.map-merge.html">pallet.map-merge</a></li><li class="ns-link"><a href="pallet.md5crypt.html">pallet.md5crypt</a></li><li class="ns-link"><a href="pallet.node.html">pallet.node</a></li><li class="ns-link"><a href="pallet.parameter.html">pallet.parameter</a></li><li class="ns-link"><a href="pallet.phase.html">pallet.phase</a></li><li class="ns-link"><a href="pallet.repl.html">pallet.repl</a></li><li class="ns-link"><a href="pallet.request-map.html">pallet.request-map</a></li><li class="ns-link"><a href="pallet.resource.html">pallet.resource</a></li><li class="ns-link"><a href="pallet.resource.directory.html">pallet.resource.directory</a></li><li class="ns-link"><a href="pallet.resource.exec-script.html">pallet.resource.exec-script</a></li><li class="ns-link"><a href="pallet.resource.file.html">pallet.resource.file</a></li><li class="ns-link"><a href="pallet.resource.filesystem.html">pallet.resource.filesystem</a></li><li class="ns-link"><a href="pallet.resource.filesystem-layout.html">pallet.resource.filesystem-layout</a></li><li class="ns-link"><a href="pallet.resource.format.html">pallet.resource.format</a></li><li class="ns-link"><a href="pallet.resource.hostinfo.html">pallet.resource.hostinfo</a></li><li class="ns-link"><a href="pallet.resource.lib.html">pallet.resource.lib</a></li><li class="ns-link"><a href="pallet.resource.network-service.html">pallet.resource.network-service</a></li><li class="ns-link"><a href="pallet.resource.package.html">pallet.resource.package</a></li><li class="ns-link"><a href="pallet.resource.remote-directory.html">pallet.resource.remote-directory</a></li><li class="ns-link"><a href="pallet.resource.remote-file.html">pallet.resource.remote-file</a></li><li class="ns-link"><a href="pallet.resource.resource-when.html">pallet.resource.resource-when</a></li><li class="ns-link"><a href="pallet.resource.rsync.html">pallet.resource.rsync</a></li><li class="ns-link"><a href="pallet.resource.service.html">pallet.resource.service</a></li><li class="ns-link"><a href="pallet.resource.shell.html">pallet.resource.shell</a></li><li class="ns-link"><a href="pallet.resource.user.html">pallet.resource.user</a></li><li class="ns-link"><a href="pallet.script.lib.html">pallet.script.lib</a></li><li class="ns-link"><a href="pallet.session.html">pallet.session</a></li><li class="ns-link"><a href="pallet.shell.html">pallet.shell</a></li><li class="ns-link"><a href="pallet.strint.html">pallet.strint</a></li><li class="ns-link"><a href="pallet.target.html">pallet.target</a></li><li class="ns-link"><a href="pallet.task.add-service.html">pallet.task.add-service</a></li><li class="ns-link"><a href="pallet.task.config.html">pallet.task.config</a></li><li class="ns-link"><a href="pallet.task.containers.html">pallet.task.containers</a></li><li class="ns-link"><a href="pallet.task.converge.html">pallet.task.converge</a></li><li class="ns-link"><a href="pallet.task.converge-cluster.html">pallet.task.converge-cluster</a></li><li class="ns-link"><a href="pallet.task.describe-node.html">pallet.task.describe-node</a></li><li class="ns-link"><a href="pallet.task.destroy-cluster.html">pallet.task.destroy-cluster</a></li><li class="ns-link"><a href="pallet.task.help.html">pallet.task.help</a></li><li class="ns-link"><a href="pallet.task.images.html">pallet.task.images</a></li><li class="ns-link"><a href="pallet.task.lift.html">pallet.task.lift</a></li><li class="ns-link"><a href="pallet.task.new-project.html">pallet.task.new-project</a></li><li class="ns-link"><a href="pallet.task.nodes.html">pallet.task.nodes</a></li><li class="ns-link"><a href="pallet.task.providers.html">pallet.task.providers</a></li><li class="ns-link"><a href="pallet.task.to-blob.html">pallet.task.to-blob</a></li><li class="ns-link"><a href="pallet.task.version.html">pallet.task.version</a></li><li class="ns-link"><a href="pallet.template.html">pallet.template</a></li><li class="ns-link"><a href="pallet.template.properties.html">pallet.template.properties</a></li><li class="ns-link"><a href="pallet.utils.html">pallet.utils</a></li><li class="ns-link"><a href="pallet.version-dispatch.html">pallet.version-dispatch</a></li><li class="ns-link"><a href="pallet.versions.html">pallet.versions</a></li>
        </ul>
      </div>
      <div id="vars" class="sidebar">
        <h3>Public Vars</h3>
        <ul class="ns-var-links">
          <li class="ns-var-link"><a href="pallet.core.html#var-*warn-on-undefined-phase*">*warn-on-undefined-phase*</a></li><li class="ns-var-link"><a href="pallet.core.html#var-adjust-session-for-nodes">adjust-session-for-nodes</a></li><li class="ns-var-link"><a href="pallet.core.html#var-admin-user">admin-user</a></li><li class="ns-var-link"><a href="pallet.core.html#var-all-node-set-selector">all-node-set-selector</a></li><li class="ns-var-link"><a href="pallet.core.html#var-cluster-groups">cluster-groups</a></li><li class="ns-var-link"><a href="pallet.core.html#var-cluster-spec">cluster-spec</a></li><li class="ns-var-link"><a href="pallet.core.html#var-converge">converge</a></li><li class="ns-var-link"><a href="pallet.core.html#var-converge*">converge*</a></li><li class="ns-var-link"><a href="pallet.core.html#var-converge-cluster">converge-cluster</a></li><li class="ns-var-link"><a href="pallet.core.html#var-default-algorithms">default-algorithms</a></li><li class="ns-var-link"><a href="pallet.core.html#var-default-environment">default-environment</a></li><li class="ns-var-link"><a href="pallet.core.html#var-default-executors">default-executors</a></li><li class="ns-var-link"><a href="pallet.core.html#var-defnode">defnode</a></li><li class="ns-var-link"><a href="pallet.core.html#var-destroy-cluster">destroy-cluster</a></li><li class="ns-var-link"><a href="pallet.core.html#var-environment-args">environment-args</a></li><li class="ns-var-link"><a href="pallet.core.html#var-expand-cluster-groups">expand-cluster-groups</a></li><li class="ns-var-link"><a href="pallet.core.html#var-expand-group-spec-with-counts">expand-group-spec-with-counts</a></li><li class="ns-var-link"><a href="pallet.core.html#var-group-spec">group-spec</a></li><li class="ns-var-link"><a href="pallet.core.html#var-groups-with-servers">groups-with-servers</a></li><li class="ns-var-link"><a href="pallet.core.html#var-lift">lift</a></li><li class="ns-var-link"><a href="pallet.core.html#var-lift*">lift*</a></li><li class="ns-var-link"><a href="pallet.core.html#var-lift-cluster">lift-cluster</a></li><li class="ns-var-link"><a href="pallet.core.html#var-lift-nodes">lift-nodes</a></li><li class="ns-var-link"><a href="pallet.core.html#var-lift-phase">lift-phase</a></li><li class="ns-var-link"><a href="pallet.core.html#var-log-message">log-message</a></li><li class="ns-var-link"><a href="pallet.core.html#var-log-session">log-session</a></li><li class="ns-var-link"><a href="pallet.core.html#var-make-node">make-node</a></li><li class="ns-var-link"><a href="pallet.core.html#var-merge-spec-algorithm">merge-spec-algorithm</a></li><li class="ns-var-link"><a href="pallet.core.html#var-middleware-handler">middleware-handler</a></li><li class="ns-var-link"><a href="pallet.core.html#var-name-with-attributes">name-with-attributes</a></li><li class="ns-var-link"><a href="pallet.core.html#var-new-node-set-selector">new-node-set-selector</a></li><li class="ns-var-link"><a href="pallet.core.html#var-node-spec">node-spec</a></li><li class="ns-var-link"><a href="pallet.core.html#var-nodes-in-set">nodes-in-set</a></li><li class="ns-var-link"><a href="pallet.core.html#var-parallel-adjust-node-counts">parallel-adjust-node-counts</a></li><li class="ns-var-link"><a href="pallet.core.html#var-parallel-apply-phase">parallel-apply-phase</a></li><li class="ns-var-link"><a href="pallet.core.html#var-parallel-lift">parallel-lift</a></li><li class="ns-var-link"><a href="pallet.core.html#var-raise-on-error">raise-on-error</a></li><li class="ns-var-link"><a href="pallet.core.html#var-reduce-adjust-nodes">reduce-adjust-nodes</a></li><li class="ns-var-link"><a href="pallet.core.html#var-select-node-set">select-node-set</a></li><li class="ns-var-link"><a href="pallet.core.html#var-sequential-apply-phase">sequential-apply-phase</a></li><li class="ns-var-link"><a href="pallet.core.html#var-sequential-lift">sequential-lift</a></li><li class="ns-var-link"><a href="pallet.core.html#var-serial-adjust-node-counts">serial-adjust-node-counts</a></li><li class="ns-var-link"><a href="pallet.core.html#var-server">server</a></li><li class="ns-var-link"><a href="pallet.core.html#var-server-spec">server-spec</a></li><li class="ns-var-link"><a href="pallet.core.html#var-session-with-all-nodes">session-with-all-nodes</a></li><li class="ns-var-link"><a href="pallet.core.html#var-session-with-environment">session-with-environment</a></li><li class="ns-var-link"><a href="pallet.core.html#var-session-with-groups">session-with-groups</a></li><li class="ns-var-link"><a href="pallet.core.html#var-show-target-keys">show-target-keys</a></li><li class="ns-var-link"><a href="pallet.core.html#var-stop-execution-on-error">stop-execution-on-error</a></li><li class="ns-var-link"><a href="pallet.core.html#var-version">version</a></li><li class="ns-var-link"><a href="pallet.core.html#var-with-admin-user">with-admin-user</a></li><li class="ns-var-link"><a href="pallet.core.html#var-with-middleware">with-middleware</a></li>
        </ul>
      </div>
    </navigation>
    <article>
      <div id="content" class="namespace-docs">
        <h2 class="namespace-title">pallet.core documentation</h2>
        <div class="doc"><p>Core functionality is provided in <code>lift</code> and <code>converge</code>.</p>

<ul>
<li>node           :: A node in the compute service</li>
<li>node-spec      :: A specification for a node. The node-spec provides an image
                hardware, location and network template for starting new
                nodes.</li>
<li>server-spec    :: A specification for a server. This is a map of phases and
                a default node-spec. A server-spec has the following keys
                :phase, :packager and node-spec keys.</li>
<li>group-spec     :: A group of identically configured nodes, represented as a
                map with :group-name, :count and server-spec keys.
                The group-name is used to link running nodes to their
                configuration (via pallet.node.Node/group-name)</li>
<li>group          :: A group of identically configured nodes, represented as a
                group-spec, together with the servers that are running
                for that group-spec.</li>
<li>group name     :: The name used to identify a group.</li>
<li>server         :: A map used to descibe the node, image, etc of a single
                node running as part of a group. A server has the
                following keys :group-name, :node, :node-id and server-spec
                keys.</li>
<li>phase list     :: A list of phases to be used</li>
<li>action plan    :: A list of actions that should be run.</li>
</ul>
</div>
        <div class="ns-vars">
          <div class="public">
            <h3 id="var-*warn-on-undefined-phase*">*warn-on-undefined-phase*</h3>
            
            
            
            <div class="doc"><p>Flag to control output of warnings about undefined phases in calls to lift
and converge.</p>
</div>
          </div><div class="public">
            <h3 id="var-adjust-session-for-nodes">adjust-session-for-nodes</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Take :new-nodes and :old-nodes, and adjust :original-nodes and :all-nodes</p>
</div>
          </div><div class="public">
            <h3 id="var-admin-user">admin-user</h3>
            <div class="usage">[user]</div><div class="usage">[username &amp; {:keys [public-key-path private-key-path passphrase password sudo-password no-sudo], :as options}]</div>
            
            
            <div class="doc"><p>Set the root binding for the admin user.
The user arg is a map as returned by make-user, or a username.  When passing
a username the options can be specified as in <code>pallet.utils/make-user</code>.</p>

<p>This is mainly for use at the repl, since the admin user can be specified
functionally using the :user key in a lift or converge call, or in the
environment.</p>
</div>
          </div><div class="public">
            <h3 id="var-all-node-set-selector">all-node-set-selector</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Select all nodes for groups in the node-set for processing</p>
</div>
          </div><div class="public">
            <h3 id="var-cluster-groups">cluster-groups</h3>
            <div class="usage">[cluster]</div>
            
            
            <div class="doc"><p>Return the groups in the passed cluster or sequence of clusters.</p>
</div>
          </div><div class="public">
            <h3 id="var-cluster-spec">cluster-spec</h3>
            <div class="usage">[cluster-name &amp; {:keys [extends groups phases node-spec environment], :as options}]</div>
            
            
            <div class="doc"><p>Create a cluster-spec.</p>

<p><code>name</code> is used as a prefix for all groups in the cluster.</p>

<ul>
<li><p>:groups    specify a sequence of groups that define the cluster</p></li>
<li><p>:extends   specify a server-spec, a group-spec, or sequence thereof
         for all groups in the cluster</p></li>
<li><p>:phases    define phases on all groups.</p></li>
<li><p>:node-spec default node-spec for the nodes in the cluster</p></li>
<li><p>:roles     roles for the group-spec</p></li>
</ul>
</div>
          </div><div class="public">
            <h3 id="var-converge">converge</h3>
            <div class="usage">[group-spec-&gt;count &amp; {:keys [compute blobstore user phase prefix middleware all-nodes all-node-set environment], :as options}]</div>
            
            
            <div class="doc"><p>Converge the existing compute resources with the counts specified in
<code>group-spec-&gt;count</code>. New nodes are started, or nodes are destroyed,
to obtain the specified node counts.</p>

<p><code>group-spec-&gt;count</code> can be a map from group-spec to node count, or can be a
sequence of group-specs containing a :count key.</p>

<p>The compute service may be supplied as an option, otherwise the bound
compute-service is used.</p>

<p>This applies the bootstrap phase to all new nodes and the configure phase to
all running nodes whose group-name matches a key in the node map.  Additional
phases can also be specified in the options, and will be applied to all
matching nodes.  The :configure phase is always applied, by default as the
first (post bootstrap) phase.  You can change the order in which
the :configure phase is applied by explicitly listing it.</p>

<p>An optional group-name prefix may be specified. This will be used to modify
the group-name for each group-spec, allowing you to build multiple discrete
clusters from a single set of group-specs.</p>
</div>
          </div><div class="public">
            <h3 id="var-converge*">converge*</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Converge the node counts of each node-spec in <code>:node-set</code>, executing each of
the configuration phases on all the group-names in <code>:node-set</code>. The
phase-functions are also executed, but not applied, for any other nodes in
<code>:all-node-set</code></p>
</div>
          </div><div class="public">
            <h3 id="var-converge-cluster">converge-cluster</h3>
            <div class="usage">[cluster &amp; options]</div>
            
            
            <div class="doc"><p>Converge the specified cluster. As for <code>converge</code>, but takes a cluster-spec
or sequence of cluster-specs.</p>
</div>
          </div><div class="public">
            <h3 id="var-default-algorithms">default-algorithms</h3>
            
            
            
            <div class="doc"><p>Algorithms to use when none specified</p>
</div>
          </div><div class="public">
            <h3 id="var-default-environment">default-environment</h3>
            <div class="usage">[]</div>
            
            
            <div class="doc"><p>Specify the built-in default environment</p>
</div>
          </div><div class="public">
            <h3 id="var-default-executors">default-executors</h3>
            
            
            
            <div class="doc"><p>Default executor map</p>
</div>
          </div><div class="public">
            <h3 id="var-defnode">defnode</h3>
            <div class="usage">(tag doc-str? attr-map? image &amp; phasekw-phasefn-pairs)</div>
            
            <div class="deprecated">
              <p>Deprecated: <span class="version">0.5.0</span></p>
            </div>
            <div class="doc"><p>Define a node type.  The name is used for the group name.</p>

<p>image defines the image selector template.  This is a vector of keyword or
       keyword value pairs that are used to filter the image list to select
       an image.
Options are used to define phases. Standard phases are:
  :bootstrap    run on first boot
  :configure    defines the configuration of the node.</p>
</div>
          </div><div class="public">
            <h3 id="var-destroy-cluster">destroy-cluster</h3>
            <div class="usage">[cluster &amp; options]</div>
            
            
            <div class="doc"><p>Destroy the specified cluster. As for <code>converge</code>, but takes a cluster-spec
or sequence of cluster-specs.</p>
</div>
          </div><div class="public">
            <h3 id="var-environment-args">environment-args</h3>
            
            
            
            <div class="doc"><p>args that are really part of the environment</p>
</div>
          </div><div class="public">
            <h3 id="var-expand-cluster-groups">expand-cluster-groups</h3>
            <div class="usage">[node-set]</div>
            
            
            <div class="doc"><p>Expand a node-set into its groups</p>
</div>
          </div><div class="public">
            <h3 id="var-expand-group-spec-with-counts">expand-group-spec-with-counts</h3>
            <div class="usage">[node-set spec-count]</div><div class="usage">[node-set]</div>
            
            
            <div class="doc"><p>Expand a converge node spec into its groups</p>
</div>
          </div><div class="public">
            <h3 id="var-group-spec">group-spec</h3>
            <div class="usage">[name &amp; {:keys [extends count image phases packager node-spec roles], :as options}]</div>
            
            
            <div class="doc"><p>Create a group-spec.</p>

<p><code>name</code> is used for the group name, which is set on each node and links a node
to it's node-spec</p>

<ul>
<li><p>:extends  specify a server-spec, a group-spec, or sequence thereof,
        and is used to inherit phases, etc.</p></li>
<li><p>:phases used to define phases. Standard phases are:</p>

<ul><li>:bootstrap    run on first boot of a new node</li>
<li>:configure    defines the configuration of the node.</li></ul></li>
<li><p>:count    specify the target number of nodes for this node-spec</p></li>
<li>:packager override the choice of packager to use</li>
<li>:node-spec      default node-spec for this server-spec</li>
</ul>
</div>
          </div><div class="public">
            <h3 id="var-groups-with-servers">groups-with-servers</h3>
            <div class="usage">[node-map execute-node?]</div>
            
            
            <div class="doc"><p>Takes a map from node-spec to sequence of nodes, and converts it to a
sequence of group definitions, containing a server for each node in then
:servers key of each group.  The server will contain the node-spec,
updated with any information that was available from the node.</p>

<pre><code>(groups-with-servers {(node-spec "spec" {}) [a b c]})
  =&gt; [{:group-name "spec"
       :servers [{:group-name "spec" :node a}
                 {:group-name "spec" :node b}
                 {:group-name "spec" :node c}]}]
</code></pre>

<p><code>options</code> allows adding extra keys to the servers.</p>
</div>
          </div><div class="public">
            <h3 id="var-lift">lift</h3>
            <div class="usage">[node-set &amp; {:keys [compute phase prefix middleware all-node-set environment], :as options}]</div>
            
            
            <div class="doc"><p>Lift the running nodes in the specified node-set by applying the specified
phases.  The compute service may be supplied as an option, otherwise the
bound compute-service is used.  The configure phase is applied by default
unless other phases are specified.</p>

<p>node-set can be a node type, a sequence of node types, or a map
of node type to nodes. Examples:
           [node-type1 node-type2 {node-type #{node1 node2}}]
           node-type
           {node-type #{node1 node2}}</p>

<p>options can also be keywords specifying the phases to apply, or an immediate
phase specified with the phase macro, or a function that will be called with
each matching node.</p>

<p>Options:
 :compute         a jclouds compute service
 :compute-service a map of :provider, :identity, :credential, and
                  optionally :extensions for constructing a jclouds compute
                  service.
 :phase           a phase keyword, phase function, or sequence of these
 :middleware      the middleware to apply to the configuration pipeline
 :prefix          a prefix for the group-name names
 :user            the admin-user on the nodes</p>
</div>
          </div><div class="public">
            <h3 id="var-lift*">lift*</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Lift the nodes specified in the session :node-set key.
- :node-set     - a specification of nodes to lift
- :all-nodes    - a sequence of all known nodes
- :all-node-set - a specification of nodes to invoke (but not lift)</p>
</div>
          </div><div class="public">
            <h3 id="var-lift-cluster">lift-cluster</h3>
            <div class="usage">[cluster &amp; options]</div>
            
            
            <div class="doc"><p>Lift the specified cluster.  As for <code>lift</code>, but takes a cluster-spec
or sequence of cluster-specs.</p>
</div>
          </div><div class="public">
            <h3 id="var-lift-nodes">lift-nodes</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Lift nodes in target-node-map for the specified phases.</p>
</div>
          </div><div class="public">
            <h3 id="var-lift-phase">lift-phase</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Lift nodes in target-node-map for the specified phases.</p>

<p>Builds the commands for the phase, then executes pre-phase, phase, and
after-phase</p>
</div>
          </div><div class="public">
            <h3 id="var-log-message">log-message</h3>
            <div class="usage">[msg]</div>
            
            
            <div class="doc"><p>Log the message</p>
</div>
          </div><div class="public">
            <h3 id="var-log-session">log-session</h3>
            <div class="usage">[msg]</div>
            
            
            <div class="doc"><p>Log the session state</p>
</div>
          </div><div class="public">
            <h3 id="var-make-node">make-node</h3>
            <div class="usage">[name image &amp; {:as phase-map}]</div>
            
            <div class="deprecated">
              <p>Deprecated: <span class="version">0.5.0</span></p>
            </div>
            <div class="doc"><p>Create a node definition.  See defnode.</p>
</div>
          </div><div class="public">
            <h3 id="var-merge-spec-algorithm">merge-spec-algorithm</h3>
            
            
            
            <div class="doc"><p>Map from key to merge algorithm. Specifies how specs are merged.</p>
</div>
          </div><div class="public">
            <h3 id="var-middleware-handler">middleware-handler</h3>
            <div class="usage">[handler]</div>
            
            
            <div class="doc"><p>Build a middleware processing pipeline from the specified middleware.
The result is a middleware.</p>
</div>
          </div><div class="public">
            <h3 id="var-name-with-attributes">name-with-attributes</h3>
            <div class="usage">[name macro-args]</div>
            
            
            <div class="doc"><p>Modified version, of that found in contrib, to handle the image map.</p>
</div>
          </div><div class="public">
            <h3 id="var-new-node-set-selector">new-node-set-selector</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Select all new nodes for groups in the node-set for processing</p>
</div>
          </div><div class="public">
            <h3 id="var-node-spec">node-spec</h3>
            <div class="usage">[&amp; {:keys [image hardware location network qos], :as options}]</div>
            
            
            <div class="doc"><p>Create a node-spec.</p>

<p>Defines the compute image and hardware selector template.</p>

<p>This is used to filter a cloud provider's image and hardware list to select
an image and hardware for nodes created for this node-spec.</p>

<p>:image     a map descirbing a predicate for matching an image:
           os-family os-name-matches os-version-matches
           os-description-matches os-64-bit
           image-version-matches image-name-matches
           image-description-matches image-id</p>

<p>:location  a map describing a predicate for matching location:
           location-id
:hardware  a map describing a predicate for matching harware:
           min-cores min-ram smallest fastest biggest architecture
           hardware-id
:network   a map for network connectivity options:
           inbound-ports
:qos       a map for quality of service options:
           spot-price enable-monitoring</p>
</div>
          </div><div class="public">
            <h3 id="var-nodes-in-set">nodes-in-set</h3>
            <div class="usage">[node-set prefix nodes]</div>
            
            
            <div class="doc"><p>Build a map of node-spec to nodes for the given <code>node-set</code>.
A node set can be a node spec, a map from node-spec to a sequence of nodes,
or a sequence of these.</p>

<p>The prefix is applied to the group-name of each node-spec in the result.
This allows you to build seperate clusters based on the same node-spec's.</p>

<p>The return value is a map of node-spec to node sequence.</p>

<p>Example node sets:
    node-spec-1
    [node-spec1 node-spec-2]
    {node-spec #{node1 node2}}
    [node-spec1 node-spec-2 {node-spec #{node1 node2}}]</p>
</div>
          </div><div class="public">
            <h3 id="var-parallel-adjust-node-counts">parallel-adjust-node-counts</h3>
            <div class="usage">[session op groups]</div>
            
            
            <div class="doc"><p>Start or stop the specified number of nodes.</p>
</div>
          </div><div class="public">
            <h3 id="var-parallel-apply-phase">parallel-apply-phase</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Apply a phase to a sequence of nodes</p>
</div>
          </div><div class="public">
            <h3 id="var-parallel-lift">parallel-lift</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Apply the phases in sequence, to nodes in parallel.</p>
</div>
          </div><div class="public">
            <h3 id="var-raise-on-error">raise-on-error</h3>
            <div class="usage">[handler]</div>
            
            
            <div class="doc"><p>Middleware that raises a condition on an error.</p>
</div>
          </div><div class="public">
            <h3 id="var-reduce-adjust-nodes">reduce-adjust-nodes</h3>
            <div class="usage">[session session-adjust]</div>
            
            
            <div class="doc"><p>reduce the result of an adjust-node onto a session</p>
</div>
          </div><div class="public">
            <h3 id="var-select-node-set">select-node-set</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Select a node-set of nodes to be passed to lift</p>
</div>
          </div><div class="public">
            <h3 id="var-sequential-apply-phase">sequential-apply-phase</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Apply a phase to a sequence of nodes</p>
</div>
          </div><div class="public">
            <h3 id="var-sequential-lift">sequential-lift</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Sequential apply the phases.</p>
</div>
          </div><div class="public">
            <h3 id="var-serial-adjust-node-counts">serial-adjust-node-counts</h3>
            <div class="usage">[session op groups]</div>
            
            
            <div class="doc"><p>Start or stop the specified number of nodes.</p>
</div>
          </div><div class="public">
            <h3 id="var-server">server</h3>
            <div class="usage">[group node options]</div>
            
            
            <div class="doc"><p>Take a <code>group</code> and a <code>node</code>, an <code>options</code> map and combine them to produce
a server.</p>

<p>The group os-family, os-version, are replaced with the details form the
node. The :node key is set to <code>node</code>, and the :node-id and :packager keys
are set.</p>

<p><code>options</code> allows adding extra keys on the server.</p>
</div>
          </div><div class="public">
            <h3 id="var-server-spec">server-spec</h3>
            <div class="usage">[&amp; {:keys [phases packager node-spec extends roles], :as options}]</div>
            
            
            <div class="doc"><p>Create a server-spec.</p>

<ul>
<li>:phases a hash-map used to define phases. Standard phases are:
<ul><li>:bootstrap    run on first boot of a new node</li>
<li>:configure    defines the configuration of the node</li></ul></li>
<li>:extends        takes a server-spec, or sequence thereof, and is used to
              inherit phases, etc.</li>
<li>:roles          defines a sequence of roles for the server-spec</li>
<li>:node-spec      default node-spec for this server-spec</li>
<li>:packager       override the choice of packager to use</li>
</ul>
</div>
          </div><div class="public">
            <h3 id="var-session-with-all-nodes">session-with-all-nodes</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>If the :all-nodes key is not set, then the nodes are retrieved from the
compute service if possible.</p>
</div>
          </div><div class="public">
            <h3 id="var-session-with-environment">session-with-environment</h3>
            <div class="usage">[{:as options}]</div>
            
            
            <div class="doc"><p>Build a session map from the given options, combining the service specific
options with those given in the converge or lift invocation.</p>
</div>
          </div><div class="public">
            <h3 id="var-session-with-groups">session-with-groups</h3>
            <div class="usage">[session]</div>
            
            
            <div class="doc"><p>Takes the :selected-nodes, :all-nodes. :node-set and :prefix keys and compute
the groups for the session, updating the :selected-nodes, :all-nodes
and :groups keys of the session.</p>

<p>The :groups key is set to a sequence of groups, each containing its
list of servers on the :servers key.</p>
</div>
          </div><div class="public">
            <h3 id="var-show-target-keys">show-target-keys</h3>
            <div class="usage">[handler]</div>
            
            
            <div class="doc"><p>Middleware that is useful in debugging.</p>
</div>
          </div><div class="public">
            <h3 id="var-stop-execution-on-error">stop-execution-on-error</h3>
            <div class="usage">[result flag]</div>
            
            
            <div class="doc"><p>:execute-status-fn algorithm to stop execution on an error</p>
</div>
          </div><div class="public">
            <h3 id="var-version">version</h3>
            <div class="usage">[]</div>
            
            
            <div class="doc"><p>Returns the pallet version.</p>
</div>
          </div><div class="public">
            <h3 id="var-with-admin-user">with-admin-user</h3>
            <div class="usage">[user &amp; body]</div><div class="usage">[[username &amp; {:keys [public-key-path private-key-path passphrase password sudo-password no-sudo], :as options}] &amp; body]</div>
            
            
            <div class="doc"><p>Specify the admin user for running remote commands.  The user is specified
either as pallet.utils.User record (see the pallet.utils/make-user
convenience fn) or as an argument list that will be passed to make-user.</p>

<p>This is mainly for use at the repl, since the admin user can be specified
functionally using the :user key in a lift or converge call, or in the
environment.</p>
</div>
          </div><div class="public">
            <h3 id="var-with-middleware">with-middleware</h3>
            <div class="usage">[f &amp; body]</div>
            
            
            <div class="doc"><p>Wrap node execution in the given middleware. A middleware is a function of
one argument (a handler function, that is the next middleware to call) and
returns a dunction of one argument (the session map).  Middleware can be
composed with the pipe macro.</p>
</div>
          </div>
        </div>
      </div>
    </article>
  </body>

</html>