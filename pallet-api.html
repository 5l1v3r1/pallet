<html>
  <head>
    <title>pallet API reference (Pallet)</title>
    <link href="static/favicon.png" rel="icon" />
    <link href="static/favicon.png" rel="shortcut icon" />
    <link media="all" type="text/css" href="static/clojure.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/wiki.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/internal.css" rel="stylesheet" />
    <!-- TODO: are we using these (from clojure.org)? If so, add the files -->
    <script src="file/view/code_highlighter.js" type="text/javascript"></script>
    <script src="file/view/clojure.js" type="text/javascript"></script>
    <style>.menuWrapper{height: 36px;}</style>
    <!--[if lte IE 6]>
    <link rel="stylesheet" href="http://www.wikispaces.com/_/2009051601/s/internal_ie.css" type="text/css" />
    <![endif]-->
  </head>
<!--
This document was auto-generated from the source by the clojure autodoc system.
To report errors or ask questions about the overall documentation structure, formatting,
etc., contact Tom Faulhaber (google mail name: tomfaulhaber).
For errors in the documentation of a particular namespace, contact the author of that
namespace.
-->
  <body>
    <div id="AllContentContainer">
      <div id="Header">
	<a id="Logo" href="index.html"><img alt="Clojure" height="100" width="100" src="static/clojure-icon.gif" /></a>
	<h1><a title="page header title" id="page-header" href="index.html">Pallet</a></h1>
      </div>
      <div id="leftcolumn"><div style="text-align: center;"></div>
<div class="menu">
  <div class="WikiCustomNav WikiElement wiki">
    <a class="wiki_link" href="index.html">Overview</a><br />
    <a class="wiki_link" href="api-index.html">API Index</a><br />
    <a class="wiki_link" href="#">Namespaces:</a>
    <ul id="left-sidebar-list">
      <li><a href="demo-api.html" class="wiki_link">demo</a></li><li><a href="pallet-api.html" class="wiki_link">pallet</a></li>
    </ul>
  </div>
</div>
</div>
      <div id="rightcolumn">
	<div id="Content">
	  <div class="contentBox"><div class="innerContentBox">
              <div id="content_view" class="wiki wikiPage">
                <div id="right-sidebar"><div id="toc">
  <h1 class="nopad">Table of Contents</h1>
  <div style="margin-left: 1em;" class="toc-section">
    <a href="#toc0">Overview</a>
    <div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/adjust-node-counts">adjust-node-counts</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/bootstrap-script">bootstrap-script</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/chef-cook-solo">chef-cook-solo</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/converge">converge</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/converge-node-counts">converge-node-counts</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/create-nodes">create-nodes</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/make-user">make-user</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/node-template">node-template</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/primary-ip">primary-ip</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/remote-cmd">remote-cmd</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/shutdown-node">shutdown-node</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/slurp-resource">slurp-resource</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/sudo!">sudo!</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/system">system</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/with-chef-repository">with-chef-repository</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#pallet/with-node-templates">with-node-templates</a>
    </div>
    <br />
  </div>
</div>
</div>
                <div id="content-tag"><h1 id="overview">API for <span id="namespace-name">pallet</span></h1>
by <span id="author">Hugo Duncan</span><br />
<br />Usage:
<pre>
(ns your-namespace
  (:require <span id="long-name">pallet</span>))
</pre><pre>
</pre><h2>Overview</h2>
<pre id="namespace-docstr">
Pallet is used to provision configured compute nodes using crane, jclouds and chef.

It uses a declaritive map for specifying the number of nodes with a given tag.
Each tag is used to look up a machine image template specification (in crane and
jsclouds), and to lookup configuration information (in chef).  The converge
function then tries to bring you compute servers into alignment with your
declared counts and configurations.

The bootstrap process for new compute nodes installs a user with sudo
permissions, using the specified username and password. The installed user is
used to execute the chef cookbooks.

Once the nodes are bootstrapped, and fall all existing nodes
the configured node information is written to the "compute-nodes" cookbook
before chef is run, and this provides a :compute_nodes attribute.  The
compute-nodes cookbook is expected to exist in the site-cookbooks of the
chef-repository you specify with `with-chef-repository`.

`chef-solo` is then run with chef repository you have specified using the node
tag as a configuration target.</pre>
<br />
<h2>Public Variables and Functions</h2>
<div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/adjust-node-counts">adjust-node-counts</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (adjust-node-counts compute node-map nodes user)
</pre>
  <pre id="var-docstr">Start or stop the specified number of nodes.</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L285" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/bootstrap-script">bootstrap-script</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (bootstrap-script user)
       (bootstrap-script user bootstrap-repo)
</pre>
  <pre id="var-docstr">A script to install chef and create the specified user, enabled for
access with the specified public key.</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L179" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/chef-cook-solo">chef-cook-solo</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (chef-cook-solo server command user)
</pre>
  <pre id="var-docstr">Run a chef solo command on a server.  A command is expected to exist as
chef-repo/config/command.json</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L254" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/converge">converge</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (converge compute node-map user)
</pre>
  <pre id="var-docstr">Converge the existing compute resources with what is required</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L320" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/converge-node-counts">converge-node-counts</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (converge-node-counts compute node-map user)
</pre>
  <pre id="var-docstr">Converge the nodes counts, given a compute facility and a reference number of
instances.</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L293" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/create-nodes">create-nodes</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (create-nodes compute tag count user)
</pre>
  <pre id="var-docstr">Create a node based on the keyword tag</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L199" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/make-user">make-user</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (make-user username password)
       (make-user username password public-key-path private-key-path)
</pre>
  <pre id="var-docstr">Create a description of the admin user to be created and used for running
chef.</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L305" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/node-template">node-template</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (node-template compute target public-key-path init-script)
</pre>
  <pre id="var-docstr">Build the template for specified target node and compute context</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L130" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/primary-ip">primary-ip</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (primary-ip node)
</pre>
  <pre id="var-docstr">Returns the first public IP for the node.</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L145" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/remote-cmd">remote-cmd</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (remote-cmd server command)
       (remote-cmd server command user)
       (remote-cmd server command user private-key)
</pre>
  <pre id="var-docstr">Run a command on a server.</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L93" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/shutdown-node">shutdown-node</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (shutdown-node compute node user)
</pre>
  <pre id="var-docstr">Shutdown a node.</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L163" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/slurp-resource">slurp-resource</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (slurp-resource name)
       (slurp-resource name enc)
</pre>
  <pre id="var-docstr">Reads the resource named by name using the encoding enc into a string
and returns it.</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L56" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/sudo!">sudo!</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (sudo! server command user)
</pre>
  <pre id="var-docstr">Run a sudo command on a server.</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L107" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/system">system</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (system cmd)
</pre>
  <pre id="var-docstr">Launch a system process, return a string containing the process output.</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L79" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/with-chef-repository">with-chef-repository</h2>
  <span id="var-type">macro</span><br />
  <pre id="var-usage">Usage: (with-chef-repository path &amp; body)
</pre>
  <pre id="var-docstr">Specifies the chef repository that contains the cookboks and configurations</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L214" id="var-source">Source</a>
</div><div id="var-entry">
  <br />
  <hr />
  <h2 id="pallet/with-node-templates">with-node-templates</h2>
  <span id="var-type">macro</span><br />
  <pre id="var-usage">Usage: (with-node-templates map &amp; body)
</pre>
  <pre id="var-docstr">Set the template map</pre>
  <a href="http://github.com/hugoduncan/pallet/blob/169977095263d20796f1dc6092c8ae3465884839/src/pallet.clj#L124" id="var-source">Source</a>
</div>


</div>
              </div>
            </div>
          </div>
	</div>
	<div id="foot">
	  <div style="text-align: center;" id="copyright">Copyright Hugo Duncan 2010. All rights reserved.</div>
	</div>
      </div>
      <div id="DesignedBy">Logo &amp; site design by <a title="Visit Tom Hickey's website." href="http://www.tomhickey.com">Tom Hickey</a>.<br />
      Clojure auto-documentation system by Tom Faulhaber.</div>
    </div>
    <!-- /AllContentContainer -->
  </body>

</html>